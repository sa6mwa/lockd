<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="2184px" preserveAspectRatio="none" style="width:1020px;height:2184px;background:#FFFFFF;" version="1.1" viewBox="0 0 1020 2184" width="1020px" zoomAndPan="magnify">
  <rect width="100%" height="100%" fill="#ffffff"/><defs><filter height="300%" id="f1l8vejm5ueg6n" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="none" filter="url(#f1l8vejm5ueg6n)" height="163.512" style="stroke:#000000;stroke-width:2;" width="591.1688" x="286.4464" y="248.892"/><rect fill="none" filter="url(#f1l8vejm5ueg6n)" height="163.512" style="stroke:#000000;stroke-width:2;" width="591.1688" x="286.4464" y="520.522"/><rect fill="none" filter="url(#f1l8vejm5ueg6n)" height="261.3541" style="stroke:#000000;stroke-width:2;" width="991.1068" x="10" y="1127.9182"/><rect fill="none" filter="url(#f1l8vejm5ueg6n)" height="148.5301" style="stroke:#000000;stroke-width:2;" width="714.6604" x="286.4464" y="1611.2145"/><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="2006.4428" width="8" x="37.8369" y="91.0679"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:5,5;" x1="41" x2="41" y1="91.0679" y2="2097.5107"/></g><g><title>HTTP Handler</title><rect fill="#000000" fill-opacity="0.00000" height="2006.4428" width="8" x="346.8623" y="91.0679"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:5,5;" x1="350.4464" x2="350.4464" y1="91.0679" y2="2097.5107"/></g><g><title>JSON Compactor</title><rect fill="#000000" fill-opacity="0.00000" height="2006.4428" width="8" x="521.6984" y="91.0679"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:5,5;" x1="524.8886" x2="524.8886" y1="91.0679" y2="2097.5107"/></g><g><title>S3 Store .minio-go.</title><rect fill="#000000" fill-opacity="0.00000" height="2006.4428" width="8" x="667.1509" y="91.0679"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:5,5;" x1="670.5082" x2="670.5082" y1="91.0679" y2="2097.5107"/></g><g><title>meta..key..json</title><rect fill="#000000" fill-opacity="0.00000" height="2006.4428" width="8" x="806.2045" y="91.0679"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:5,5;" x1="809.7937" x2="809.7937" y1="91.0679" y2="2097.5107"/></g><g><title>state..key..json</title><rect fill="#000000" fill-opacity="0.00000" height="2006.4428" width="8" x="930.3611" y="91.0679"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:5,5;" x1="933.6153" x2="933.6153" y1="91.0679" y2="2097.5107"/></g><g class="participant participant-head" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37.6738" x="20" y="86.9659">Client</text><ellipse cx="41.8369" cy="15" fill="#FEFECE" filter="url(#f1l8vejm5ueg6n)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2;"/><path d="M41.8369,23 L41.8369,50 M28.8369,31 L54.8369,31 M41.8369,50 L28.8369,65 M41.8369,50 L54.8369,65" fill="none" filter="url(#f1l8vejm5ueg6n)" style="stroke:#A80036;stroke-width:2;"/></g><g class="participant participant-tail" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37.6738" x="20" y="2111.4767">Client</text><ellipse cx="41.8369" cy="2125.5787" fill="#FEFECE" filter="url(#f1l8vejm5ueg6n)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2;"/><path d="M41.8369,2133.5787 L41.8369,2160.5787 M28.8369,2141.5787 L54.8369,2141.5787 M41.8369,2160.5787 L28.8369,2175.5787 M41.8369,2160.5787 L54.8369,2175.5787" fill="none" filter="url(#f1l8vejm5ueg6n)" style="stroke:#A80036;stroke-width:2;"/></g><g class="participant participant-head" data-participant="Handler"><rect fill="#FEFECE" filter="url(#f1l8vejm5ueg6n)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="104.8316" x="296.4464" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.8316" x="303.4464" y="74.9659">HTTP Handler</text></g><g class="participant participant-tail" data-participant="Handler"><rect fill="#FEFECE" filter="url(#f1l8vejm5ueg6n)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="104.8316" x="296.4464" y="2096.5107"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.8316" x="303.4464" y="2118.4767">HTTP Handler</text></g><g class="participant participant-head" data-participant="Compactor"><rect fill="#FEFECE" filter="url(#f1l8vejm5ueg6n)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="123.6196" x="461.8886" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.6196" x="468.8886" y="74.9659">JSON Compactor</text></g><g class="participant participant-tail" data-participant="Compactor"><rect fill="#FEFECE" filter="url(#f1l8vejm5ueg6n)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="123.6196" x="461.8886" y="2096.5107"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.6196" x="468.8886" y="2118.4767">JSON Compactor</text></g><g class="participant participant-head" data-participant="S3"><rect fill="#FEFECE" filter="url(#f1l8vejm5ueg6n)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="139.2855" x="599.5082" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125.2855" x="606.5082" y="74.9659">S3 Store (minio-go)</text></g><g class="participant participant-tail" data-participant="S3"><rect fill="#FEFECE" filter="url(#f1l8vejm5ueg6n)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="139.2855" x="599.5082" y="2096.5107"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125.2855" x="606.5082" y="2118.4767">S3 Store (minio-go)</text></g><g class="participant participant-head" data-participant="MetaObj"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108.8216" x="752.7937" y="86.9659">meta/&lt;key&gt;.json</text><path d="M792.2045,36 C792.2045,26 810.2045,26 810.2045,26 C810.2045,26 828.2045,26 828.2045,36 L828.2045,62 C828.2045,72 810.2045,72 810.2045,72 C810.2045,72 792.2045,72 792.2045,62 L792.2045,36" fill="#FEFECE" filter="url(#f1l8vejm5ueg6n)" style="stroke:#A80036;stroke-width:1;"/><path d="M792.2045,36 C792.2045,46 810.2045,46 810.2045,46 C810.2045,46 828.2045,46 828.2045,36" fill="none" style="stroke:#A80036;stroke-width:1;"/></g><g class="participant participant-tail" data-participant="MetaObj"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108.8216" x="752.7937" y="2111.4767">meta/&lt;key&gt;.json</text><path d="M792.2045,2125.5787 C792.2045,2115.5787 810.2045,2115.5787 810.2045,2115.5787 C810.2045,2115.5787 828.2045,2115.5787 828.2045,2125.5787 L828.2045,2151.5787 C828.2045,2161.5787 810.2045,2161.5787 810.2045,2161.5787 C810.2045,2161.5787 792.2045,2161.5787 792.2045,2151.5787 L792.2045,2125.5787" fill="#FEFECE" filter="url(#f1l8vejm5ueg6n)" style="stroke:#A80036;stroke-width:1;"/><path d="M792.2045,2125.5787 C792.2045,2135.5787 810.2045,2135.5787 810.2045,2135.5787 C810.2045,2135.5787 828.2045,2135.5787 828.2045,2125.5787" fill="none" style="stroke:#A80036;stroke-width:1;"/></g><g class="participant participant-head" data-participant="StateObj"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107.4916" x="877.6153" y="86.9659">state/&lt;key&gt;.json</text><path d="M916.3611,36 C916.3611,26 934.3611,26 934.3611,26 C934.3611,26 952.3611,26 952.3611,36 L952.3611,62 C952.3611,72 934.3611,72 934.3611,72 C934.3611,72 916.3611,72 916.3611,62 L916.3611,36" fill="#FEFECE" filter="url(#f1l8vejm5ueg6n)" style="stroke:#A80036;stroke-width:1;"/><path d="M916.3611,36 C916.3611,46 934.3611,46 934.3611,46 C934.3611,46 952.3611,46 952.3611,36" fill="none" style="stroke:#A80036;stroke-width:1;"/></g><g class="participant participant-tail" data-participant="StateObj"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107.4916" x="877.6153" y="2111.4767">state/&lt;key&gt;.json</text><path d="M916.3611,2125.5787 C916.3611,2115.5787 934.3611,2115.5787 934.3611,2115.5787 C934.3611,2115.5787 952.3611,2115.5787 952.3611,2125.5787 L952.3611,2151.5787 C952.3611,2161.5787 934.3611,2161.5787 934.3611,2161.5787 C934.3611,2161.5787 916.3611,2161.5787 916.3611,2151.5787 L916.3611,2125.5787" fill="#FEFECE" filter="url(#f1l8vejm5ueg6n)" style="stroke:#A80036;stroke-width:1;"/><path d="M916.3611,2125.5787 C916.3611,2135.5787 934.3611,2135.5787 934.3611,2135.5787 C934.3611,2135.5787 952.3611,2135.5787 952.3611,2125.5787" fill="none" style="stroke:#A80036;stroke-width:1;"/></g><rect fill="#EEEEEE" filter="url(#f1l8vejm5ueg6n)" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1011.1068" x="0" y="122.9209"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1011.1068" y1="122.9209" y2="122.9209"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1011.1068" y1="125.9209" y2="125.9209"/><rect fill="#EEEEEE" filter="url(#f1l8vejm5ueg6n)" height="25.706" style="stroke:#000000;stroke-width:2;" width="67.352" x="471.8774" y="111.0679"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="49.972" x="477.8774" y="128.9649">Acquire</text><g class="message" data-participant-1="Client" data-participant-2="Handler"><polygon fill="#A80036" points="338.8623,166.4799,348.8623,170.4799,338.8623,174.4799,342.8623,170.4799" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="41.8369" x2="344.8623" y1="170.4799" y2="170.4799"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.0921" x="48.8369" y="164.6709">POST /v1/acquire</text></g><g class="message" data-participant-1="Handler" data-participant-2="S3"><polygon fill="#A80036" points="659.1509,198.186,669.1509,202.186,659.1509,206.186,663.1509,202.186" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="350.8623" x2="665.1509" y1="202.186" y2="202.186"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.1051" x="357.8623" y="196.377">GetObject(meta/&lt;key&gt;.json)</text></g><g class="message" data-participant-1="S3" data-participant-2="MetaObj"><polygon fill="#A80036" points="798.2045,229.892,808.2045,233.892,798.2045,237.892,802.2045,233.892" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="671.1509" x2="804.2045" y1="233.892" y2="233.892"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23.92" x="678.1509" y="228.083">GET</text></g><path d="M286.4464,248.892 L348.9054,248.892 L348.9054,258.598 L338.9054,268.598 L286.4464,268.598 L286.4464,248.892" fill="#EEEEEE" style="stroke:#000000;stroke-width:1;"/><rect fill="none" height="163.512" style="stroke:#000000;stroke-width:2;" width="591.1688" x="286.4464" y="248.892"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.459" x="301.4464" y="263.789">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="63.1505" x="363.9054" y="262.6509">[Not found]</text><g class="message" data-participant-1="MetaObj" data-participant-2="S3"><polygon fill="#A80036" points="682.1509,288.304,672.1509,292.304,682.1509,296.304,678.1509,292.304" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="676.1509" x2="809.2045" y1="292.304" y2="292.304"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22.308" x="688.1509" y="286.495">404</text></g><g class="message" data-participant-1="S3" data-participant-2="Handler"><polygon fill="#A80036" points="361.8623,320.01,351.8623,324.01,361.8623,328.01,357.8623,324.01" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="355.8623" x2="670.1509" y1="324.01" y2="324.01"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79.0791" x="367.8623" y="318.201">ErrNotFound</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="286.4464" x2="877.6153" y1="333.01" y2="333.01"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="41.5467" x="291.4464" y="344.7689">[Found]</text><g class="message" data-participant-1="MetaObj" data-participant-2="S3"><polygon fill="#A80036" points="682.1509,368.6979,672.1509,372.6979,682.1509,376.6979,678.1509,372.6979" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="676.1509" x2="809.2045" y1="372.6979" y2="372.6979"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74.6591" x="688.1509" y="366.8889">JSON + ETag</text></g><g class="message" data-participant-1="S3" data-participant-2="Handler"><polygon fill="#A80036" points="361.8623,400.404,351.8623,404.404,361.8623,408.404,357.8623,404.404" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="355.8623" x2="670.1509" y1="404.404" y2="404.404"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.9821" x="367.8623" y="398.595">meta + etag</text></g><g class="message" data-participant-1="Handler" data-participant-2="Handler"><line style="stroke:#A80036;stroke-width:1;" x1="350.8623" x2="392.8623" y1="443.11" y2="443.11"/><line style="stroke:#A80036;stroke-width:1;" x1="392.8623" x2="392.8623" y1="443.11" y2="456.11"/><line style="stroke:#A80036;stroke-width:1;" x1="351.8623" x2="392.8623" y1="456.11" y2="456.11"/><polygon fill="#A80036" points="361.8623,452.11,351.8623,456.11,361.8623,460.11,357.8623,456.11" style="stroke:#A80036;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.8361" x="357.8623" y="437.301">lease_id, fencing := prev+1</text></g><g class="message" data-participant-1="Handler" data-participant-2="S3"><polygon fill="#A80036" points="659.1509,501.522,669.1509,505.522,659.1509,509.522,663.1509,505.522" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="350.8623" x2="665.1509" y1="505.522" y2="505.522"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.7512" x="357.8623" y="482.007">PutObject(meta, updated lease)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.3532" x="357.8623" y="499.713">If-Match old_etag or If-None-Match "*"</text></g><path d="M286.4464,520.522 L348.9054,520.522 L348.9054,530.228 L338.9054,540.228 L286.4464,540.228 L286.4464,520.522" fill="#EEEEEE" style="stroke:#000000;stroke-width:1;"/><rect fill="none" height="163.512" style="stroke:#000000;stroke-width:2;" width="591.1688" x="286.4464" y="520.522"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.459" x="301.4464" y="535.419">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="111.7922" x="363.9054" y="534.2809">[Precondition failed]</text><g class="message" data-participant-1="S3" data-participant-2="Handler"><polygon fill="#A80036" points="361.8623,559.934,351.8623,563.934,361.8623,567.934,357.8623,563.934" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="355.8623" x2="670.1509" y1="563.934" y2="563.934"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.4131" x="367.8623" y="558.125">ErrCASMismatch</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="286.4464" x2="877.6153" y1="572.934" y2="572.934"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="49.3127" x="291.4464" y="584.6929">[Success]</text><g class="message" data-participant-1="S3" data-participant-2="MetaObj"><polygon fill="#A80036" points="798.2045,608.6219,808.2045,612.6219,798.2045,616.6219,802.2045,612.6219" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="671.1509" x2="804.2045" y1="612.6219" y2="612.6219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.486" x="678.1509" y="606.8129">store</text></g><g class="message" data-participant-1="MetaObj" data-participant-2="S3"><polygon fill="#A80036" points="682.1509,640.328,672.1509,644.328,682.1509,648.328,678.1509,644.328" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="676.1509" x2="809.2045" y1="644.328" y2="644.328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58.7081" x="688.1509" y="638.519">new ETag</text></g><g class="message" data-participant-1="S3" data-participant-2="Handler"><polygon fill="#A80036" points="361.8623,672.034,351.8623,676.034,361.8623,680.034,357.8623,676.034" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="355.8623" x2="670.1509" y1="676.034" y2="676.034"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.9141" x="367.8623" y="670.225">new_meta_etag</text></g><g class="message" data-participant-1="Handler" data-participant-2="Client"><polygon fill="#A80036" points="52.8369,728.446,42.8369,732.446,52.8369,736.446,48.8369,732.446" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="46.8369" x2="349.8623" y1="732.446" y2="732.446"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.4171" x="58.8369" y="708.931">200 AcquireResponse</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.1271" x="58.8369" y="726.637">X-Fencing-Token</text></g><rect fill="#EEEEEE" filter="url(#f1l8vejm5ueg6n)" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1011.1068" x="0" y="762.299"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1011.1068" y1="762.299" y2="762.299"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1011.1068" y1="765.299" y2="765.299"/><rect fill="#EEEEEE" filter="url(#f1l8vejm5ueg6n)" height="25.706" style="stroke:#000000;stroke-width:2;" width="81.5871" x="464.7599" y="750.446"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64.207" x="470.7599" y="768.343">KeepAlive</text><g class="message" data-participant-1="Client" data-participant-2="Handler"><polygon fill="#A80036" points="338.8623,823.5641,348.8623,827.5641,338.8623,831.5641,342.8623,827.5641" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="41.8369" x2="344.8623" y1="827.5641" y2="827.5641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.0131" x="48.8369" y="804.049">POST /v1/keepalive</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.1271" x="48.8369" y="821.7551">X-Fencing-Token</text></g><g class="message" data-participant-1="Handler" data-participant-2="S3"><polygon fill="#A80036" points="659.1509,872.9761,669.1509,876.9761,659.1509,880.9761,663.1509,876.9761" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="350.8623" x2="665.1509" y1="876.9761" y2="876.9761"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179.9462" x="357.8623" y="853.4611">PutObject(meta, new expires)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.0541" x="357.8623" y="871.1671">If-Match meta_etag</text></g><g class="message" data-participant-1="S3" data-participant-2="MetaObj"><polygon fill="#A80036" points="798.2045,904.6821,808.2045,908.6821,798.2045,912.6821,802.2045,908.6821" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="671.1509" x2="804.2045" y1="908.6821" y2="908.6821"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.486" x="678.1509" y="902.8731">store</text></g><g class="message" data-participant-1="MetaObj" data-participant-2="S3"><polygon fill="#A80036" points="682.1509,936.3881,672.1509,940.3881,682.1509,944.3881,678.1509,940.3881" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="676.1509" x2="809.2045" y1="940.3881" y2="940.3881"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58.7081" x="688.1509" y="934.5791">new ETag</text></g><g class="message" data-participant-1="S3" data-participant-2="Handler"><polygon fill="#A80036" points="361.8623,968.0941,351.8623,972.0941,361.8623,976.0941,357.8623,972.0941" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="355.8623" x2="670.1509" y1="972.0941" y2="972.0941"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.9141" x="367.8623" y="966.2851">new_meta_etag</text></g><g class="message" data-participant-1="Handler" data-participant-2="Client"><polygon fill="#A80036" points="52.8369,999.8002,42.8369,1003.8002,52.8369,1007.8002,48.8369,1003.8002" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="46.8369" x2="349.8623" y1="1003.8002" y2="1003.8002"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85.3451" x="58.8369" y="997.9912">200 KeepAlive</text></g><rect fill="#EEEEEE" filter="url(#f1l8vejm5ueg6n)" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1011.1068" x="0" y="1033.6532"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1011.1068" y1="1033.6532" y2="1033.6532"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1011.1068" y1="1036.6532" y2="1036.6532"/><rect fill="#EEEEEE" filter="url(#f1l8vejm5ueg6n)" height="25.706" style="stroke:#000000;stroke-width:2;" width="74.099" x="468.5039" y="1021.8002"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56.719" x="474.5039" y="1039.6972">GetState</text><g class="message" data-participant-1="Client" data-participant-2="Handler"><polygon fill="#A80036" points="338.8623,1077.2122,348.8623,1081.2122,338.8623,1085.2122,342.8623,1081.2122" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="41.8369" x2="344.8623" y1="1081.2122" y2="1081.2122"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115.5051" x="48.8369" y="1075.4032">POST /v1/get_state</text></g><g class="message" data-participant-1="Handler" data-participant-2="S3"><polygon fill="#A80036" points="659.1509,1108.9182,669.1509,1112.9182,659.1509,1116.9182,663.1509,1112.9182" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="350.8623" x2="665.1509" y1="1112.9182" y2="1112.9182"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.6211" x="357.8623" y="1107.1092">StatObject(state)</text></g><path d="M10,1127.9182 L72.459,1127.9182 L72.459,1137.6242 L62.459,1147.6242 L10,1147.6242 L10,1127.9182" fill="#EEEEEE" style="stroke:#000000;stroke-width:1;"/><rect fill="none" height="261.3541" style="stroke:#000000;stroke-width:2;" width="991.1068" x="10" y="1127.9182"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.459" x="25" y="1142.8152">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="63.1505" x="87.459" y="1141.6771">[Not found]</text><g class="message" data-participant-1="S3" data-participant-2="Handler"><polygon fill="#A80036" points="361.8623,1167.3302,351.8623,1171.3302,361.8623,1175.3302,357.8623,1171.3302" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="355.8623" x2="670.1509" y1="1171.3302" y2="1171.3302"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79.0791" x="367.8623" y="1165.5212">ErrNotFound</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="1001.1068" y1="1180.3302" y2="1180.3302"/><g class="message" data-participant-1="S3" data-participant-2="StateObj"><polygon fill="#A80036" points="922.3611,1201.0363,932.3611,1205.0363,922.3611,1209.0363,926.3611,1205.0363" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="671.1509" x2="928.3611" y1="1205.0363" y2="1205.0363"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34.658" x="678.1509" y="1199.2273">HEAD</text></g><g class="message" data-participant-1="StateObj" data-participant-2="S3"><polygon fill="#A80036" points="682.1509,1232.7423,672.1509,1236.7423,682.1509,1240.7423,678.1509,1236.7423" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="676.1509" x2="933.3611" y1="1236.7423" y2="1236.7423"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66.9631" x="688.1509" y="1230.9333">size + ETag</text></g><g class="message" data-participant-1="S3" data-participant-2="Handler"><polygon fill="#A80036" points="361.8623,1264.4483,351.8623,1268.4483,361.8623,1272.4483,357.8623,1268.4483" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="355.8623" x2="670.1509" y1="1268.4483" y2="1268.4483"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23.725" x="367.8623" y="1262.6393">info</text></g><g class="message" data-participant-1="Handler" data-participant-2="S3"><polygon fill="#A80036" points="659.1509,1296.1543,669.1509,1300.1543,659.1509,1304.1543,663.1509,1300.1543" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="350.8623" x2="665.1509" y1="1300.1543" y2="1300.1543"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.2941" x="357.8623" y="1294.3453">GetObject(state)</text></g><g class="message" data-participant-1="S3" data-participant-2="Handler"><polygon fill="#A80036" points="361.8623,1327.8603,351.8623,1331.8603,361.8623,1335.8603,357.8623,1331.8603" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="355.8623" x2="670.1509" y1="1331.8603" y2="1331.8603"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77.1681" x="367.8623" y="1326.0513">stream JSON</text></g><g class="message" data-participant-1="Handler" data-participant-2="Client"><polygon fill="#A80036" points="52.8369,1377.2724,42.8369,1381.2724,52.8369,1385.2724,48.8369,1381.2724" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="46.8369" x2="349.8623" y1="1381.2724" y2="1381.2724"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.757" x="58.8369" y="1357.7573">200 stream</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285.0253" x="58.8369" y="1375.4634">headers: ETag, X-Key-Version, X-Fencing-Token</text></g><rect fill="#EEEEEE" filter="url(#f1l8vejm5ueg6n)" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1011.1068" x="0" y="1418.1254"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1011.1068" y1="1418.1254" y2="1418.1254"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1011.1068" y1="1421.1254" y2="1421.1254"/><rect fill="#EEEEEE" filter="url(#f1l8vejm5ueg6n)" height="25.706" style="stroke:#000000;stroke-width:2;" width="98.8251" x="456.1409" y="1406.2724"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="81.4451" x="462.1409" y="1424.1694">UpdateState</text><g class="message" data-participant-1="Client" data-participant-2="Handler"><polygon fill="#A80036" points="338.8623,1479.3904,348.8623,1483.3904,338.8623,1487.3904,342.8623,1483.3904" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="41.8369" x2="344.8623" y1="1483.3904" y2="1483.3904"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.8271" x="48.8369" y="1459.8754">POST /v1/update_state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221.9622" x="48.8369" y="1477.5814">body, CAS headers, X-Fencing-Token</text></g><g class="message" data-participant-1="Handler" data-participant-2="Compactor"><polygon fill="#A80036" points="513.6984,1511.0964,523.6984,1515.0964,513.6984,1519.0964,517.6984,1515.0964" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="350.8623" x2="519.6984" y1="1515.0964" y2="1515.0964"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86.5801" x="357.8623" y="1509.2874">compact JSON</text></g><g class="message" data-participant-1="Compactor" data-participant-2="Handler"><polygon fill="#A80036" points="361.8623,1542.8024,351.8623,1546.8024,361.8623,1550.8024,357.8623,1546.8024" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="355.8623" x2="524.6984" y1="1546.8024" y2="1546.8024"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.069" x="367.8623" y="1540.9934">stream</text></g><g class="message" data-participant-1="Handler" data-participant-2="S3"><polygon fill="#A80036" points="659.1509,1592.2145,669.1509,1596.2145,659.1509,1600.2145,663.1509,1596.2145" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="350.8623" x2="665.1509" y1="1596.2145" y2="1596.2145"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.3302" x="357.8623" y="1572.6995">PutObject(state, stream)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.0102" x="357.8623" y="1590.4055">If-Match expected_etag (optional)</text></g><path d="M286.4464,1611.2145 L348.9054,1611.2145 L348.9054,1620.9205 L338.9054,1630.9205 L286.4464,1630.9205 L286.4464,1611.2145" fill="#EEEEEE" style="stroke:#000000;stroke-width:1;"/><rect fill="none" height="148.5301" style="stroke:#000000;stroke-width:2;" width="714.6604" x="286.4464" y="1611.2145"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.459" x="301.4464" y="1626.1115">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="111.7922" x="363.9054" y="1624.9734">[Precondition failed]</text><g class="message" data-participant-1="S3" data-participant-2="Handler"><polygon fill="#A80036" points="361.8623,1650.6265,351.8623,1654.6265,361.8623,1658.6265,357.8623,1654.6265" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="355.8623" x2="670.1509" y1="1654.6265" y2="1654.6265"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.4131" x="367.8623" y="1648.8175">ErrCASMismatch</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="286.4464" x2="1001.1068" y1="1663.6265" y2="1663.6265"/><g class="message" data-participant-1="S3" data-participant-2="StateObj"><polygon fill="#A80036" points="922.3611,1684.3325,932.3611,1688.3325,922.3611,1692.3325,926.3611,1688.3325" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="671.1509" x2="928.3611" y1="1688.3325" y2="1688.3325"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.5351" x="678.1509" y="1682.5235">store (multipart if large)</text></g><g class="message" data-participant-1="StateObj" data-participant-2="S3"><polygon fill="#A80036" points="682.1509,1716.0385,672.1509,1720.0385,682.1509,1724.0385,678.1509,1720.0385" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="676.1509" x2="933.3611" y1="1720.0385" y2="1720.0385"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.9271" x="688.1509" y="1714.2295">new ETag + size</text></g><g class="message" data-participant-1="S3" data-participant-2="Handler"><polygon fill="#A80036" points="361.8623,1747.7446,351.8623,1751.7446,361.8623,1755.7446,357.8623,1751.7446" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="355.8623" x2="670.1509" y1="1751.7446" y2="1751.7446"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134.4201" x="367.8623" y="1745.9355">new_state_etag, bytes</text></g><g class="message" data-participant-1="Handler" data-participant-2="S3"><polygon fill="#A80036" points="659.1509,1804.1566,669.1509,1808.1566,659.1509,1812.1566,663.1509,1808.1566" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="350.8623" x2="665.1509" y1="1808.1566" y2="1808.1566"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.3402" x="357.8623" y="1784.6416">PutObject(meta, version+1, state_etag)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.0541" x="357.8623" y="1802.3476">If-Match meta_etag</text></g><g class="message" data-participant-1="S3" data-participant-2="Handler"><polygon fill="#A80036" points="361.8623,1835.8626,351.8623,1839.8626,361.8623,1843.8626,357.8623,1839.8626" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="355.8623" x2="670.1509" y1="1839.8626" y2="1839.8626"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.9141" x="367.8623" y="1834.0536">new_meta_etag</text></g><g class="message" data-participant-1="Handler" data-participant-2="Client"><polygon fill="#A80036" points="52.8369,1885.2746,42.8369,1889.2746,52.8369,1893.2746,48.8369,1889.2746" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="46.8369" x2="349.8623" y1="1889.2746" y2="1889.2746"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252.9932" x="58.8369" y="1865.7596">200 {new_version, new_state_etag, bytes}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285.0253" x="58.8369" y="1883.4656">headers: ETag, X-Key-Version, X-Fencing-Token</text></g><rect fill="#EEEEEE" filter="url(#f1l8vejm5ueg6n)" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1011.1068" x="0" y="1919.1276"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1011.1068" y1="1919.1276" y2="1919.1276"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1011.1068" y1="1922.1276" y2="1922.1276"/><rect fill="#EEEEEE" filter="url(#f1l8vejm5ueg6n)" height="25.706" style="stroke:#000000;stroke-width:2;" width="67.287" x="471.9099" y="1907.2746"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="49.907" x="477.9099" y="1925.1716">Release</text><g class="message" data-participant-1="Client" data-participant-2="Handler"><polygon fill="#A80036" points="338.8623,1962.6867,348.8623,1966.6867,338.8623,1970.6867,342.8623,1966.6867" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="41.8369" x2="344.8623" y1="1966.6867" y2="1966.6867"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.7141" x="48.8369" y="1960.8777">POST /v1/release</text></g><g class="message" data-participant-1="Handler" data-participant-2="S3"><polygon fill="#A80036" points="659.1509,2012.0987,669.1509,2016.0987,659.1509,2020.0987,663.1509,2016.0987" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="350.8623" x2="665.1509" y1="2016.0987" y2="2016.0987"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186.3292" x="357.8623" y="1992.5837">PutObject(meta, lease cleared)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.0541" x="357.8623" y="2010.2897">If-Match meta_etag</text></g><g class="message" data-participant-1="S3" data-participant-2="Handler"><polygon fill="#A80036" points="361.8623,2043.8047,351.8623,2047.8047,361.8623,2051.8047,357.8623,2047.8047" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="355.8623" x2="670.1509" y1="2047.8047" y2="2047.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.9141" x="367.8623" y="2041.9957">new_meta_etag</text></g><g class="message" data-participant-1="Handler" data-participant-2="Client"><polygon fill="#A80036" points="52.8369,2075.5107,42.8369,2079.5107,52.8369,2083.5107,48.8369,2079.5107" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="46.8369" x2="349.8623" y1="2079.5107" y2="2079.5107"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.7141" x="58.8369" y="2073.7017">200 {released:true}</text></g><!--SRC=[hLNHRjem57tFLrpnCbZ9Q4UVeb49jNJj9WfgsDO796II2tK9TXOREZRrttVj92pGfApQ-a31z_ZwdfDpd3TmWPhn24EOHV8HPZ81l-q6SXappQSHmfG52nGXrFjSN0zQtMz-mt7KWWj8f4B7OO6cFUSHHw6Tc2MQ1pncGaFjQZGQmXKJOOH93PZAl- -YFlc36pWtvvb65hVzjOlqs-3J8a9zoGMNxbmsBDnlEo7JRCeKGcr9T5eV5hWvU_UWfB20FgqDfWy5bD9CupxCDui6vtGwq0s-hpYTrUauAJTmpt827Wm7_WXQwvCMIs5ELZ4Wl-t1HzJK20DTtvkduH0B0cKZ4R8tSbYauKPg4dybGWVeBok3c_KxFJwrwsPpSOvUaj36IxiF8s9sMTd2wdm4lH6RbxOoWrATFkSEFUyYeoqcGb9lmiCcp504NCp1wq2SuFheP5-1uQgeG1DMCQbFBhCj6cDnFNFxJ0Vt8ADmOWu5SX4jtaY1MQNsjcQb6IOOI15opQM0cJLhbHZdNR_FrT9iJ_NmLq60Ictn1UMLyLAfL08VgtMYuiHGcZnNYc2fLpnuVtoSM-WMLIo5mh6uSozJsToHf4nPdtr6ZBiHNnzqseA0p02VzpaWlQ63Fs8QHHM5_qEYL9XAKLuMf4gCBK_Bcl9XqtQ8z1prn6PrdwFPdP6qzKP9Y0w5fM2AFFeUNFMw5saXMzeAeFXFV2b0NCoaBLJU1TcaPPkLJf0jRKXtU-p9cEB6uXvPY8dox3XDk7C_uyRzIYkK4VDpro36fKRsBpQ4VwLycjTK_B6Ood3J14eNP0S_FwF0Udj_Un2aNrDYs_KoxjKkjZCqCrZHmMHggcDsVzHbR6u85ZN-zTOeDORANZshI7FpMW8-WuWby_o1xjibpmjPnZYdyYwnx2o39amt6jN-xLiMwNNwf8zEZ2pv_kfmlpwklmnidVkfTCwdrxhGEF0MxGlWaFkI57P8XhHNGFyI3Fyh_Mo0qDF92f-Stm00]--></g></svg>