syntax = "proto3";

package lockd.internal;

option go_package = "pkt.systems/lockd/internal/proto;proto";

import "google/protobuf/struct.proto";

message Lease {
  string lease_id = 1;
  string owner = 2;
  int64 expires_at_unix = 3;
  int64 fencing_token = 4;
  string txn_id = 5;
}

message LockMeta {
  Lease lease = 1;
  int64 version = 2;
  string state_etag = 3;
  int64 updated_at_unix = 4;
  int64 fencing_token = 5;
  bytes state_descriptor = 6;
  int64 state_plaintext_bytes = 7;
  int64 published_version = 8;
  google.protobuf.Struct attributes = 9;
  string staged_txn_id = 10;
  string staged_state_etag = 11;
  bytes staged_state_descriptor = 12;
  int64 staged_state_plaintext_bytes = 13;
  int64 staged_version = 14;
  map<string,string> staged_attributes = 15;
  bool staged_remove = 16;
  repeated Attachment attachments = 17;
  repeated StagedAttachment staged_attachments = 18;
  repeated string staged_attachment_deletes = 19;
  bool staged_attachments_clear = 20;
}

message Attachment {
  string id = 1;
  string name = 2;
  int64 size = 3;
  string content_type = 4;
  bytes descriptor = 5;
  int64 created_at_unix = 6;
  int64 updated_at_unix = 7;
  int64 plaintext_bytes = 8;
}

message StagedAttachment {
  string id = 1;
  string name = 2;
  int64 size = 3;
  string content_type = 4;
  bytes staged_descriptor = 5;
  int64 created_at_unix = 6;
  int64 updated_at_unix = 7;
  int64 plaintext_bytes = 8;
}

message MetaRecord {
  string etag = 1;
  LockMeta meta = 2;
}

message NamespaceQueryConfig {
  string preferred_engine = 1;
  string fallback_engine = 2;
}

message NamespaceConfig {
  NamespaceQueryConfig query = 1;
}

message QueueMessageMeta {
  string type = 1;
  string queue = 2;
  string id = 3;
  int64 enqueued_at_unix = 4;
  int64 updated_at_unix = 5;
  int32 attempts = 6;
  int32 max_attempts = 7;
  int64 not_visible_until_unix = 8;
  int64 visibility_timeout_seconds = 9;
  google.protobuf.Struct attributes = 10;
  google.protobuf.Value last_error = 11;
  int64 payload_bytes = 12;
  string payload_content_type = 13;
  optional int64 expires_at_unix = 14;
  string correlation_id = 15;
  bytes payload_descriptor = 16;
  bytes meta_descriptor = 17;
  string lease_id = 18;
  int64 lease_fencing_token = 19;
  string lease_txn_id = 20;
}
