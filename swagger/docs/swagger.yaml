basePath: /v1
consumes:
- application/json
definitions:
  api.AckRequest:
    properties:
      fencing_token:
        type: integer
      lease_id:
        type: string
      message_id:
        type: string
      meta_etag:
        type: string
      namespace:
        type: string
      queue:
        type: string
      state_etag:
        type: string
      state_fencing_token:
        type: integer
      state_lease_id:
        type: string
    type: object
  api.AckResponse:
    properties:
      acked:
        type: boolean
      correlation_id:
        type: string
    type: object
  api.AcquireRequest:
    properties:
      block_seconds:
        type: integer
      key:
        type: string
      namespace:
        type: string
      owner:
        type: string
      ttl_seconds:
        type: integer
    type: object
  api.AcquireResponse:
    properties:
      correlation_id:
        type: string
      expires_at_unix:
        type: integer
      fencing_token:
        type: integer
      key:
        type: string
      lease_id:
        type: string
      namespace:
        type: string
      owner:
        type: string
      retry_after_seconds:
        type: integer
      state_etag:
        type: string
      version:
        type: integer
    type: object
  api.DequeueRequest:
    properties:
      namespace:
        type: string
      owner:
        type: string
      page_size:
        type: integer
      queue:
        type: string
      start_after:
        type: string
      visibility_timeout_seconds:
        type: integer
      wait_seconds:
        type: integer
    type: object
  api.DescribeResponse:
    properties:
      expires_at_unix:
        type: integer
      key:
        type: string
      lease_id:
        type: string
      metadata:
        $ref: '#/definitions/api.MetadataAttributes'
      namespace:
        type: string
      owner:
        type: string
      state_etag:
        type: string
      updated_at_unix:
        type: integer
      version:
        type: integer
    type: object
  api.EnqueueResponse:
    properties:
      attempts:
        type: integer
      correlation_id:
        type: string
      max_attempts:
        type: integer
      message_id:
        type: string
      namespace:
        type: string
      not_visible_until_unix:
        type: integer
      payload_bytes:
        type: integer
      queue:
        type: string
      visibility_timeout_seconds:
        type: integer
    type: object
  api.ErrorResponse:
    properties:
      current_etag:
        type: string
      current_version:
        type: integer
      detail:
        type: string
      error:
        type: string
      retry_after_seconds:
        type: integer
    type: object
  api.ExtendRequest:
    properties:
      extend_by_seconds:
        type: integer
      fencing_token:
        type: integer
      lease_id:
        type: string
      message_id:
        type: string
      meta_etag:
        type: string
      namespace:
        type: string
      queue:
        type: string
      state_fencing_token:
        type: integer
      state_lease_id:
        type: string
    type: object
  api.ExtendResponse:
    properties:
      correlation_id:
        type: string
      lease_expires_at_unix:
        type: integer
      meta_etag:
        type: string
      state_lease_expires_at_unix:
        type: integer
      visibility_timeout_seconds:
        type: integer
    type: object
  api.InTerm:
    properties:
      any:
        items:
          type: string
        type: array
      field:
        type: string
    type: object
  api.KeepAliveRequest:
    properties:
      key:
        type: string
      lease_id:
        type: string
      namespace:
        type: string
      ttl_seconds:
        type: integer
    type: object
  api.KeepAliveResponse:
    properties:
      expires_at_unix:
        type: integer
    type: object
  api.MetadataAttributes:
    properties:
      query_hidden:
        type: boolean
    type: object
  api.MetadataUpdateResponse:
    properties:
      key:
        type: string
      metadata:
        $ref: '#/definitions/api.MetadataAttributes'
      namespace:
        type: string
      version:
        type: integer
    type: object
  api.NackRequest:
    properties:
      delay_seconds:
        type: integer
      fencing_token:
        type: integer
      last_error: {}
      lease_id:
        type: string
      message_id:
        type: string
      meta_etag:
        type: string
      namespace:
        type: string
      queue:
        type: string
      state_fencing_token:
        type: integer
      state_lease_id:
        type: string
    type: object
  api.NackResponse:
    properties:
      correlation_id:
        type: string
      meta_etag:
        type: string
      requeued:
        type: boolean
    type: object
  api.QueryRequest:
    properties:
      cursor:
        type: string
      fields:
        additionalProperties: {}
        type: object
      limit:
        type: integer
      namespace:
        type: string
      selector:
        $ref: '#/definitions/api.Selector'
    type: object
  api.QueryResponse:
    properties:
      cursor:
        type: string
      index_seq:
        type: integer
      keys:
        items:
          type: string
        type: array
      metadata:
        additionalProperties:
          type: string
        type: object
      namespace:
        type: string
    type: object
  api.RangeTerm:
    properties:
      field:
        type: string
      gt:
        type: number
      gte:
        type: number
      lt:
        type: number
      lte:
        type: number
    type: object
  api.ReleaseRequest:
    properties:
      key:
        type: string
      lease_id:
        type: string
      namespace:
        type: string
    type: object
  api.ReleaseResponse:
    properties:
      released:
        type: boolean
    type: object
  api.RemoveResponse:
    properties:
      new_version:
        type: integer
      removed:
        type: boolean
    type: object
  api.Selector:
    properties:
      and:
        items:
          $ref: '#/definitions/api.Selector'
        type: array
      eq:
        $ref: '#/definitions/api.Term'
      exists:
        type: string
      in:
        $ref: '#/definitions/api.InTerm'
      not:
        $ref: '#/definitions/api.Selector'
      or:
        items:
          $ref: '#/definitions/api.Selector'
        type: array
      prefix:
        $ref: '#/definitions/api.Term'
      range:
        $ref: '#/definitions/api.RangeTerm'
    type: object
  api.Term:
    properties:
      field:
        type: string
      value:
        type: string
    type: object
  api.UpdateResponse:
    properties:
      bytes:
        type: integer
      metadata:
        $ref: '#/definitions/api.MetadataAttributes'
      new_state_etag:
        type: string
      new_version:
        type: integer
    type: object
  httpapi.metadataMutation:
    properties:
      query_hidden:
        type: boolean
    type: object
info:
  contact:
    email: sa6mwa@gmail.com
    name: Michel Blomgren
    url: https://pkt.systems
  description: lockd exposes exclusive lease management, atomic JSON checkpoints,
    and resilient work queues over HTTPS.
  license:
    name: MIT
    url: https://opensource.org/license/mit/
  title: lockd API
  version: "0.0"
paths:
  /healthz:
    get:
      produces:
      - text/plain
      responses:
        "200":
          description: OK
          schema:
            type: string
      summary: Liveness probe
      tags:
      - system
  /readyz:
    get:
      produces:
      - text/plain
      responses:
        "200":
          description: Ready
          schema:
            type: string
      summary: Readiness probe
      tags:
      - system
  /v1/acquire:
    post:
      consumes:
      - application/json
      description: Acquire or wait for an exclusive lease on a key. When block_seconds
        > 0 the request will long-poll until a lease becomes available or the timeout
        elapses.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Key to acquire when the request body omits it
        in: query
        name: key
        type: string
      - description: Lease acquisition parameters
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.AcquireRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.AcquireResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Acquire an exclusive lease
      tags:
      - lease
  /v1/describe:
    get:
      description: Returns lease and state metadata without streaming the state payload.
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Lease key
        in: query
        name: key
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.DescribeResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Inspect metadata for a key
      tags:
      - lease
  /v1/get:
    post:
      consumes:
      - application/json
      description: Streams the currently committed JSON state for the key owned by
        the caller's lease (or, when public=1, the latest published snapshot). Returns
        204 when no state is present.
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Lease key
        in: query
        name: key
        required: true
        type: string
      - description: Set to true to read without a lease (served from published data)
        in: query
        name: public
        type: boolean
      - description: Lease identifier (required unless public=1)
        in: header
        name: X-Lease-ID
        type: string
      - description: Optional fencing token proof (lease requests only)
        in: header
        name: X-Fencing-Token
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Streamed JSON state
          schema:
            additionalProperties: true
            type: object
        "204":
          description: No state stored for this key
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Read the JSON checkpoint for a key
      tags:
      - lease
  /v1/keepalive:
    post:
      consumes:
      - application/json
      description: Refresh an existing lease before it expires. Returns the new expiration
        timestamp.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Key override when the request body omits it
        in: query
        name: key
        type: string
      - description: Lease keepalive parameters
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.KeepAliveRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.KeepAliveResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Extend an active lease TTL
      tags:
      - lease
  /v1/metadata:
    post:
      consumes:
      - application/json
      description: Mutates lock metadata (e.g. query visibility) while holding the
        lease. Optional CAS headers guard against concurrent updates.
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Lease key
        in: query
        name: key
        required: true
        type: string
      - description: Lease identifier
        in: header
        name: X-Lease-ID
        required: true
        type: string
      - description: Optional fencing token proof
        in: header
        name: X-Fencing-Token
        type: string
      - description: Conditionally update when the current version matches
        in: header
        name: X-If-Version
        type: string
      - description: Metadata payload
        in: body
        name: metadata
        required: true
        schema:
          $ref: '#/definitions/httpapi.metadataMutation'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.MetadataUpdateResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Update lock metadata
      tags:
      - lease
  /v1/query:
    post:
      consumes:
      - application/json
      description: Executes a selector-based search within a namespace and returns
        matching keys plus a cursor for pagination.
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Maximum number of keys to return (1-1000, defaults to 100)
        in: query
        name: limit
        type: integer
      - description: Opaque pagination cursor
        in: query
        name: cursor
        type: string
      - description: Selector JSON (optional when providing a JSON body)
        in: query
        name: selector
        type: string
      - description: Query request (selector, limit, cursor)
        in: body
        name: request
        schema:
          $ref: '#/definitions/api.QueryRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.QueryResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      summary: Query keys within a namespace
      tags:
      - lease
  /v1/queue/ack:
    post:
      consumes:
      - application/json
      description: Confirms processing of a delivery and deletes the message or its
        retry lease.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Acknowledgement payload
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.AckRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.AckResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Acknowledge a delivered message
      tags:
      - queue
  /v1/queue/dequeue:
    post:
      consumes:
      - application/json
      description: Performs a single dequeue attempt, optionally waiting for availability.
        Responses stream as multipart/related parts containing message metadata and
        payload.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Queue name override when the request body omits it
        in: query
        name: queue
        type: string
      - description: Owner override when the request body omits it
        in: query
        name: owner
        type: string
      - description: Dequeue parameters
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.DequeueRequest'
      produces:
      - multipart/related
      responses:
        "200":
          description: Multipart response with message metadata and optional payload
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Fetch one or more queue messages
      tags:
      - queue
  /v1/queue/dequeueWithState:
    post:
      consumes:
      - application/json
      description: Dequeues messages and includes their associated state blobs in
        the multipart response when available.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Queue name override when the request body omits it
        in: query
        name: queue
        type: string
      - description: Owner override when the request body omits it
        in: query
        name: owner
        type: string
      - description: Dequeue parameters
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.DequeueRequest'
      produces:
      - multipart/related
      responses:
        "200":
          description: Multipart response with message metadata, payload, and state
            attachments
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Fetch queue messages with state attachments
      tags:
      - queue
  /v1/queue/enqueue:
    post:
      consumes:
      - multipart/form-data
      description: Writes a message into the durable queue. The payload is streamed
        directly and may include optional attributes.
      parameters:
      - description: Namespace override when the metadata omits it
        in: query
        name: namespace
        type: string
      - description: Queue override when the metadata omits it
        in: query
        name: queue
        type: string
      - description: JSON encoded api.EnqueueRequest metadata
        in: formData
        name: meta
        required: true
        type: string
      - description: Optional payload stream
        in: formData
        name: payload
        type: file
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.EnqueueResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Enqueue a message
      tags:
      - queue
  /v1/queue/extend:
    post:
      consumes:
      - application/json
      description: Extends the visibility timeout and lease window for an in-flight
        message.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Extend payload
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.ExtendRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.ExtendResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Extend a delivery lease
      tags:
      - queue
  /v1/queue/nack:
    post:
      consumes:
      - application/json
      description: Requeues the delivery with optional delay and last error metadata.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Negative acknowledgement payload
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.NackRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.NackResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Return a message to the queue
      tags:
      - queue
  /v1/queue/subscribe:
    post:
      consumes:
      - application/json
      description: Opens a long-lived multipart stream of deliveries for the specified
        queue owner. Each part contains message metadata and payload.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Queue name override when the request body omits it
        in: query
        name: queue
        type: string
      - description: Owner override when the request body omits it
        in: query
        name: owner
        type: string
      - description: Subscription parameters (queue, owner, wait_seconds, visibility)
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.DequeueRequest'
      produces:
      - multipart/related
      responses:
        "200":
          description: Multipart stream of message deliveries
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Stream queue deliveries
      tags:
      - queue
  /v1/queue/subscribeWithState:
    post:
      consumes:
      - application/json
      description: Opens a long-lived multipart stream where each part contains message
        metadata, payload, and state snapshot when available.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Queue name override when the request body omits it
        in: query
        name: queue
        type: string
      - description: Owner override when the request body omits it
        in: query
        name: owner
        type: string
      - description: Subscription parameters (queue, owner, wait_seconds, visibility)
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.DequeueRequest'
      produces:
      - multipart/related
      responses:
        "200":
          description: Multipart stream of message deliveries
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Stream queue deliveries with state
      tags:
      - queue
  /v1/release:
    post:
      consumes:
      - application/json
      description: Releases the lease associated with the provided key and lease identifier.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Key override when the request body omits it
        in: query
        name: key
        type: string
      - description: Lease release parameters
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.ReleaseRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.ReleaseResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Release a held lease
      tags:
      - lease
  /v1/remove:
    post:
      consumes:
      - application/json
      description: Removes the stored state blob if the caller holds the lease. Optional
        CAS headers guard against concurrent updates.
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Lease key
        in: query
        name: key
        required: true
        type: string
      - description: Lease identifier
        in: header
        name: X-Lease-ID
        required: true
        type: string
      - description: Optional fencing token proof
        in: header
        name: X-Fencing-Token
        type: string
      - description: Conditionally remove when version matches
        in: header
        name: X-If-Version
        type: string
      - description: Conditionally remove when state ETag matches
        in: header
        name: X-If-State-ETag
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.RemoveResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Delete the JSON state for a key
      tags:
      - lease
  /v1/update:
    post:
      consumes:
      - application/json
      description: Streams JSON from the request body, compacts it, and installs it
        if the caller holds the lease. Optional CAS headers guard against concurrent
        updates.
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Lease key
        in: query
        name: key
        required: true
        type: string
      - description: Lease identifier
        in: header
        name: X-Lease-ID
        required: true
        type: string
      - description: Optional fencing token proof
        in: header
        name: X-Fencing-Token
        type: string
      - description: Conditionally update when the current version matches
        in: header
        name: X-If-Version
        type: string
      - description: Conditionally update when the state ETag matches
        in: header
        name: X-If-State-ETag
        type: string
      - description: New JSON state payload
        in: body
        name: state
        required: true
        schema:
          type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.UpdateResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Atomically update the JSON state for a key
      tags:
      - lease
produces:
- application/json
schemes:
- https
- http
securityDefinitions:
  mTLS:
    description: Mutual TLS is required in production deployments; place holder header
      documents client certificate identity propagation.
    in: header
    name: X-Client-Cert
    type: apiKey
swagger: "2.0"
tags:
- description: Lease acquisition, keepalive, release, and state management.
  name: lease
- description: Queue enqueue, dequeue, acknowledgement, and lifecycle operations.
  name: queue
- description: Service health and readiness probes.
  name: system
