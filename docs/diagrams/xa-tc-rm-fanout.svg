<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1379px" preserveAspectRatio="none" style="width:1427px;height:1379px;background:#FFFFFF;" version="1.1" viewBox="0 0 1427 1379" width="1427px" zoomAndPan="magnify">
  <rect width="100%" height="100%" fill="#ffffff"/><title>TC decision + RM fan-out (multi-backend, commit)</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="347.3106" x="535.935" y="29.9659">TC decision + RM fan-out (multi-backend, commit)</text><rect fill="none" height="100.0999" style="stroke:#000000;stroke-width:1.5;" width="319.1997" x="260.6642" y="222.2539"/><rect fill="none" height="200.924" style="stroke:#000000;stroke-width:1.5;" width="651.107" x="435.4142" y="336.3538"/><rect fill="none" height="135.512" style="stroke:#000000;stroke-width:1.5;" width="631.107" x="445.4142" y="394.7659"/><rect fill="none" height="132.5301" style="stroke:#000000;stroke-width:1.5;" width="631.107" x="445.4142" y="596.9838"/><rect fill="none" height="200.924" style="stroke:#000000;stroke-width:1.5;" width="664.57" x="745.6106" y="870.338"/><rect fill="none" height="135.512" style="stroke:#000000;stroke-width:1.5;" width="644.57" x="755.6106" y="928.75"/><rect fill="none" height="132.5301" style="stroke:#000000;stroke-width:1.5;" width="644.57" x="755.6106" y="1085.262"/><g><title>lockd RM .implicit XA.</title><rect fill="#000000" fill-opacity="0.00000" height="1188.0683" width="8" x="78.3427" y="110.1358"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="82" x2="82" y1="110.1358" y2="1298.2041"/></g><g><title>lockd TC endpoint</title><rect fill="#000000" fill-opacity="0.00000" height="1188.0683" width="8" x="332.8419" y="110.1358"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="336.6642" x2="336.6642" y1="110.1358" y2="1298.2041"/></g><g><title>lockd TC leader</title><rect fill="#000000" fill-opacity="0.00000" height="1188.0683" width="8" x="508.639" y="110.1358"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="512.4142" x2="512.4142" y1="110.1358" y2="1298.2041"/></g><g><title>lockd RM .backend B.</title><rect fill="#000000" fill-opacity="0.00000" height="1188.0683" width="8" x="838.8763" y="110.1358"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="842.6106" x2="842.6106" y1="110.1358" y2="1298.2041"/></g><g><title>TC backend .A.</title><rect fill="#000000" fill-opacity="0.00000" height="1188.0683" width="8" x="1010.9834" y="110.1358"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1014.4456" x2="1014.4456" y1="110.1358" y2="1298.2041"/></g><g><title>Backend B</title><rect fill="#000000" fill-opacity="0.00000" height="1188.0683" width="8" x="1348.6567" y="110.1358"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1352.1328" x2="1352.1328" y1="110.1358" y2="1298.2041"/></g><g class="participant participant-head" data-participant="RM"><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="154.6854" x="5" y="76.0679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140.6854" x="12" y="98.0339">lockd RM (implicit XA)</text></g><g class="participant participant-tail" data-participant="RM"><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="154.6854" x="5" y="1297.2041"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140.6854" x="12" y="1319.17">lockd RM (implicit XA)</text></g><g class="participant participant-head" data-participant="TC"><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="132.3555" x="270.6642" y="76.0679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118.3555" x="277.6642" y="98.0339">lockd TC endpoint</text></g><g class="participant participant-tail" data-participant="TC"><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="132.3555" x="270.6642" y="1297.2041"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118.3555" x="277.6642" y="1319.17">lockd TC endpoint</text></g><g class="participant participant-head" data-participant="Leader"><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114.4496" x="455.4142" y="76.0679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100.4496" x="462.4142" y="98.0339">lockd TC leader</text></g><g class="participant participant-tail" data-participant="Leader"><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114.4496" x="455.4142" y="1297.2041"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100.4496" x="462.4142" y="1319.17">lockd TC leader</text></g><g class="participant participant-head" data-participant="RMB"><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="154.5314" x="765.6106" y="76.0679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140.5314" x="772.6106" y="98.0339">lockd RM (backend B)</text></g><g class="participant participant-tail" data-participant="RMB"><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="154.5314" x="765.6106" y="1297.2041"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140.5314" x="772.6106" y="1319.17">lockd RM (backend B)</text></g><g class="participant participant-head" data-participant="BA"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.0756" x="963.4456" y="106.0339">TC backend (A)</text><path d="M996.9834,55.0679 C996.9834,45.0679 1014.9834,45.0679 1014.9834,45.0679 C1014.9834,45.0679 1032.9834,45.0679 1032.9834,55.0679 L1032.9834,81.0679 C1032.9834,91.0679 1014.9834,91.0679 1014.9834,91.0679 C1014.9834,91.0679 996.9834,91.0679 996.9834,81.0679 L996.9834,55.0679" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M996.9834,55.0679 C996.9834,65.0679 1014.9834,65.0679 1014.9834,65.0679 C1014.9834,65.0679 1032.9834,65.0679 1032.9834,55.0679" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="BA"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.0756" x="963.4456" y="1312.17">TC backend (A)</text><path d="M996.9834,1326.272 C996.9834,1316.272 1014.9834,1316.272 1014.9834,1316.272 C1014.9834,1316.272 1032.9834,1316.272 1032.9834,1326.272 L1032.9834,1352.272 C1032.9834,1362.272 1014.9834,1362.272 1014.9834,1362.272 C1014.9834,1362.272 996.9834,1362.272 996.9834,1352.272 L996.9834,1326.272" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M996.9834,1326.272 C996.9834,1336.272 1014.9834,1336.272 1014.9834,1336.272 C1014.9834,1336.272 1032.9834,1336.272 1032.9834,1326.272" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="BB"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69.0477" x="1315.1328" y="106.0339">Backend B</text><path d="M1334.6567,55.0679 C1334.6567,45.0679 1352.6567,45.0679 1352.6567,45.0679 C1352.6567,45.0679 1370.6567,45.0679 1370.6567,55.0679 L1370.6567,81.0679 C1370.6567,91.0679 1352.6567,91.0679 1352.6567,91.0679 C1352.6567,91.0679 1334.6567,91.0679 1334.6567,81.0679 L1334.6567,55.0679" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1334.6567,55.0679 C1334.6567,65.0679 1352.6567,65.0679 1352.6567,65.0679 C1352.6567,65.0679 1370.6567,65.0679 1370.6567,55.0679" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="BB"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69.0477" x="1315.1328" y="1312.17">Backend B</text><path d="M1334.6567,1326.272 C1334.6567,1316.272 1352.6567,1316.272 1352.6567,1316.272 C1352.6567,1316.272 1370.6567,1316.272 1370.6567,1326.272 L1370.6567,1352.272 C1370.6567,1362.272 1352.6567,1362.272 1352.6567,1362.272 C1352.6567,1362.272 1334.6567,1362.272 1334.6567,1352.272 L1334.6567,1326.272" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1334.6567,1326.272 C1334.6567,1336.272 1352.6567,1336.272 1352.6567,1336.272 C1352.6567,1336.272 1370.6567,1336.272 1370.6567,1326.272" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1420.1805" x="0" y="141.9888"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1420.1805" y1="141.9888" y2="141.9888"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1420.1805" y1="144.9888" y2="144.9888"/><rect fill="#EEEEEE" height="25.706" style="stroke:#000000;stroke-width:2;" width="119.4561" x="650.3622" y="130.1358"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102.0761" x="656.3622" y="148.0328">Record decision</text><g class="message" data-participant-1="RM" data-participant-2="TC"><polygon fill="#181818" points="324.8419,203.2539,334.8419,207.2539,324.8419,211.2539,328.8419,207.2539" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="82.3427" x2="330.8419" y1="207.2539" y2="207.2539"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="89.3427" y="192.5919">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219.0632" x="100.7787" y="183.7389">POST /v1/txn/decide (state=commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.8272" x="100.7787" y="201.4449">participants + backend_hash)</text></g><path d="M260.6642,222.2539 L323.1232,222.2539 L323.1232,231.9599 L313.1232,241.9599 L260.6642,241.9599 L260.6642,222.2539" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="100.0999" style="stroke:#000000;stroke-width:1.5;" width="319.1997" x="260.6642" y="222.2539"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.459" x="275.6642" y="237.1509">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="91.8273" x="338.1232" y="236.0128">[TC is not leader]</text><g class="message" data-participant-1="TC" data-participant-2="Leader"><polygon fill="#181818" points="500.639,261.6659,510.639,265.6659,500.639,269.6659,504.639,265.6659" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="336.8419" x2="506.639" y1="265.6659" y2="265.6659"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="343.8419" y="259.8569">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.3611" x="355.2779" y="259.8569">forward /v1/txn/decide</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="260.6642" x2="579.8638" y1="274.6659" y2="274.6659"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="70.1575" x="265.6642" y="286.4248">[TC is leader]</text><g class="message" data-participant-1="TC" data-participant-2="Leader"><polygon fill="#181818" points="500.639,310.3538,510.639,314.3538,500.639,318.3538,504.639,314.3538" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="336.8419" x2="506.639" y1="314.3538" y2="314.3538"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="343.8419" y="308.5448">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.5731" x="355.2779" y="308.5448">accept /v1/txn/decide</text></g><path d="M435.4142,336.3538 L508.7022,336.3538 L508.7022,346.0598 L498.7022,356.0598 L435.4142,356.0598 L435.4142,336.3538" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="200.924" style="stroke:#000000;stroke-width:1.5;" width="651.107" x="435.4142" y="336.3538"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.288" x="450.4142" y="351.2508">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="208.5365" x="523.7022" y="350.1127">[CAS retry (txn record on TC backend)]</text><g class="message" data-participant-1="Leader" data-participant-2="BA"><polygon fill="#181818" points="1002.9834,375.7659,1012.9834,379.7659,1002.9834,383.7659,1006.9834,379.7659" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="512.639" x2="1008.9834" y1="379.7659" y2="379.7659"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="519.639" y="373.9569">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184.8862" x="531.075" y="373.9569">get_txn_record(.txns/&lt;txn_id&gt;)</text></g><path d="M445.4142,394.7659 L507.8732,394.7659 L507.8732,404.4719 L497.8732,414.4719 L445.4142,414.4719 L445.4142,394.7659" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="135.512" style="stroke:#000000;stroke-width:1.5;" width="631.107" x="445.4142" y="394.7659"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.459" x="460.4142" y="409.6629">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="109.9112" x="522.8732" y="408.5248">[txn record missing]</text><g class="message" data-participant-1="Leader" data-participant-2="BA"><polygon fill="#181818" points="1002.9834,451.8839,1012.9834,455.8839,1002.9834,459.8839,1006.9834,455.8839" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="512.639" x2="1008.9834" y1="455.8839" y2="455.8839"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="519.639" y="441.2219">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.5602" x="531.075" y="432.3689">put_txn_record(state=commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="299.2213" x="531.075" y="450.0749">participants merged, tc_term) (expected_etag="")</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="445.4142" x2="1076.5212" y1="464.8839" y2="464.8839"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="99.1973" x="450.4142" y="476.6428">[txn record exists]</text><g class="message" data-participant-1="Leader" data-participant-2="BA"><polygon fill="#181818" points="1002.9834,518.2778,1012.9834,522.2778,1002.9834,526.2778,1006.9834,522.2778" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="512.639" x2="1008.9834" y1="522.2778" y2="522.2778"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="519.639" y="507.6158">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.5602" x="531.075" y="498.7628">put_txn_record(state=commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="341.3024" x="531.075" y="516.4688">participants merged, tc_term) (expected_etag=txn_etag)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1420.1805" x="0" y="566.1308"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1420.1805" y1="566.1308" y2="566.1308"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1420.1805" y1="569.1308" y2="569.1308"/><rect fill="#EEEEEE" height="25.706" style="stroke:#000000;stroke-width:2;" width="250.2231" x="584.9787" y="554.2778"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="232.8431" x="590.9787" y="572.1748">Apply local participants (backend A)</text><path d="M445.4142,596.9838 L518.7022,596.9838 L518.7022,606.6899 L508.7022,616.6899 L445.4142,616.6899 L445.4142,596.9838" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="132.5301" style="stroke:#000000;stroke-width:1.5;" width="631.107" x="445.4142" y="596.9838"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.288" x="460.4142" y="611.8809">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="174.6788" x="533.7022" y="610.7428">[apply participants (backend A)]</text><g class="message" data-participant-1="Leader" data-participant-2="BA"><polygon fill="#181818" points="1002.9834,636.3959,1012.9834,640.3959,1002.9834,644.3959,1006.9834,640.3959" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="512.639" x2="1008.9834" y1="640.3959" y2="640.3959"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="519.639" y="634.5869">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.8651" x="531.075" y="634.5869">load_meta(participant)</text></g><g class="message" data-participant-1="Leader" data-participant-2="BA"><polygon fill="#181818" points="1002.9834,668.1019,1012.9834,672.1019,1002.9834,676.1019,1006.9834,672.1019" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="512.639" x2="1008.9834" y1="672.1019" y2="672.1019"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="519.639" y="666.2929">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="466.9084" x="531.075" y="666.2929">write_state from state/&lt;key&gt;/.staging/&lt;txn_id&gt; (expected_etag=staged_etag)</text></g><g class="message" data-participant-1="Leader" data-participant-2="BA"><polygon fill="#181818" points="1002.9834,717.5139,1012.9834,721.5139,1002.9834,725.5139,1006.9834,721.5139" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="512.639" x2="1008.9834" y1="721.5139" y2="721.5139"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="519.639" y="706.8519">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.9902" x="531.075" y="697.9989">store_meta(expected_etag=meta_etag,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.1931" x="531.075" y="715.7049">clear lease + staging)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1420.1805" x="0" y="758.3669"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1420.1805" y1="758.3669" y2="758.3669"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1420.1805" y1="761.3669" y2="761.3669"/><rect fill="#EEEEEE" height="25.706" style="stroke:#000000;stroke-width:2;" width="166.1781" x="627.0012" y="746.5139"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148.7981" x="633.0012" y="764.4109">Fan-out to remote RMs</text><g class="message" data-participant-1="Leader" data-participant-2="BA"><polygon fill="#181818" points="1002.9834,801.926,1012.9834,805.926,1002.9834,809.926,1006.9834,805.926" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="512.639" x2="1008.9834" y1="805.926" y2="805.926"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="519.639" y="800.117">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246.4542" x="538.511" y="800.117">load_rm_registry(.lockd/tc-rm-members)</text></g><g class="message" data-participant-1="Leader" data-participant-2="RMB"><polygon fill="#181818" points="830.8763,851.338,840.8763,855.338,830.8763,859.338,834.8763,855.338" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="512.639" x2="836.8763" y1="855.338" y2="855.338"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="519.639" y="840.676">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287.3653" x="538.511" y="831.823">POST /v1/txn/commit (target_backend_hash=B,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.4442" x="538.511" y="849.529">participants=B, tc_term)</text></g><path d="M745.6106,870.338 L818.8986,870.338 L818.8986,880.044 L808.8986,890.044 L745.6106,890.044 L745.6106,870.338" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="200.924" style="stroke:#000000;stroke-width:1.5;" width="664.57" x="745.6106" y="870.338"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.288" x="760.6106" y="885.235">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="202.5525" x="833.8986" y="884.0969">[CAS retry (txn record on backend B)]</text><g class="message" data-participant-1="RMB" data-participant-2="BB"><polygon fill="#181818" points="1340.6567,909.75,1350.6567,913.75,1340.6567,917.75,1344.6567,913.75" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="842.8763" x2="1346.6567" y1="913.75" y2="913.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="849.8763" y="907.941">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184.8862" x="868.7483" y="907.941">get_txn_record(.txns/&lt;txn_id&gt;)</text></g><path d="M755.6106,928.75 L818.0696,928.75 L818.0696,938.456 L808.0696,948.456 L755.6106,948.456 L755.6106,928.75" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="135.512" style="stroke:#000000;stroke-width:1.5;" width="644.57" x="755.6106" y="928.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.459" x="770.6106" y="943.647">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="109.9112" x="833.0696" y="942.5089">[txn record missing]</text><g class="message" data-participant-1="RMB" data-participant-2="BB"><polygon fill="#181818" points="1340.6567,985.8681,1350.6567,989.8681,1340.6567,993.8681,1344.6567,989.8681" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="842.8763" x2="1346.6567" y1="989.8681" y2="989.8681"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="849.8763" y="975.2061">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.5602" x="868.7483" y="966.3531">put_txn_record(state=commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="299.2213" x="868.7483" y="984.0591">participants merged, tc_term) (expected_etag="")</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="755.6106" x2="1400.1805" y1="998.8681" y2="998.8681"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="99.1973" x="760.6106" y="1010.627">[txn record exists]</text><g class="message" data-participant-1="RMB" data-participant-2="BB"><polygon fill="#181818" points="1340.6567,1052.262,1350.6567,1056.262,1340.6567,1060.262,1344.6567,1056.262" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="842.8763" x2="1346.6567" y1="1056.262" y2="1056.262"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="849.8763" y="1041.6">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.5602" x="868.7483" y="1032.747">put_txn_record(state=commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="341.3024" x="868.7483" y="1050.453">participants merged, tc_term) (expected_etag=txn_etag)</text></g><path d="M755.6106,1085.262 L828.8986,1085.262 L828.8986,1094.968 L818.8986,1104.968 L755.6106,1104.968 L755.6106,1085.262" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="132.5301" style="stroke:#000000;stroke-width:1.5;" width="644.57" x="755.6106" y="1085.262"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.288" x="770.6106" y="1100.159">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="174.4808" x="843.8986" y="1099.0209">[apply participants (backend B)]</text><g class="message" data-participant-1="RMB" data-participant-2="BB"><polygon fill="#181818" points="1340.6567,1124.674,1350.6567,1128.674,1340.6567,1132.674,1344.6567,1128.674" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="842.8763" x2="1346.6567" y1="1128.674" y2="1128.674"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="849.8763" y="1122.865">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.8651" x="868.7483" y="1122.865">load_meta(participant)</text></g><g class="message" data-participant-1="RMB" data-participant-2="BB"><polygon fill="#181818" points="1340.6567,1156.38,1350.6567,1160.38,1340.6567,1164.38,1344.6567,1160.38" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="842.8763" x2="1346.6567" y1="1160.38" y2="1160.38"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="849.8763" y="1154.571">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="466.9084" x="868.7483" y="1154.571">write_state from state/&lt;key&gt;/.staging/&lt;txn_id&gt; (expected_etag=staged_etag)</text></g><g class="message" data-participant-1="RMB" data-participant-2="BB"><polygon fill="#181818" points="1340.6567,1205.7921,1350.6567,1209.7921,1340.6567,1213.7921,1344.6567,1209.7921" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="842.8763" x2="1346.6567" y1="1209.7921" y2="1209.7921"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="849.8763" y="1195.1301">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.9902" x="868.7483" y="1186.2771">store_meta(expected_etag=meta_etag,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.1931" x="868.7483" y="1203.9831">clear lease + staging)</text></g><g class="message" data-participant-1="RMB" data-participant-2="Leader"><polygon fill="#181818" points="523.639,1244.4981,513.639,1248.4981,523.639,1252.4981,519.639,1248.4981" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="517.639" x2="841.8763" y1="1248.4981" y2="1248.4981"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="529.639" y="1242.6891">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22.308" x="548.511" y="1242.6891">200</text></g><g class="message" data-participant-1="Leader" data-participant-2="RM"><polygon fill="#181818" points="93.3427,1276.2041,83.3427,1280.2041,93.3427,1284.2041,89.3427,1280.2041" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="87.3427" x2="511.639" y1="1280.2041" y2="1280.2041"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="99.3427" y="1274.3951">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109.8241" x="118.2147" y="1274.3951">200 state=commit</text></g><!--SRC=[lLHDRzf04BtxLumusKh0QOyeHi98FJLgHJZqKCbQxC5PuVLQkqC3_xwpQmFcApcawG5fc9rvRpxUc2HL28iP59XBAtKDTp1_WfMeXtf34AfDHNAu5FaQw-8USgsKf2WG6zBrHYtH144Z3CbSDg8c65GwNnSE8PIggTXDy6iQ3K1OTbuBPMf6RhIioKSjPZUYAXG56X_ptPktYBjY8TtJfa4XI2o5HHWmqFuzxEfAfxttT9_SFgL1a2GmnroRuZYY90cOQ3ZXiiRmyyVp0k8_NsBQrh4BAH12Iu8mQQTr_xlkLMfvm5q5sOkmBppBYbn_qaAjgMip0ETYXhRLCQoqUHLSmobHW9N5Blb6eiXpREWYhow2Iki6PjDdC4Xc1o4_i-axvHwFWueOiqLpkEbq32LInj5P6nsEsBRne_F8OkB2NKizE2MjbNN93-T8pUO4wQsnAJGbiWGfpmYDYY34ROCvOP4XYJ8P31op7qYF6hVIalrSPWVZ3C_FWtK_9vjfqrGxO66A2au03nATHavBVX721zyAkrX1fKMHAMODUocNOQz64cQ-ELWPhS2RyUCQTvDun7zAtijXTUUDkVVEleIsf0ss9PncEPUtU8uvgz8uQV9Mxg3ZYmuJ-jPzPaZplfJc8kTFretaIhD6yQvAtgRPXID_xJ7bGwE62jrto4Qz9BxviyDiDyiY5yQfjt-1INgsS7OSTltEbHo_DJmVPlKLfn-xa1xC_poFpw6zTXllwlrycZV5telvfqhluNvKvXwgzpt- -l1m4AfNgdT1VyR1Nm00]--></g></svg>