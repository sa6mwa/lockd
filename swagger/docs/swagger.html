<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>lockd API reference</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist@5/swagger-ui.css">
  <style>
    body { margin: 0; background: #f7f7f7; }
  </style>
</head>
<body>
  <div id="swagger-ui"></div>
  <script src="https://unpkg.com/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
  <script src="https://unpkg.com/swagger-ui-dist@5/swagger-ui-standalone-preset.js"></script>
  <script>
    window.onload = function() {
      const spec = {"consumes":["application/json"],"produces":["application/json"],"schemes":["https","http"],"swagger":"2.0","info":{"description":"lockd exposes exclusive lease management, atomic JSON checkpoints, and resilient work queues over HTTPS.","title":"lockd API","contact":{"name":"Michel Blomgren","url":"https://pkt.systems","email":"sa6mwa@gmail.com"},"license":{"name":"MIT","url":"https://opensource.org/license/mit/"},"version":"0.0"},"basePath":"/v1","paths":{"/healthz":{"get":{"produces":["text/plain"],"tags":["system"],"summary":"Liveness probe","responses":{"200":{"description":"OK","schema":{"type":"string"}}}}},"/readyz":{"get":{"produces":["text/plain"],"tags":["system"],"summary":"Readiness probe","responses":{"200":{"description":"Ready","schema":{"type":"string"}}}}},"/v1/acquire":{"post":{"security":[{"mTLS":[]}],"description":"Acquire or wait for an exclusive lease on a key. When block_seconds \u003e 0 the request will long-poll until a lease becomes available or the timeout elapses. Returns a compact xid-based `lease_id` and `txn_id` (20-char lowercase base32, e.g. `c5v9d0sl70b3m3q8ndg0`) that must be echoed on write operations. Namespaces starting with `.` are reserved (e.g. `.txns`) and will be rejected.","consumes":["application/json"],"produces":["application/json"],"tags":["lease"],"summary":"Acquire an exclusive lease","parameters":[{"type":"string","description":"Namespace override when the request body omits it","name":"namespace","in":"query"},{"type":"string","description":"Key to acquire when the request body omits it","name":"key","in":"query"},{"type":"string","description":"Existing transaction identifier (xid) to join a multi-key transaction","name":"X-Txn-ID","in":"header"},{"description":"Lease acquisition parameters","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.AcquireRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.AcquireResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/attachment":{"get":{"security":[{"mTLS":[]}],"description":"Streams a single attachment (GET) or stages its deletion (DELETE).","consumes":["application/json"],"produces":["application/octet-stream"],"tags":["lease"],"summary":"Retrieve or delete a state attachment","parameters":[{"type":"string","description":"Namespace override (defaults to server setting)","name":"namespace","in":"query"},{"type":"string","description":"Lease key","name":"key","in":"query","required":true},{"type":"string","description":"Attachment name","name":"name","in":"query"},{"type":"string","description":"Attachment id","name":"id","in":"query"},{"type":"boolean","description":"Set to true to read without a lease (GET)","name":"public","in":"query"},{"type":"string","description":"Lease identifier (required unless public=1)","name":"X-Lease-ID","in":"header"},{"type":"string","description":"Transaction identifier (required for lease operations)","name":"X-Txn-ID","in":"header"},{"type":"string","description":"Optional fencing token proof","name":"X-Fencing-Token","in":"header"}],"responses":{"200":{"description":"Attachment payload","schema":{"type":"string"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}},"delete":{"security":[{"mTLS":[]}],"description":"Streams a single attachment (GET) or stages its deletion (DELETE).","consumes":["application/json"],"produces":["application/octet-stream"],"tags":["lease"],"summary":"Retrieve or delete a state attachment","parameters":[{"type":"string","description":"Namespace override (defaults to server setting)","name":"namespace","in":"query"},{"type":"string","description":"Lease key","name":"key","in":"query","required":true},{"type":"string","description":"Attachment name","name":"name","in":"query"},{"type":"string","description":"Attachment id","name":"id","in":"query"},{"type":"boolean","description":"Set to true to read without a lease (GET)","name":"public","in":"query"},{"type":"string","description":"Lease identifier (required unless public=1)","name":"X-Lease-ID","in":"header"},{"type":"string","description":"Transaction identifier (required for lease operations)","name":"X-Txn-ID","in":"header"},{"type":"string","description":"Optional fencing token proof","name":"X-Fencing-Token","in":"header"}],"responses":{"200":{"description":"Attachment payload","schema":{"type":"string"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/attachments":{"get":{"security":[{"mTLS":[]}],"description":"Upload, list, or delete attachments for a key depending on the HTTP method.","consumes":["application/octet-stream"],"produces":["application/json"],"tags":["lease"],"summary":"Manage state attachments","parameters":[{"type":"string","description":"Namespace override (defaults to server setting)","name":"namespace","in":"query"},{"type":"string","description":"Lease key","name":"key","in":"query","required":true},{"type":"string","description":"Attachment name (upload/delete)","name":"name","in":"query"},{"type":"string","description":"Attachment id (delete)","name":"id","in":"query"},{"type":"boolean","description":"Set to true to read without a lease (list)","name":"public","in":"query"},{"type":"string","description":"Attachment content type (upload)","name":"content_type","in":"query"},{"type":"integer","format":"int64","description":"Maximum attachment size (0 = unlimited)","name":"max_bytes","in":"query"},{"type":"boolean","description":"Do not overwrite existing attachments (upload)","name":"prevent_overwrite","in":"query"},{"type":"string","description":"Lease identifier (required unless public=1)","name":"X-Lease-ID","in":"header"},{"type":"string","description":"Transaction identifier (required for lease operations)","name":"X-Txn-ID","in":"header"},{"type":"string","description":"Optional fencing token proof","name":"X-Fencing-Token","in":"header"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.AttachmentListResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}},"post":{"security":[{"mTLS":[]}],"description":"Upload, list, or delete attachments for a key depending on the HTTP method.","consumes":["application/octet-stream"],"produces":["application/json"],"tags":["lease"],"summary":"Manage state attachments","parameters":[{"type":"string","description":"Namespace override (defaults to server setting)","name":"namespace","in":"query"},{"type":"string","description":"Lease key","name":"key","in":"query","required":true},{"type":"string","description":"Attachment name (upload/delete)","name":"name","in":"query"},{"type":"string","description":"Attachment id (delete)","name":"id","in":"query"},{"type":"boolean","description":"Set to true to read without a lease (list)","name":"public","in":"query"},{"type":"string","description":"Attachment content type (upload)","name":"content_type","in":"query"},{"type":"integer","format":"int64","description":"Maximum attachment size (0 = unlimited)","name":"max_bytes","in":"query"},{"type":"boolean","description":"Do not overwrite existing attachments (upload)","name":"prevent_overwrite","in":"query"},{"type":"string","description":"Lease identifier (required unless public=1)","name":"X-Lease-ID","in":"header"},{"type":"string","description":"Transaction identifier (required for lease operations)","name":"X-Txn-ID","in":"header"},{"type":"string","description":"Optional fencing token proof","name":"X-Fencing-Token","in":"header"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.AttachmentListResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}},"delete":{"security":[{"mTLS":[]}],"description":"Upload, list, or delete attachments for a key depending on the HTTP method.","consumes":["application/octet-stream"],"produces":["application/json"],"tags":["lease"],"summary":"Manage state attachments","parameters":[{"type":"string","description":"Namespace override (defaults to server setting)","name":"namespace","in":"query"},{"type":"string","description":"Lease key","name":"key","in":"query","required":true},{"type":"string","description":"Attachment name (upload/delete)","name":"name","in":"query"},{"type":"string","description":"Attachment id (delete)","name":"id","in":"query"},{"type":"boolean","description":"Set to true to read without a lease (list)","name":"public","in":"query"},{"type":"string","description":"Attachment content type (upload)","name":"content_type","in":"query"},{"type":"integer","format":"int64","description":"Maximum attachment size (0 = unlimited)","name":"max_bytes","in":"query"},{"type":"boolean","description":"Do not overwrite existing attachments (upload)","name":"prevent_overwrite","in":"query"},{"type":"string","description":"Lease identifier (required unless public=1)","name":"X-Lease-ID","in":"header"},{"type":"string","description":"Transaction identifier (required for lease operations)","name":"X-Txn-ID","in":"header"},{"type":"string","description":"Optional fencing token proof","name":"X-Fencing-Token","in":"header"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.AttachmentListResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/describe":{"get":{"security":[{"mTLS":[]}],"description":"Returns lease and state metadata without streaming the state payload.","produces":["application/json"],"tags":["lease"],"summary":"Inspect metadata for a key","parameters":[{"type":"string","description":"Namespace override (defaults to server setting)","name":"namespace","in":"query"},{"type":"string","description":"Lease key","name":"key","in":"query","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.DescribeResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/get":{"post":{"security":[{"mTLS":[]}],"description":"Streams the currently committed JSON state for the key owned by the caller's lease (or, when public=1, the latest published snapshot). Returns 204 when no state is present.","consumes":["application/json"],"produces":["application/json"],"tags":["lease"],"summary":"Read the JSON checkpoint for a key","parameters":[{"type":"string","description":"Namespace override (defaults to server setting)","name":"namespace","in":"query"},{"type":"string","description":"Lease key","name":"key","in":"query","required":true},{"type":"boolean","description":"Set to true to read without a lease (served from published data)","name":"public","in":"query"},{"type":"string","description":"Lease identifier (required unless public=1)","name":"X-Lease-ID","in":"header"},{"type":"string","description":"Optional fencing token proof (lease requests only)","name":"X-Fencing-Token","in":"header"}],"responses":{"200":{"description":"Streamed JSON state","schema":{"type":"object","additionalProperties":true}},"204":{"description":"No state stored for this key","schema":{"type":"string"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/index/flush":{"post":{"security":[{"mTLS":[]}],"description":"Forces the namespace index writer to flush pending documents. Supports synchronous (wait) and asynchronous modes.","consumes":["application/json"],"produces":["application/json"],"tags":["index"],"summary":"Flush namespace index segments","parameters":[{"type":"string","description":"Namespace override","name":"namespace","in":"query"},{"type":"string","description":"Flush mode (wait or async)","name":"mode","in":"query"},{"description":"Flush request","name":"request","in":"body","schema":{"$ref":"#/definitions/api.IndexFlushRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.IndexFlushResponse"}},"202":{"description":"Accepted","schema":{"$ref":"#/definitions/api.IndexFlushResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/keepalive":{"post":{"security":[{"mTLS":[]}],"description":"Refresh an existing lease before it expires. Requires the xid lease identifier minted by Acquire and its fencing token; returns the new expiration timestamp.","consumes":["application/json"],"produces":["application/json"],"tags":["lease"],"summary":"Extend an active lease TTL","parameters":[{"type":"string","description":"Namespace override when the request body omits it","name":"namespace","in":"query"},{"type":"string","description":"Key override when the request body omits it","name":"key","in":"query"},{"description":"Lease keepalive parameters","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.KeepAliveRequest"}},{"type":"string","description":"Fencing token associated with the lease (from Acquire response)","name":"X-Fencing-Token","in":"header","required":true},{"type":"string","description":"Transaction identifier (required when the lease is enlisted in a txn)","name":"X-Txn-ID","in":"header"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.KeepAliveResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/metadata":{"post":{"security":[{"mTLS":[]}],"description":"Mutates lock metadata (e.g. query visibility) while holding the lease. Optional CAS headers guard against concurrent updates.","consumes":["application/json"],"produces":["application/json"],"tags":["lease"],"summary":"Update lock metadata","parameters":[{"type":"string","description":"Namespace override (defaults to server setting)","name":"namespace","in":"query"},{"type":"string","description":"Lease key","name":"key","in":"query","required":true},{"type":"string","description":"Lease identifier (xid from Acquire, 20-char lowercase base32)","name":"X-Lease-ID","in":"header","required":true},{"type":"string","description":"Transaction identifier (xid from Acquire)","name":"X-Txn-ID","in":"header","required":true},{"type":"string","description":"Optional fencing token proof","name":"X-Fencing-Token","in":"header"},{"type":"string","description":"Conditionally update when the current version matches","name":"X-If-Version","in":"header"},{"description":"Metadata payload","name":"metadata","in":"body","required":true,"schema":{"$ref":"#/definitions/httpapi.metadataMutation"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.MetadataUpdateResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/namespace":{"get":{"security":[{"mTLS":[]}],"description":"Returns query engine preferences for the namespace.","produces":["application/json"],"tags":["namespace"],"summary":"Get namespace configuration","parameters":[{"type":"string","description":"Namespace override (defaults to server setting)","name":"namespace","in":"query"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.NamespaceConfigResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}},"post":{"security":[{"mTLS":[]}],"description":"Updates query engine preferences for the namespace.","consumes":["application/json"],"produces":["application/json"],"tags":["namespace"],"summary":"Update namespace configuration","parameters":[{"type":"string","description":"Namespace override (defaults to server setting)","name":"namespace","in":"query"},{"type":"string","description":"Conditionally update when the ETag matches","name":"If-Match","in":"header"},{"description":"Namespace configuration payload","name":"config","in":"body","required":true,"schema":{"$ref":"#/definitions/api.NamespaceConfigRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.NamespaceConfigResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/query":{"post":{"description":"Executes a selector-based search within a namespace and returns matching keys plus a cursor for pagination. Example request body: `{\"namespace\":\"default\",\"selector\":{\"eq\":{\"field\":\"type\",\"value\":\"alpha\"}},\"limit\":25,\"return\":\"keys\"}`","consumes":["application/json"],"produces":["application/json","application/x-ndjson"],"tags":["lease"],"summary":"Query keys within a namespace","parameters":[{"type":"string","description":"Namespace override (defaults to server setting)","name":"namespace","in":"query"},{"type":"integer","description":"Maximum number of keys to return (1-1000, defaults to 100)","name":"limit","in":"query"},{"type":"string","description":"Opaque pagination cursor","name":"cursor","in":"query"},{"type":"string","description":"Selector JSON (optional when providing a JSON body)","name":"selector","in":"query"},{"type":"string","description":"Return mode (keys or documents)","name":"return","in":"query"},{"description":"Query request (selector, limit, cursor)","name":"request","in":"body","schema":{"$ref":"#/definitions/api.QueryRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.QueryResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/queue/ack":{"post":{"security":[{"mTLS":[]}],"description":"Confirms processing of a delivery and deletes the message or its retry lease. If a txn_id is present (or the lease is already enlisted) and TC is enabled, this records a commit decision via the TC.","consumes":["application/json"],"produces":["application/json"],"tags":["queue"],"summary":"Acknowledge a delivered message","parameters":[{"type":"string","description":"Namespace override when the request body omits it","name":"namespace","in":"query"},{"description":"Acknowledgement payload","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.AckRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.AckResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/queue/dequeue":{"post":{"security":[{"mTLS":[]}],"description":"Dequeues one or more messages from the specified queue. Supports long polling via wait_seconds. If txn_id is provided, the message is enlisted as a transaction participant.","consumes":["application/json"],"produces":["application/json"],"tags":["queue"],"summary":"Dequeue messages","parameters":[{"type":"string","description":"Namespace override when the request body omits it","name":"namespace","in":"query"},{"type":"string","description":"Queue name override when the request body omits it","name":"queue","in":"query"},{"type":"string","description":"Owner override when the request body omits it","name":"owner","in":"query"},{"description":"Dequeue parameters (queue, owner, wait_seconds, visibility)","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.DequeueRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.DequeueResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/queue/dequeueWithState":{"post":{"security":[{"mTLS":[]}],"description":"Dequeues messages and includes their associated state blobs in the multipart response when available. If txn_id is provided, the message and state sidecar are enlisted as transaction participants.","consumes":["application/json"],"produces":["multipart/related"],"tags":["queue"],"summary":"Fetch queue messages with state sidecars","parameters":[{"type":"string","description":"Namespace override when the request body omits it","name":"namespace","in":"query"},{"type":"string","description":"Queue name override when the request body omits it","name":"queue","in":"query"},{"type":"string","description":"Owner override when the request body omits it","name":"owner","in":"query"},{"description":"Dequeue parameters","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.DequeueRequest"}}],"responses":{"200":{"description":"Multipart response with message metadata, payload, and state sidecar","schema":{"type":"string"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/queue/enqueue":{"post":{"security":[{"mTLS":[]}],"description":"Writes a message into the durable queue. The payload is streamed directly and may include optional attributes.","consumes":["multipart/form-data"],"produces":["application/json"],"tags":["queue"],"summary":"Enqueue a message","parameters":[{"type":"string","description":"Namespace override when the metadata omits it","name":"namespace","in":"query"},{"type":"string","description":"Queue override when the metadata omits it","name":"queue","in":"query"},{"type":"string","description":"JSON encoded api.EnqueueRequest metadata","name":"meta","in":"formData","required":true},{"type":"file","description":"Optional payload stream","name":"payload","in":"formData"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.EnqueueResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/queue/extend":{"post":{"security":[{"mTLS":[]}],"description":"Extends the visibility timeout and lease window for an in-flight message. txn_id is optional; if omitted the server uses the lease's txn_id (if any).","consumes":["application/json"],"produces":["application/json"],"tags":["queue"],"summary":"Extend a delivery lease","parameters":[{"type":"string","description":"Namespace override when the request body omits it","name":"namespace","in":"query"},{"description":"Extend payload","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.ExtendRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.ExtendResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/queue/nack":{"post":{"security":[{"mTLS":[]}],"description":"Requeues the delivery with optional delay and last error metadata. If a txn_id is present (or the lease is already enlisted) and TC is enabled, this records a rollback decision via the TC.","consumes":["application/json"],"produces":["application/json"],"tags":["queue"],"summary":"Return a message to the queue","parameters":[{"type":"string","description":"Namespace override when the request body omits it","name":"namespace","in":"query"},{"description":"Negative acknowledgement payload","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.NackRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.NackResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/queue/subscribe":{"post":{"security":[{"mTLS":[]}],"description":"Opens a long-lived multipart stream of deliveries for the specified queue owner. Each part contains message metadata and payload. If txn_id is provided, each delivery is enlisted as a transaction participant.","consumes":["application/json"],"produces":["multipart/related"],"tags":["queue"],"summary":"Stream queue deliveries","parameters":[{"type":"string","description":"Namespace override when the request body omits it","name":"namespace","in":"query"},{"type":"string","description":"Queue name override when the request body omits it","name":"queue","in":"query"},{"type":"string","description":"Owner override when the request body omits it","name":"owner","in":"query"},{"description":"Subscription parameters (queue, owner, wait_seconds, visibility)","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.DequeueRequest"}}],"responses":{"200":{"description":"Multipart stream of message deliveries","schema":{"type":"string"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/queue/subscribeWithState":{"post":{"security":[{"mTLS":[]}],"description":"Opens a long-lived multipart stream where each part contains message metadata, payload, and state snapshot when available. If txn_id is provided, the message and state sidecar are enlisted as transaction participants.","consumes":["application/json"],"produces":["multipart/related"],"tags":["queue"],"summary":"Stream queue deliveries with state","parameters":[{"type":"string","description":"Namespace override when the request body omits it","name":"namespace","in":"query"},{"type":"string","description":"Queue name override when the request body omits it","name":"queue","in":"query"},{"type":"string","description":"Owner override when the request body omits it","name":"owner","in":"query"},{"description":"Subscription parameters (queue, owner, wait_seconds, visibility)","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.DequeueRequest"}}],"responses":{"200":{"description":"Multipart stream of message deliveries","schema":{"type":"string"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/release":{"post":{"security":[{"mTLS":[]}],"description":"Releases the lease associated with the provided key and lease identifier. The request must include the xid `txn_id` from Acquire; set `rollback=true` to abandon staged changes, otherwise the release commits the staged state.","consumes":["application/json"],"produces":["application/json"],"tags":["lease"],"summary":"Release a held lease","parameters":[{"type":"string","description":"Namespace override when the request body omits it","name":"namespace","in":"query"},{"type":"string","description":"Key override when the request body omits it","name":"key","in":"query"},{"description":"Lease release parameters","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.ReleaseRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.ReleaseResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/remove":{"post":{"security":[{"mTLS":[]}],"description":"Removes the stored state blob if the caller holds the lease. Optional CAS headers guard against concurrent updates.","consumes":["application/json"],"produces":["application/json"],"tags":["lease"],"summary":"Delete the JSON state for a key","parameters":[{"type":"string","description":"Namespace override (defaults to server setting)","name":"namespace","in":"query"},{"type":"string","description":"Lease key","name":"key","in":"query","required":true},{"type":"string","description":"Lease identifier (xid from Acquire, 20-char lowercase base32)","name":"X-Lease-ID","in":"header","required":true},{"type":"string","description":"Transaction identifier (xid from Acquire)","name":"X-Txn-ID","in":"header","required":true},{"type":"string","description":"Optional fencing token proof","name":"X-Fencing-Token","in":"header"},{"type":"string","description":"Conditionally remove when version matches","name":"X-If-Version","in":"header"},{"type":"string","description":"Conditionally remove when state ETag matches","name":"X-If-State-ETag","in":"header"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.RemoveResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/tc/cluster/announce":{"post":{"security":[{"mTLS":[]}],"description":"Refreshes the caller's membership lease. Requires TC-auth with a server certificate when mTLS is enabled (unless tc-disable-auth is set).","consumes":["application/json"],"produces":["application/json"],"tags":["transaction"],"summary":"Announce TC cluster membership","parameters":[{"description":"TC cluster announce request","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.TCClusterAnnounceRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.TCClusterAnnounceResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/tc/cluster/leave":{"post":{"security":[{"mTLS":[]}],"description":"Deletes the caller's membership lease. Requires TC-auth with a server certificate when mTLS is enabled (unless tc-disable-auth is set).","consumes":["application/json"],"produces":["application/json"],"tags":["transaction"],"summary":"Leave the TC cluster","parameters":[{"description":"TC cluster leave request","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.TCClusterLeaveRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.TCClusterLeaveResponse"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/tc/cluster/list":{"get":{"security":[{"mTLS":[]}],"description":"List the current active TC cluster membership list. Requires TC-auth when mTLS is enabled (unless tc-disable-auth is set).","produces":["application/json"],"tags":["transaction"],"summary":"List TC cluster membership","responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.TCClusterListResponse"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/tc/leader":{"get":{"security":[{"mTLS":[]}],"description":"Returns the observed TC leader state. Requires TC-auth when mTLS is enabled (unless tc-disable-auth is set).","produces":["application/json"],"tags":["transaction"],"summary":"Return TC leader state","responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.TCLeaderResponse"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/tc/lease/acquire":{"post":{"security":[{"mTLS":[]}],"description":"Acquire a TC leader lease as part of the TC election quorum. Requires TC-auth when mTLS is enabled (unless tc-disable-auth is set).","consumes":["application/json"],"produces":["application/json"],"tags":["transaction"],"summary":"Acquire a TC leader lease","parameters":[{"description":"TC lease acquire request","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.TCLeaseAcquireRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.TCLeaseAcquireResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/tc/lease/release":{"post":{"security":[{"mTLS":[]}],"description":"Release a TC leader lease as part of the TC election quorum. Requires TC-auth when mTLS is enabled (unless tc-disable-auth is set).","consumes":["application/json"],"produces":["application/json"],"tags":["transaction"],"summary":"Release a TC leader lease","parameters":[{"description":"TC lease release request","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.TCLeaseReleaseRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.TCLeaseReleaseResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/tc/lease/renew":{"post":{"security":[{"mTLS":[]}],"description":"Renew a TC leader lease as part of the TC election quorum. Requires TC-auth when mTLS is enabled (unless tc-disable-auth is set).","consumes":["application/json"],"produces":["application/json"],"tags":["transaction"],"summary":"Renew a TC leader lease","parameters":[{"description":"TC lease renew request","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.TCLeaseRenewRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.TCLeaseRenewResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/tc/rm/list":{"get":{"security":[{"mTLS":[]}],"description":"List RM endpoints by backend hash. Requires TC-auth when mTLS is enabled (unless tc-disable-auth is set).","produces":["application/json"],"tags":["transaction"],"summary":"List RM registry entries","responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.TCRMListResponse"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/tc/rm/register":{"post":{"security":[{"mTLS":[]}],"description":"Register an RM endpoint for a backend hash. Replicates across the TC cluster. Requires TC-auth with a server certificate when mTLS is enabled (unless tc-disable-auth is set).","consumes":["application/json"],"produces":["application/json"],"tags":["transaction"],"summary":"Register an RM endpoint","parameters":[{"description":"RM register request","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.TCRMRegisterRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.TCRMRegisterResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"502":{"description":"Bad Gateway","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/tc/rm/unregister":{"post":{"security":[{"mTLS":[]}],"description":"Unregister an RM endpoint for a backend hash. Replicates across the TC cluster. Requires TC-auth with a server certificate when mTLS is enabled (unless tc-disable-auth is set).","consumes":["application/json"],"produces":["application/json"],"tags":["transaction"],"summary":"Unregister an RM endpoint","parameters":[{"description":"RM unregister request","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.TCRMUnregisterRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.TCRMUnregisterResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"502":{"description":"Bad Gateway","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/txn/commit":{"post":{"security":[{"mTLS":[]}],"description":"Apply a commit decision for a transaction on the local RM. Requires tc_term when TC leadership is enabled. Requires TC-auth when mTLS is enabled (unless tc-disable-auth is set).","consumes":["application/json"],"produces":["application/json"],"tags":["transaction"],"summary":"Apply a commit decision on an RM","parameters":[{"description":"Txn decision request","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.TxnDecisionRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.TxnDecisionResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/txn/decide":{"post":{"security":[{"mTLS":[]}],"description":"Record a transaction decision (pending|commit|rollback). Commit/rollback decisions are applied locally and fan out to RMs. TC-auth only; called by lockd RMs or TC tooling. Any TC endpoint can receive this call; non-leaders forward to the leader, which stamps the tc_term fencing token. Requires TC-auth when mTLS is enabled (unless tc-disable-auth is set).","consumes":["application/json"],"produces":["application/json"],"tags":["transaction"],"summary":"Record a transaction decision","parameters":[{"description":"Txn decision request","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.TxnDecisionRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.TxnDecisionResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"502":{"description":"Bad Gateway","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/txn/replay":{"post":{"security":[{"mTLS":[]}],"description":"Apply the recorded decision for a transaction (commit or rollback) to its participants. Pending transactions remain unchanged unless expired, in which case they roll back. Idempotent and safe to retry. Requires TC-auth when mTLS is enabled (unless tc-disable-auth is set).","consumes":["application/json"],"produces":["application/json"],"tags":["transaction"],"summary":"Replay a transaction decision","parameters":[{"description":"Txn replay request","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.TxnReplayRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.TxnReplayResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/txn/rollback":{"post":{"security":[{"mTLS":[]}],"description":"Apply a rollback decision for a transaction on the local RM. Requires tc_term when TC leadership is enabled. Requires TC-auth when mTLS is enabled (unless tc-disable-auth is set).","consumes":["application/json"],"produces":["application/json"],"tags":["transaction"],"summary":"Apply a rollback decision on an RM","parameters":[{"description":"Txn decision request","name":"request","in":"body","required":true,"schema":{"$ref":"#/definitions/api.TxnDecisionRequest"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.TxnDecisionResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}},"/v1/update":{"post":{"security":[{"mTLS":[]}],"description":"Streams JSON from the request body, compacts it, and installs it if the caller holds the lease. Optional CAS headers guard against concurrent updates.","consumes":["application/json"],"produces":["application/json"],"tags":["lease"],"summary":"Atomically update the JSON state for a key","parameters":[{"type":"string","description":"Namespace override (defaults to server setting)","name":"namespace","in":"query"},{"type":"string","description":"Lease key","name":"key","in":"query","required":true},{"type":"string","description":"Lease identifier (xid from Acquire, 20-char lowercase base32)","name":"X-Lease-ID","in":"header","required":true},{"type":"string","description":"Transaction identifier (xid from Acquire)","name":"X-Txn-ID","in":"header","required":true},{"type":"string","description":"Optional fencing token proof","name":"X-Fencing-Token","in":"header"},{"type":"string","description":"Conditionally update when the current version matches","name":"X-If-Version","in":"header"},{"type":"string","description":"Conditionally update when the state ETag matches","name":"X-If-State-ETag","in":"header"},{"description":"New JSON state payload","name":"state","in":"body","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/api.UpdateResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/api.ErrorResponse"}},"503":{"description":"Service Unavailable","schema":{"$ref":"#/definitions/api.ErrorResponse"}}}}}},"definitions":{"api.AckRequest":{"type":"object","properties":{"fencing_token":{"type":"integer"},"lease_id":{"type":"string"},"message_id":{"type":"string"},"meta_etag":{"type":"string"},"namespace":{"type":"string"},"queue":{"type":"string"},"state_etag":{"type":"string"},"state_fencing_token":{"type":"integer"},"state_lease_id":{"type":"string"},"txn_id":{"type":"string"}}},"api.AckResponse":{"type":"object","properties":{"acked":{"type":"boolean"},"correlation_id":{"type":"string"}}},"api.AcquireRequest":{"type":"object","properties":{"block_seconds":{"type":"integer"},"key":{"type":"string"},"namespace":{"type":"string"},"owner":{"type":"string"},"ttl_seconds":{"type":"integer"},"txn_id":{"type":"string"}}},"api.AcquireResponse":{"type":"object","properties":{"correlation_id":{"type":"string"},"expires_at_unix":{"type":"integer"},"fencing_token":{"type":"integer"},"key":{"type":"string"},"lease_id":{"type":"string"},"namespace":{"type":"string"},"owner":{"type":"string"},"retry_after_seconds":{"type":"integer"},"state_etag":{"type":"string"},"txn_id":{"type":"string"},"version":{"type":"integer"}}},"api.AttachmentInfo":{"type":"object","properties":{"content_type":{"type":"string"},"created_at_unix":{"type":"integer"},"id":{"type":"string"},"name":{"type":"string"},"size":{"type":"integer"},"updated_at_unix":{"type":"integer"}}},"api.AttachmentListResponse":{"type":"object","properties":{"attachments":{"type":"array","items":{"$ref":"#/definitions/api.AttachmentInfo"}},"key":{"type":"string"},"namespace":{"type":"string"}}},"api.DequeueRequest":{"type":"object","properties":{"namespace":{"type":"string"},"owner":{"type":"string"},"page_size":{"type":"integer"},"queue":{"type":"string"},"start_after":{"type":"string"},"txn_id":{"type":"string"},"visibility_timeout_seconds":{"type":"integer"},"wait_seconds":{"type":"integer"}}},"api.DequeueResponse":{"type":"object","properties":{"message":{"$ref":"#/definitions/api.Message"},"next_cursor":{"type":"string"}}},"api.DescribeResponse":{"type":"object","properties":{"expires_at_unix":{"type":"integer"},"key":{"type":"string"},"lease_id":{"type":"string"},"metadata":{"$ref":"#/definitions/api.MetadataAttributes"},"namespace":{"type":"string"},"owner":{"type":"string"},"state_etag":{"type":"string"},"updated_at_unix":{"type":"integer"},"version":{"type":"integer"}}},"api.EnqueueResponse":{"type":"object","properties":{"attempts":{"type":"integer"},"correlation_id":{"type":"string"},"max_attempts":{"type":"integer"},"message_id":{"type":"string"},"namespace":{"type":"string"},"not_visible_until_unix":{"type":"integer"},"payload_bytes":{"type":"integer"},"queue":{"type":"string"},"visibility_timeout_seconds":{"type":"integer"}}},"api.ErrorResponse":{"type":"object","properties":{"current_etag":{"type":"string"},"current_version":{"type":"integer"},"detail":{"type":"string"},"error":{"type":"string"},"leader_endpoint":{"type":"string"},"retry_after_seconds":{"type":"integer"}}},"api.ExtendRequest":{"type":"object","properties":{"extend_by_seconds":{"type":"integer"},"fencing_token":{"type":"integer"},"lease_id":{"type":"string"},"message_id":{"type":"string"},"meta_etag":{"type":"string"},"namespace":{"type":"string"},"queue":{"type":"string"},"state_fencing_token":{"type":"integer"},"state_lease_id":{"type":"string"},"txn_id":{"type":"string"}}},"api.ExtendResponse":{"type":"object","properties":{"correlation_id":{"type":"string"},"lease_expires_at_unix":{"type":"integer"},"meta_etag":{"type":"string"},"state_lease_expires_at_unix":{"type":"integer"},"visibility_timeout_seconds":{"type":"integer"}}},"api.IndexFlushRequest":{"type":"object","properties":{"mode":{"type":"string"},"namespace":{"type":"string"}}},"api.IndexFlushResponse":{"type":"object","properties":{"accepted":{"type":"boolean"},"flush_id":{"type":"string"},"flushed":{"type":"boolean"},"index_seq":{"type":"integer"},"mode":{"type":"string"},"namespace":{"type":"string"},"pending":{"type":"boolean"}}},"api.KeepAliveRequest":{"type":"object","properties":{"key":{"type":"string"},"lease_id":{"type":"string"},"namespace":{"type":"string"},"ttl_seconds":{"type":"integer"},"txn_id":{"type":"string"}}},"api.KeepAliveResponse":{"type":"object","properties":{"expires_at_unix":{"type":"integer"}}},"api.Message":{"type":"object","properties":{"attempts":{"type":"integer"},"attributes":{"type":"object","additionalProperties":{}},"correlation_id":{"type":"string"},"fencing_token":{"type":"integer"},"lease_expires_at_unix":{"type":"integer"},"lease_id":{"type":"string"},"max_attempts":{"type":"integer"},"message_id":{"type":"string"},"meta_etag":{"type":"string"},"namespace":{"type":"string"},"not_visible_until_unix":{"type":"integer"},"payload_bytes":{"type":"integer"},"payload_content_type":{"type":"string"},"queue":{"type":"string"},"state_etag":{"type":"string"},"state_fencing_token":{"type":"integer"},"state_lease_expires_at_unix":{"type":"integer"},"state_lease_id":{"type":"string"},"state_txn_id":{"type":"string"},"txn_id":{"type":"string"},"visibility_timeout_seconds":{"type":"integer"}}},"api.MetadataAttributes":{"type":"object","properties":{"query_hidden":{"type":"boolean"}}},"api.MetadataUpdateResponse":{"type":"object","properties":{"key":{"type":"string"},"metadata":{"$ref":"#/definitions/api.MetadataAttributes"},"namespace":{"type":"string"},"version":{"type":"integer"}}},"api.NackRequest":{"type":"object","properties":{"delay_seconds":{"type":"integer"},"fencing_token":{"type":"integer"},"last_error":{},"lease_id":{"type":"string"},"message_id":{"type":"string"},"meta_etag":{"type":"string"},"namespace":{"type":"string"},"queue":{"type":"string"},"state_etag":{"type":"string"},"state_fencing_token":{"type":"integer"},"state_lease_id":{"type":"string"},"txn_id":{"type":"string"}}},"api.NackResponse":{"type":"object","properties":{"correlation_id":{"type":"string"},"meta_etag":{"type":"string"},"requeued":{"type":"boolean"}}},"api.NamespaceConfigRequest":{"type":"object","properties":{"namespace":{"type":"string"},"query":{"$ref":"#/definitions/api.NamespaceQueryConfig"}}},"api.NamespaceConfigResponse":{"type":"object","properties":{"namespace":{"type":"string"},"query":{"$ref":"#/definitions/api.NamespaceQueryConfig"}}},"api.NamespaceQueryConfig":{"type":"object","properties":{"fallback_engine":{"type":"string"},"preferred_engine":{"type":"string"}}},"api.QueryRequest":{"type":"object","properties":{"cursor":{"type":"string"},"fields":{"type":"object","additionalProperties":{}},"limit":{"type":"integer"},"namespace":{"type":"string"},"return":{"$ref":"#/definitions/api.QueryReturn"},"selector":{"type":"object","x-example":"{\"eq\":{\"field\":\"type\",\"value\":\"alpha\"}}"}}},"api.QueryResponse":{"type":"object","properties":{"cursor":{"type":"string"},"index_seq":{"type":"integer"},"keys":{"type":"array","items":{"type":"string"}},"metadata":{"type":"object","additionalProperties":{"type":"string"}},"namespace":{"type":"string"}}},"api.QueryReturn":{"type":"string","enum":["keys","documents"],"x-enum-varnames":["QueryReturnKeys","QueryReturnDocuments"]},"api.ReleaseRequest":{"type":"object","properties":{"key":{"type":"string"},"lease_id":{"type":"string"},"namespace":{"type":"string"},"rollback":{"type":"boolean"},"txn_id":{"type":"string"}}},"api.ReleaseResponse":{"type":"object","properties":{"released":{"type":"boolean"}}},"api.RemoveResponse":{"type":"object","properties":{"new_version":{"type":"integer"},"removed":{"type":"boolean"}}},"api.TCClusterAnnounceRequest":{"type":"object","properties":{"self_endpoint":{"type":"string"}}},"api.TCClusterAnnounceResponse":{"type":"object","properties":{"endpoints":{"type":"array","items":{"type":"string"}},"expires_at_unix":{"type":"integer"},"updated_at_unix":{"type":"integer"}}},"api.TCClusterLeaveRequest":{"type":"object"},"api.TCClusterLeaveResponse":{"type":"object","properties":{"endpoints":{"type":"array","items":{"type":"string"}},"updated_at_unix":{"type":"integer"}}},"api.TCClusterListResponse":{"type":"object","properties":{"endpoints":{"type":"array","items":{"type":"string"}},"updated_at_unix":{"type":"integer"}}},"api.TCLeaderResponse":{"type":"object","properties":{"expires_at":{"type":"integer"},"leader_endpoint":{"type":"string"},"leader_id":{"type":"string"},"term":{"type":"integer"}}},"api.TCLeaseAcquireRequest":{"type":"object","properties":{"candidate_endpoint":{"type":"string"},"candidate_id":{"type":"string"},"term":{"type":"integer"},"ttl_ms":{"type":"integer"}}},"api.TCLeaseAcquireResponse":{"type":"object","properties":{"expires_at":{"type":"integer"},"granted":{"type":"boolean"},"leader_endpoint":{"type":"string"},"leader_id":{"type":"string"},"term":{"type":"integer"}}},"api.TCLeaseReleaseRequest":{"type":"object","properties":{"leader_id":{"type":"string"},"term":{"type":"integer"}}},"api.TCLeaseReleaseResponse":{"type":"object","properties":{"released":{"type":"boolean"}}},"api.TCLeaseRenewRequest":{"type":"object","properties":{"leader_id":{"type":"string"},"term":{"type":"integer"},"ttl_ms":{"type":"integer"}}},"api.TCLeaseRenewResponse":{"type":"object","properties":{"expires_at":{"type":"integer"},"leader_endpoint":{"type":"string"},"leader_id":{"type":"string"},"renewed":{"type":"boolean"},"term":{"type":"integer"}}},"api.TCRMBackend":{"type":"object","properties":{"backend_hash":{"type":"string"},"endpoints":{"type":"array","items":{"type":"string"}},"updated_at_unix":{"type":"integer"}}},"api.TCRMListResponse":{"type":"object","properties":{"backends":{"type":"array","items":{"$ref":"#/definitions/api.TCRMBackend"}},"updated_at_unix":{"type":"integer"}}},"api.TCRMRegisterRequest":{"type":"object","properties":{"backend_hash":{"type":"string"},"endpoint":{"type":"string"}}},"api.TCRMRegisterResponse":{"type":"object","properties":{"backend_hash":{"type":"string"},"endpoints":{"type":"array","items":{"type":"string"}},"updated_at_unix":{"type":"integer"}}},"api.TCRMUnregisterRequest":{"type":"object","properties":{"backend_hash":{"type":"string"},"endpoint":{"type":"string"}}},"api.TCRMUnregisterResponse":{"type":"object","properties":{"backend_hash":{"type":"string"},"endpoints":{"type":"array","items":{"type":"string"}},"updated_at_unix":{"type":"integer"}}},"api.TxnDecisionRequest":{"type":"object","properties":{"expires_at_unix":{"type":"integer"},"participants":{"type":"array","items":{"$ref":"#/definitions/api.TxnParticipant"}},"state":{"description":"pending|commit|rollback","type":"string"},"target_backend_hash":{"description":"TargetBackendHash scopes RM apply requests to a specific backend island.","type":"string"},"tc_term":{"description":"TCTerm is the current TC leader term for this decision.","type":"integer"},"txn_id":{"type":"string"}}},"api.TxnDecisionResponse":{"type":"object","properties":{"state":{"type":"string"},"txn_id":{"type":"string"}}},"api.TxnParticipant":{"type":"object","properties":{"backend_hash":{"description":"BackendHash identifies the storage backend island for this participant.","type":"string"},"key":{"type":"string"},"namespace":{"type":"string"}}},"api.TxnReplayRequest":{"type":"object","properties":{"txn_id":{"type":"string"}}},"api.TxnReplayResponse":{"type":"object","properties":{"state":{"type":"string"},"txn_id":{"type":"string"}}},"api.UpdateResponse":{"type":"object","properties":{"bytes":{"type":"integer"},"metadata":{"$ref":"#/definitions/api.MetadataAttributes"},"new_state_etag":{"type":"string"},"new_version":{"type":"integer"}}},"httpapi.metadataMutation":{"type":"object","properties":{"query_hidden":{"type":"boolean"}}}},"securityDefinitions":{"mTLS":{"description":"Mutual TLS is required in production deployments; place holder header documents client certificate identity propagation.","type":"apiKey","name":"X-Client-Cert","in":"header"}},"tags":[{"description":"Lease acquisition, keepalive, release, and state management.","name":"lease"},{"description":"Queue enqueue, dequeue, acknowledgement, and lifecycle operations.","name":"queue"},{"description":"Service health and readiness probes.","name":"system"}]};
      SwaggerUIBundle({
        spec: spec,
        dom_id: '#swagger-ui',
        deepLinking: true,
        presets: [SwaggerUIBundle.presets.apis, SwaggerUIStandalonePreset],
        layout: 'BaseLayout'
      });
    };
  </script>
</body>
</html>
