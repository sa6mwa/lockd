{
    "consumes": [
        "application/json"
    ],
    "produces": [
        "application/json"
    ],
    "schemes": [
        "https",
        "http"
    ],
    "swagger": "2.0",
    "info": {
        "description": "lockd exposes exclusive lease management, atomic JSON checkpoints, and resilient work queues over HTTPS.",
        "title": "lockd API",
        "contact": {
            "name": "Michel Blomgren",
            "url": "https://pkt.systems",
            "email": "sa6mwa@gmail.com"
        },
        "license": {
            "name": "MIT",
            "url": "https://opensource.org/license/mit/"
        },
        "version": "0.0"
    },
    "basePath": "/v1",
    "paths": {
        "/healthz": {
            "get": {
                "produces": [
                    "text/plain"
                ],
                "tags": [
                    "system"
                ],
                "summary": "Liveness probe",
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "/readyz": {
            "get": {
                "produces": [
                    "text/plain"
                ],
                "tags": [
                    "system"
                ],
                "summary": "Readiness probe",
                "responses": {
                    "200": {
                        "description": "Ready",
                        "schema": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "/v1/acquire": {
            "post": {
                "security": [
                    {
                        "mTLS": []
                    }
                ],
                "description": "Acquire or wait for an exclusive lease on a key. When block_seconds \u003e 0 the request will long-poll until a lease becomes available or the timeout elapses.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "lease"
                ],
                "summary": "Acquire an exclusive lease",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Namespace override when the request body omits it",
                        "name": "namespace",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Key to acquire when the request body omits it",
                        "name": "key",
                        "in": "query"
                    },
                    {
                        "description": "Lease acquisition parameters",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.AcquireRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.AcquireResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Conflict",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/v1/describe": {
            "get": {
                "security": [
                    {
                        "mTLS": []
                    }
                ],
                "description": "Returns lease and state metadata without streaming the state payload.",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "lease"
                ],
                "summary": "Inspect metadata for a key",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Namespace override (defaults to server setting)",
                        "name": "namespace",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Lease key",
                        "name": "key",
                        "in": "query",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.DescribeResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/v1/get": {
            "post": {
                "security": [
                    {
                        "mTLS": []
                    }
                ],
                "description": "Streams the currently committed JSON state for the key owned by the caller's lease. Returns 204 when no state is present.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "lease"
                ],
                "summary": "Read the JSON checkpoint for a key",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Namespace override (defaults to server setting)",
                        "name": "namespace",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Lease key",
                        "name": "key",
                        "in": "query",
                        "required": true
                    },
                    {
                        "type": "string",
                        "description": "Lease identifier",
                        "name": "X-Lease-ID",
                        "in": "header",
                        "required": true
                    },
                    {
                        "type": "string",
                        "description": "Optional fencing token proof",
                        "name": "X-Fencing-Token",
                        "in": "header"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Streamed JSON state",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    },
                    "204": {
                        "description": "No state stored for this key",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Conflict",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/v1/keepalive": {
            "post": {
                "security": [
                    {
                        "mTLS": []
                    }
                ],
                "description": "Refresh an existing lease before it expires. Returns the new expiration timestamp.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "lease"
                ],
                "summary": "Extend an active lease TTL",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Namespace override when the request body omits it",
                        "name": "namespace",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Key override when the request body omits it",
                        "name": "key",
                        "in": "query"
                    },
                    {
                        "description": "Lease keepalive parameters",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.KeepAliveRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.KeepAliveResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Conflict",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/v1/queue/ack": {
            "post": {
                "security": [
                    {
                        "mTLS": []
                    }
                ],
                "description": "Confirms processing of a delivery and deletes the message or its retry lease.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "queue"
                ],
                "summary": "Acknowledge a delivered message",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Namespace override when the request body omits it",
                        "name": "namespace",
                        "in": "query"
                    },
                    {
                        "description": "Acknowledgement payload",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.AckRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.AckResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Conflict",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/v1/queue/dequeue": {
            "post": {
                "security": [
                    {
                        "mTLS": []
                    }
                ],
                "description": "Performs a single dequeue attempt, optionally waiting for availability. Responses stream as multipart/related parts containing message metadata and payload.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "multipart/related"
                ],
                "tags": [
                    "queue"
                ],
                "summary": "Fetch one or more queue messages",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Namespace override when the request body omits it",
                        "name": "namespace",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Queue name override when the request body omits it",
                        "name": "queue",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Owner override when the request body omits it",
                        "name": "owner",
                        "in": "query"
                    },
                    {
                        "description": "Dequeue parameters",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.DequeueRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Multipart response with message metadata and optional payload",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Conflict",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/v1/queue/dequeueWithState": {
            "post": {
                "security": [
                    {
                        "mTLS": []
                    }
                ],
                "description": "Dequeues messages and includes their associated state blobs in the multipart response when available.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "multipart/related"
                ],
                "tags": [
                    "queue"
                ],
                "summary": "Fetch queue messages with state attachments",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Namespace override when the request body omits it",
                        "name": "namespace",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Queue name override when the request body omits it",
                        "name": "queue",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Owner override when the request body omits it",
                        "name": "owner",
                        "in": "query"
                    },
                    {
                        "description": "Dequeue parameters",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.DequeueRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Multipart response with message metadata, payload, and state attachments",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Conflict",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/v1/queue/enqueue": {
            "post": {
                "security": [
                    {
                        "mTLS": []
                    }
                ],
                "description": "Writes a message into the durable queue. The payload is streamed directly and may include optional attributes.",
                "consumes": [
                    "multipart/form-data"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "queue"
                ],
                "summary": "Enqueue a message",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Namespace override when the metadata omits it",
                        "name": "namespace",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Queue override when the metadata omits it",
                        "name": "queue",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "JSON encoded api.EnqueueRequest metadata",
                        "name": "meta",
                        "in": "formData",
                        "required": true
                    },
                    {
                        "type": "file",
                        "description": "Optional payload stream",
                        "name": "payload",
                        "in": "formData"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.EnqueueResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Conflict",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/v1/queue/extend": {
            "post": {
                "security": [
                    {
                        "mTLS": []
                    }
                ],
                "description": "Extends the visibility timeout and lease window for an in-flight message.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "queue"
                ],
                "summary": "Extend a delivery lease",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Namespace override when the request body omits it",
                        "name": "namespace",
                        "in": "query"
                    },
                    {
                        "description": "Extend payload",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.ExtendRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.ExtendResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Conflict",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/v1/queue/nack": {
            "post": {
                "security": [
                    {
                        "mTLS": []
                    }
                ],
                "description": "Requeues the delivery with optional delay and last error metadata.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "queue"
                ],
                "summary": "Return a message to the queue",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Namespace override when the request body omits it",
                        "name": "namespace",
                        "in": "query"
                    },
                    {
                        "description": "Negative acknowledgement payload",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.NackRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.NackResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Conflict",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/v1/queue/subscribe": {
            "post": {
                "security": [
                    {
                        "mTLS": []
                    }
                ],
                "description": "Opens a long-lived multipart stream of deliveries for the specified queue owner. Each part contains message metadata and payload.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "multipart/related"
                ],
                "tags": [
                    "queue"
                ],
                "summary": "Stream queue deliveries",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Namespace override when the request body omits it",
                        "name": "namespace",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Queue name override when the request body omits it",
                        "name": "queue",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Owner override when the request body omits it",
                        "name": "owner",
                        "in": "query"
                    },
                    {
                        "description": "Subscription parameters (queue, owner, wait_seconds, visibility)",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.DequeueRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Multipart stream of message deliveries",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Conflict",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/v1/queue/subscribeWithState": {
            "post": {
                "security": [
                    {
                        "mTLS": []
                    }
                ],
                "description": "Opens a long-lived multipart stream where each part contains message metadata, payload, and state snapshot when available.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "multipart/related"
                ],
                "tags": [
                    "queue"
                ],
                "summary": "Stream queue deliveries with state",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Namespace override when the request body omits it",
                        "name": "namespace",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Queue name override when the request body omits it",
                        "name": "queue",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Owner override when the request body omits it",
                        "name": "owner",
                        "in": "query"
                    },
                    {
                        "description": "Subscription parameters (queue, owner, wait_seconds, visibility)",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.DequeueRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Multipart stream of message deliveries",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Conflict",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/v1/release": {
            "post": {
                "security": [
                    {
                        "mTLS": []
                    }
                ],
                "description": "Releases the lease associated with the provided key and lease identifier.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "lease"
                ],
                "summary": "Release a held lease",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Namespace override when the request body omits it",
                        "name": "namespace",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Key override when the request body omits it",
                        "name": "key",
                        "in": "query"
                    },
                    {
                        "description": "Lease release parameters",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.ReleaseRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.ReleaseResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Conflict",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/v1/remove": {
            "post": {
                "security": [
                    {
                        "mTLS": []
                    }
                ],
                "description": "Removes the stored state blob if the caller holds the lease. Optional CAS headers guard against concurrent updates.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "lease"
                ],
                "summary": "Delete the JSON state for a key",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Namespace override (defaults to server setting)",
                        "name": "namespace",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Lease key",
                        "name": "key",
                        "in": "query",
                        "required": true
                    },
                    {
                        "type": "string",
                        "description": "Lease identifier",
                        "name": "X-Lease-ID",
                        "in": "header",
                        "required": true
                    },
                    {
                        "type": "string",
                        "description": "Optional fencing token proof",
                        "name": "X-Fencing-Token",
                        "in": "header"
                    },
                    {
                        "type": "string",
                        "description": "Conditionally remove when version matches",
                        "name": "X-If-Version",
                        "in": "header"
                    },
                    {
                        "type": "string",
                        "description": "Conditionally remove when state ETag matches",
                        "name": "X-If-State-ETag",
                        "in": "header"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.RemoveResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Conflict",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/v1/update": {
            "post": {
                "security": [
                    {
                        "mTLS": []
                    }
                ],
                "description": "Streams JSON from the request body, compacts it, and installs it if the caller holds the lease. Optional CAS headers guard against concurrent updates.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "lease"
                ],
                "summary": "Atomically update the JSON state for a key",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Namespace override (defaults to server setting)",
                        "name": "namespace",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Lease key",
                        "name": "key",
                        "in": "query",
                        "required": true
                    },
                    {
                        "type": "string",
                        "description": "Lease identifier",
                        "name": "X-Lease-ID",
                        "in": "header",
                        "required": true
                    },
                    {
                        "type": "string",
                        "description": "Optional fencing token proof",
                        "name": "X-Fencing-Token",
                        "in": "header"
                    },
                    {
                        "type": "string",
                        "description": "Conditionally update when the current version matches",
                        "name": "X-If-Version",
                        "in": "header"
                    },
                    {
                        "type": "string",
                        "description": "Conditionally update when the state ETag matches",
                        "name": "X-If-State-ETag",
                        "in": "header"
                    },
                    {
                        "description": "New JSON state payload",
                        "name": "state",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.UpdateResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Conflict",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "503": {
                        "description": "Service Unavailable",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        }
    },
    "definitions": {
        "api.AckRequest": {
            "type": "object",
            "properties": {
                "fencing_token": {
                    "type": "integer"
                },
                "lease_id": {
                    "type": "string"
                },
                "message_id": {
                    "type": "string"
                },
                "meta_etag": {
                    "type": "string"
                },
                "namespace": {
                    "type": "string"
                },
                "queue": {
                    "type": "string"
                },
                "state_etag": {
                    "type": "string"
                },
                "state_fencing_token": {
                    "type": "integer"
                },
                "state_lease_id": {
                    "type": "string"
                }
            }
        },
        "api.AckResponse": {
            "type": "object",
            "properties": {
                "acked": {
                    "type": "boolean"
                },
                "correlation_id": {
                    "type": "string"
                }
            }
        },
        "api.AcquireRequest": {
            "type": "object",
            "properties": {
                "block_seconds": {
                    "type": "integer"
                },
                "key": {
                    "type": "string"
                },
                "namespace": {
                    "type": "string"
                },
                "owner": {
                    "type": "string"
                },
                "ttl_seconds": {
                    "type": "integer"
                }
            }
        },
        "api.AcquireResponse": {
            "type": "object",
            "properties": {
                "correlation_id": {
                    "type": "string"
                },
                "expires_at_unix": {
                    "type": "integer"
                },
                "fencing_token": {
                    "type": "integer"
                },
                "key": {
                    "type": "string"
                },
                "lease_id": {
                    "type": "string"
                },
                "namespace": {
                    "type": "string"
                },
                "owner": {
                    "type": "string"
                },
                "retry_after_seconds": {
                    "type": "integer"
                },
                "state_etag": {
                    "type": "string"
                },
                "version": {
                    "type": "integer"
                }
            }
        },
        "api.DequeueRequest": {
            "type": "object",
            "properties": {
                "namespace": {
                    "type": "string"
                },
                "owner": {
                    "type": "string"
                },
                "page_size": {
                    "type": "integer"
                },
                "queue": {
                    "type": "string"
                },
                "start_after": {
                    "type": "string"
                },
                "visibility_timeout_seconds": {
                    "type": "integer"
                },
                "wait_seconds": {
                    "type": "integer"
                }
            }
        },
        "api.DescribeResponse": {
            "type": "object",
            "properties": {
                "expires_at_unix": {
                    "type": "integer"
                },
                "key": {
                    "type": "string"
                },
                "lease_id": {
                    "type": "string"
                },
                "namespace": {
                    "type": "string"
                },
                "owner": {
                    "type": "string"
                },
                "state_etag": {
                    "type": "string"
                },
                "updated_at_unix": {
                    "type": "integer"
                },
                "version": {
                    "type": "integer"
                }
            }
        },
        "api.EnqueueResponse": {
            "type": "object",
            "properties": {
                "attempts": {
                    "type": "integer"
                },
                "correlation_id": {
                    "type": "string"
                },
                "max_attempts": {
                    "type": "integer"
                },
                "message_id": {
                    "type": "string"
                },
                "namespace": {
                    "type": "string"
                },
                "not_visible_until_unix": {
                    "type": "integer"
                },
                "payload_bytes": {
                    "type": "integer"
                },
                "queue": {
                    "type": "string"
                },
                "visibility_timeout_seconds": {
                    "type": "integer"
                }
            }
        },
        "api.ErrorResponse": {
            "type": "object",
            "properties": {
                "current_etag": {
                    "type": "string"
                },
                "current_version": {
                    "type": "integer"
                },
                "detail": {
                    "type": "string"
                },
                "error": {
                    "type": "string"
                },
                "retry_after_seconds": {
                    "type": "integer"
                }
            }
        },
        "api.ExtendRequest": {
            "type": "object",
            "properties": {
                "extend_by_seconds": {
                    "type": "integer"
                },
                "fencing_token": {
                    "type": "integer"
                },
                "lease_id": {
                    "type": "string"
                },
                "message_id": {
                    "type": "string"
                },
                "meta_etag": {
                    "type": "string"
                },
                "namespace": {
                    "type": "string"
                },
                "queue": {
                    "type": "string"
                },
                "state_fencing_token": {
                    "type": "integer"
                },
                "state_lease_id": {
                    "type": "string"
                }
            }
        },
        "api.ExtendResponse": {
            "type": "object",
            "properties": {
                "correlation_id": {
                    "type": "string"
                },
                "lease_expires_at_unix": {
                    "type": "integer"
                },
                "meta_etag": {
                    "type": "string"
                },
                "state_lease_expires_at_unix": {
                    "type": "integer"
                },
                "visibility_timeout_seconds": {
                    "type": "integer"
                }
            }
        },
        "api.KeepAliveRequest": {
            "type": "object",
            "properties": {
                "key": {
                    "type": "string"
                },
                "lease_id": {
                    "type": "string"
                },
                "namespace": {
                    "type": "string"
                },
                "ttl_seconds": {
                    "type": "integer"
                }
            }
        },
        "api.KeepAliveResponse": {
            "type": "object",
            "properties": {
                "expires_at_unix": {
                    "type": "integer"
                }
            }
        },
        "api.NackRequest": {
            "type": "object",
            "properties": {
                "delay_seconds": {
                    "type": "integer"
                },
                "fencing_token": {
                    "type": "integer"
                },
                "last_error": {},
                "lease_id": {
                    "type": "string"
                },
                "message_id": {
                    "type": "string"
                },
                "meta_etag": {
                    "type": "string"
                },
                "namespace": {
                    "type": "string"
                },
                "queue": {
                    "type": "string"
                },
                "state_fencing_token": {
                    "type": "integer"
                },
                "state_lease_id": {
                    "type": "string"
                }
            }
        },
        "api.NackResponse": {
            "type": "object",
            "properties": {
                "correlation_id": {
                    "type": "string"
                },
                "meta_etag": {
                    "type": "string"
                },
                "requeued": {
                    "type": "boolean"
                }
            }
        },
        "api.ReleaseRequest": {
            "type": "object",
            "properties": {
                "key": {
                    "type": "string"
                },
                "lease_id": {
                    "type": "string"
                },
                "namespace": {
                    "type": "string"
                }
            }
        },
        "api.ReleaseResponse": {
            "type": "object",
            "properties": {
                "released": {
                    "type": "boolean"
                }
            }
        },
        "api.RemoveResponse": {
            "type": "object",
            "properties": {
                "new_version": {
                    "type": "integer"
                },
                "removed": {
                    "type": "boolean"
                }
            }
        },
        "api.UpdateResponse": {
            "type": "object",
            "properties": {
                "bytes": {
                    "type": "integer"
                },
                "new_state_etag": {
                    "type": "string"
                },
                "new_version": {
                    "type": "integer"
                }
            }
        }
    },
    "securityDefinitions": {
        "mTLS": {
            "description": "Mutual TLS is required in production deployments; place holder header documents client certificate identity propagation.",
            "type": "apiKey",
            "name": "X-Client-Cert",
            "in": "header"
        }
    },
    "tags": [
        {
            "description": "Lease acquisition, keepalive, release, and state management.",
            "name": "lease"
        },
        {
            "description": "Queue enqueue, dequeue, acknowledgement, and lifecycle operations.",
            "name": "queue"
        },
        {
            "description": "Service health and readiness probes.",
            "name": "system"
        }
    ]
}