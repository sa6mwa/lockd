basePath: /v1
consumes:
- application/json
definitions:
  api.AckRequest:
    properties:
      fencing_token:
        type: integer
      lease_id:
        type: string
      message_id:
        type: string
      meta_etag:
        type: string
      namespace:
        type: string
      queue:
        type: string
      state_etag:
        type: string
      state_fencing_token:
        type: integer
      state_lease_id:
        type: string
      txn_id:
        type: string
    type: object
  api.AckResponse:
    properties:
      acked:
        type: boolean
      correlation_id:
        type: string
    type: object
  api.AcquireRequest:
    properties:
      block_seconds:
        type: integer
      key:
        type: string
      namespace:
        type: string
      owner:
        type: string
      ttl_seconds:
        type: integer
      txn_id:
        type: string
    type: object
  api.AcquireResponse:
    properties:
      correlation_id:
        type: string
      expires_at_unix:
        type: integer
      fencing_token:
        type: integer
      key:
        type: string
      lease_id:
        type: string
      namespace:
        type: string
      owner:
        type: string
      retry_after_seconds:
        type: integer
      state_etag:
        type: string
      txn_id:
        type: string
      version:
        type: integer
    type: object
  api.AttachmentInfo:
    properties:
      content_type:
        type: string
      created_at_unix:
        type: integer
      id:
        type: string
      name:
        type: string
      size:
        type: integer
      updated_at_unix:
        type: integer
    type: object
  api.AttachmentListResponse:
    properties:
      attachments:
        items:
          $ref: '#/definitions/api.AttachmentInfo'
        type: array
      key:
        type: string
      namespace:
        type: string
    type: object
  api.DequeueRequest:
    properties:
      namespace:
        type: string
      owner:
        type: string
      page_size:
        type: integer
      queue:
        type: string
      start_after:
        type: string
      txn_id:
        type: string
      visibility_timeout_seconds:
        type: integer
      wait_seconds:
        type: integer
    type: object
  api.DequeueResponse:
    properties:
      message:
        $ref: '#/definitions/api.Message'
      next_cursor:
        type: string
    type: object
  api.DescribeResponse:
    properties:
      expires_at_unix:
        type: integer
      key:
        type: string
      lease_id:
        type: string
      metadata:
        $ref: '#/definitions/api.MetadataAttributes'
      namespace:
        type: string
      owner:
        type: string
      state_etag:
        type: string
      updated_at_unix:
        type: integer
      version:
        type: integer
    type: object
  api.EnqueueResponse:
    properties:
      attempts:
        type: integer
      correlation_id:
        type: string
      max_attempts:
        type: integer
      message_id:
        type: string
      namespace:
        type: string
      not_visible_until_unix:
        type: integer
      payload_bytes:
        type: integer
      queue:
        type: string
      visibility_timeout_seconds:
        type: integer
    type: object
  api.ErrorResponse:
    properties:
      current_etag:
        type: string
      current_version:
        type: integer
      detail:
        type: string
      error:
        type: string
      leader_endpoint:
        type: string
      retry_after_seconds:
        type: integer
    type: object
  api.ExtendRequest:
    properties:
      extend_by_seconds:
        type: integer
      fencing_token:
        type: integer
      lease_id:
        type: string
      message_id:
        type: string
      meta_etag:
        type: string
      namespace:
        type: string
      queue:
        type: string
      state_fencing_token:
        type: integer
      state_lease_id:
        type: string
      txn_id:
        type: string
    type: object
  api.ExtendResponse:
    properties:
      correlation_id:
        type: string
      lease_expires_at_unix:
        type: integer
      meta_etag:
        type: string
      state_lease_expires_at_unix:
        type: integer
      visibility_timeout_seconds:
        type: integer
    type: object
  api.IndexFlushRequest:
    properties:
      mode:
        type: string
      namespace:
        type: string
    type: object
  api.IndexFlushResponse:
    properties:
      accepted:
        type: boolean
      flush_id:
        type: string
      flushed:
        type: boolean
      index_seq:
        type: integer
      mode:
        type: string
      namespace:
        type: string
      pending:
        type: boolean
    type: object
  api.KeepAliveRequest:
    properties:
      key:
        type: string
      lease_id:
        type: string
      namespace:
        type: string
      ttl_seconds:
        type: integer
      txn_id:
        type: string
    type: object
  api.KeepAliveResponse:
    properties:
      expires_at_unix:
        type: integer
    type: object
  api.Message:
    properties:
      attempts:
        type: integer
      attributes:
        additionalProperties: {}
        type: object
      correlation_id:
        type: string
      fencing_token:
        type: integer
      lease_expires_at_unix:
        type: integer
      lease_id:
        type: string
      max_attempts:
        type: integer
      message_id:
        type: string
      meta_etag:
        type: string
      namespace:
        type: string
      not_visible_until_unix:
        type: integer
      payload_bytes:
        type: integer
      payload_content_type:
        type: string
      queue:
        type: string
      state_etag:
        type: string
      state_fencing_token:
        type: integer
      state_lease_expires_at_unix:
        type: integer
      state_lease_id:
        type: string
      state_txn_id:
        type: string
      txn_id:
        type: string
      visibility_timeout_seconds:
        type: integer
    type: object
  api.MetadataAttributes:
    properties:
      query_hidden:
        type: boolean
    type: object
  api.MetadataUpdateResponse:
    properties:
      key:
        type: string
      metadata:
        $ref: '#/definitions/api.MetadataAttributes'
      namespace:
        type: string
      version:
        type: integer
    type: object
  api.NackRequest:
    properties:
      delay_seconds:
        type: integer
      fencing_token:
        type: integer
      last_error: {}
      lease_id:
        type: string
      message_id:
        type: string
      meta_etag:
        type: string
      namespace:
        type: string
      queue:
        type: string
      state_etag:
        type: string
      state_fencing_token:
        type: integer
      state_lease_id:
        type: string
      txn_id:
        type: string
    type: object
  api.NackResponse:
    properties:
      correlation_id:
        type: string
      meta_etag:
        type: string
      requeued:
        type: boolean
    type: object
  api.NamespaceConfigRequest:
    properties:
      namespace:
        type: string
      query:
        $ref: '#/definitions/api.NamespaceQueryConfig'
    type: object
  api.NamespaceConfigResponse:
    properties:
      namespace:
        type: string
      query:
        $ref: '#/definitions/api.NamespaceQueryConfig'
    type: object
  api.NamespaceQueryConfig:
    properties:
      fallback_engine:
        type: string
      preferred_engine:
        type: string
    type: object
  api.QueryRequest:
    properties:
      cursor:
        type: string
      fields:
        additionalProperties: {}
        type: object
      limit:
        type: integer
      namespace:
        type: string
      return:
        $ref: '#/definitions/api.QueryReturn'
      selector:
        type: object
        x-example: '{"eq":{"field":"type","value":"alpha"}}'
    type: object
  api.QueryResponse:
    properties:
      cursor:
        type: string
      index_seq:
        type: integer
      keys:
        items:
          type: string
        type: array
      metadata:
        additionalProperties:
          type: string
        type: object
      namespace:
        type: string
    type: object
  api.QueryReturn:
    enum:
    - keys
    - documents
    type: string
    x-enum-varnames:
    - QueryReturnKeys
    - QueryReturnDocuments
  api.ReleaseRequest:
    properties:
      key:
        type: string
      lease_id:
        type: string
      namespace:
        type: string
      rollback:
        type: boolean
      txn_id:
        type: string
    type: object
  api.ReleaseResponse:
    properties:
      released:
        type: boolean
    type: object
  api.RemoveResponse:
    properties:
      new_version:
        type: integer
      removed:
        type: boolean
    type: object
  api.TCClusterAnnounceRequest:
    properties:
      self_endpoint:
        type: string
    type: object
  api.TCClusterAnnounceResponse:
    properties:
      endpoints:
        items:
          type: string
        type: array
      expires_at_unix:
        type: integer
      updated_at_unix:
        type: integer
    type: object
  api.TCClusterLeaveRequest:
    type: object
  api.TCClusterLeaveResponse:
    properties:
      endpoints:
        items:
          type: string
        type: array
      updated_at_unix:
        type: integer
    type: object
  api.TCClusterListResponse:
    properties:
      endpoints:
        items:
          type: string
        type: array
      updated_at_unix:
        type: integer
    type: object
  api.TCLeaderResponse:
    properties:
      expires_at:
        type: integer
      leader_endpoint:
        type: string
      leader_id:
        type: string
      term:
        type: integer
    type: object
  api.TCLeaseAcquireRequest:
    properties:
      candidate_endpoint:
        type: string
      candidate_id:
        type: string
      term:
        type: integer
      ttl_ms:
        type: integer
    type: object
  api.TCLeaseAcquireResponse:
    properties:
      expires_at:
        type: integer
      granted:
        type: boolean
      leader_endpoint:
        type: string
      leader_id:
        type: string
      term:
        type: integer
    type: object
  api.TCLeaseReleaseRequest:
    properties:
      leader_id:
        type: string
      term:
        type: integer
    type: object
  api.TCLeaseReleaseResponse:
    properties:
      released:
        type: boolean
    type: object
  api.TCLeaseRenewRequest:
    properties:
      leader_id:
        type: string
      term:
        type: integer
      ttl_ms:
        type: integer
    type: object
  api.TCLeaseRenewResponse:
    properties:
      expires_at:
        type: integer
      leader_endpoint:
        type: string
      leader_id:
        type: string
      renewed:
        type: boolean
      term:
        type: integer
    type: object
  api.TCRMBackend:
    properties:
      backend_hash:
        type: string
      endpoints:
        items:
          type: string
        type: array
      updated_at_unix:
        type: integer
    type: object
  api.TCRMListResponse:
    properties:
      backends:
        items:
          $ref: '#/definitions/api.TCRMBackend'
        type: array
      updated_at_unix:
        type: integer
    type: object
  api.TCRMRegisterRequest:
    properties:
      backend_hash:
        type: string
      endpoint:
        type: string
    type: object
  api.TCRMRegisterResponse:
    properties:
      backend_hash:
        type: string
      endpoints:
        items:
          type: string
        type: array
      updated_at_unix:
        type: integer
    type: object
  api.TCRMUnregisterRequest:
    properties:
      backend_hash:
        type: string
      endpoint:
        type: string
    type: object
  api.TCRMUnregisterResponse:
    properties:
      backend_hash:
        type: string
      endpoints:
        items:
          type: string
        type: array
      updated_at_unix:
        type: integer
    type: object
  api.TxnDecisionRequest:
    properties:
      expires_at_unix:
        type: integer
      participants:
        items:
          $ref: '#/definitions/api.TxnParticipant'
        type: array
      state:
        description: pending|commit|rollback
        type: string
      target_backend_hash:
        description: TargetBackendHash scopes RM apply requests to a specific backend
          island.
        type: string
      tc_term:
        description: TCTerm is the current TC leader term for this decision.
        type: integer
      txn_id:
        type: string
    type: object
  api.TxnDecisionResponse:
    properties:
      state:
        type: string
      txn_id:
        type: string
    type: object
  api.TxnParticipant:
    properties:
      backend_hash:
        description: BackendHash identifies the storage backend island for this participant.
        type: string
      key:
        type: string
      namespace:
        type: string
    type: object
  api.TxnReplayRequest:
    properties:
      txn_id:
        type: string
    type: object
  api.TxnReplayResponse:
    properties:
      state:
        type: string
      txn_id:
        type: string
    type: object
  api.UpdateResponse:
    properties:
      bytes:
        type: integer
      metadata:
        $ref: '#/definitions/api.MetadataAttributes'
      new_state_etag:
        type: string
      new_version:
        type: integer
    type: object
  httpapi.metadataMutation:
    properties:
      query_hidden:
        type: boolean
    type: object
info:
  contact:
    email: sa6mwa@gmail.com
    name: Michel Blomgren
    url: https://pkt.systems
  description: lockd exposes exclusive lease management, atomic JSON checkpoints,
    and resilient work queues over HTTPS.
  license:
    name: MIT
    url: https://opensource.org/license/mit/
  title: lockd API
  version: "0.0"
paths:
  /healthz:
    get:
      produces:
      - text/plain
      responses:
        "200":
          description: OK
          schema:
            type: string
      summary: Liveness probe
      tags:
      - system
  /readyz:
    get:
      produces:
      - text/plain
      responses:
        "200":
          description: Ready
          schema:
            type: string
      summary: Readiness probe
      tags:
      - system
  /v1/acquire:
    post:
      consumes:
      - application/json
      description: Acquire or wait for an exclusive lease on a key. When block_seconds
        > 0 the request will long-poll until a lease becomes available or the timeout
        elapses. Returns a compact xid-based `lease_id` and `txn_id` (20-char lowercase
        base32, e.g. `c5v9d0sl70b3m3q8ndg0`) that must be echoed on write operations.
        Namespaces starting with `.` are reserved (e.g. `.txns`) and will be rejected.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Key to acquire when the request body omits it
        in: query
        name: key
        type: string
      - description: Existing transaction identifier (xid) to join a multi-key transaction
        in: header
        name: X-Txn-ID
        type: string
      - description: Lease acquisition parameters
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.AcquireRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.AcquireResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Acquire an exclusive lease
      tags:
      - lease
  /v1/attachment:
    delete:
      consumes:
      - application/json
      description: Streams a single attachment (GET) or stages its deletion (DELETE).
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Lease key
        in: query
        name: key
        required: true
        type: string
      - description: Attachment name
        in: query
        name: name
        type: string
      - description: Attachment id
        in: query
        name: id
        type: string
      - description: Set to true to read without a lease (GET)
        in: query
        name: public
        type: boolean
      - description: Lease identifier (required unless public=1)
        in: header
        name: X-Lease-ID
        type: string
      - description: Transaction identifier (required for lease operations)
        in: header
        name: X-Txn-ID
        type: string
      - description: Optional fencing token proof
        in: header
        name: X-Fencing-Token
        type: string
      produces:
      - application/octet-stream
      responses:
        "200":
          description: Attachment payload
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Retrieve or delete a state attachment
      tags:
      - lease
    get:
      consumes:
      - application/json
      description: Streams a single attachment (GET) or stages its deletion (DELETE).
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Lease key
        in: query
        name: key
        required: true
        type: string
      - description: Attachment name
        in: query
        name: name
        type: string
      - description: Attachment id
        in: query
        name: id
        type: string
      - description: Set to true to read without a lease (GET)
        in: query
        name: public
        type: boolean
      - description: Lease identifier (required unless public=1)
        in: header
        name: X-Lease-ID
        type: string
      - description: Transaction identifier (required for lease operations)
        in: header
        name: X-Txn-ID
        type: string
      - description: Optional fencing token proof
        in: header
        name: X-Fencing-Token
        type: string
      produces:
      - application/octet-stream
      responses:
        "200":
          description: Attachment payload
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Retrieve or delete a state attachment
      tags:
      - lease
  /v1/attachments:
    delete:
      consumes:
      - application/octet-stream
      description: Upload, list, or delete attachments for a key depending on the
        HTTP method.
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Lease key
        in: query
        name: key
        required: true
        type: string
      - description: Attachment name (upload/delete)
        in: query
        name: name
        type: string
      - description: Attachment id (delete)
        in: query
        name: id
        type: string
      - description: Set to true to read without a lease (list)
        in: query
        name: public
        type: boolean
      - description: Attachment content type (upload)
        in: query
        name: content_type
        type: string
      - description: Maximum attachment size (0 = unlimited)
        format: int64
        in: query
        name: max_bytes
        type: integer
      - description: Do not overwrite existing attachments (upload)
        in: query
        name: prevent_overwrite
        type: boolean
      - description: Lease identifier (required unless public=1)
        in: header
        name: X-Lease-ID
        type: string
      - description: Transaction identifier (required for lease operations)
        in: header
        name: X-Txn-ID
        type: string
      - description: Optional fencing token proof
        in: header
        name: X-Fencing-Token
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.AttachmentListResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Manage state attachments
      tags:
      - lease
    get:
      consumes:
      - application/octet-stream
      description: Upload, list, or delete attachments for a key depending on the
        HTTP method.
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Lease key
        in: query
        name: key
        required: true
        type: string
      - description: Attachment name (upload/delete)
        in: query
        name: name
        type: string
      - description: Attachment id (delete)
        in: query
        name: id
        type: string
      - description: Set to true to read without a lease (list)
        in: query
        name: public
        type: boolean
      - description: Attachment content type (upload)
        in: query
        name: content_type
        type: string
      - description: Maximum attachment size (0 = unlimited)
        format: int64
        in: query
        name: max_bytes
        type: integer
      - description: Do not overwrite existing attachments (upload)
        in: query
        name: prevent_overwrite
        type: boolean
      - description: Lease identifier (required unless public=1)
        in: header
        name: X-Lease-ID
        type: string
      - description: Transaction identifier (required for lease operations)
        in: header
        name: X-Txn-ID
        type: string
      - description: Optional fencing token proof
        in: header
        name: X-Fencing-Token
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.AttachmentListResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Manage state attachments
      tags:
      - lease
    post:
      consumes:
      - application/octet-stream
      description: Upload, list, or delete attachments for a key depending on the
        HTTP method.
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Lease key
        in: query
        name: key
        required: true
        type: string
      - description: Attachment name (upload/delete)
        in: query
        name: name
        type: string
      - description: Attachment id (delete)
        in: query
        name: id
        type: string
      - description: Set to true to read without a lease (list)
        in: query
        name: public
        type: boolean
      - description: Attachment content type (upload)
        in: query
        name: content_type
        type: string
      - description: Maximum attachment size (0 = unlimited)
        format: int64
        in: query
        name: max_bytes
        type: integer
      - description: Do not overwrite existing attachments (upload)
        in: query
        name: prevent_overwrite
        type: boolean
      - description: Lease identifier (required unless public=1)
        in: header
        name: X-Lease-ID
        type: string
      - description: Transaction identifier (required for lease operations)
        in: header
        name: X-Txn-ID
        type: string
      - description: Optional fencing token proof
        in: header
        name: X-Fencing-Token
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.AttachmentListResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Manage state attachments
      tags:
      - lease
  /v1/describe:
    get:
      description: Returns lease and state metadata without streaming the state payload.
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Lease key
        in: query
        name: key
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.DescribeResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Inspect metadata for a key
      tags:
      - lease
  /v1/get:
    post:
      consumes:
      - application/json
      description: Streams the currently committed JSON state for the key owned by
        the caller's lease (or, when public=1, the latest published snapshot). Returns
        204 when no state is present.
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Lease key
        in: query
        name: key
        required: true
        type: string
      - description: Set to true to read without a lease (served from published data)
        in: query
        name: public
        type: boolean
      - description: Lease identifier (required unless public=1)
        in: header
        name: X-Lease-ID
        type: string
      - description: Optional fencing token proof (lease requests only)
        in: header
        name: X-Fencing-Token
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Streamed JSON state
          schema:
            additionalProperties: true
            type: object
        "204":
          description: No state stored for this key
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Read the JSON checkpoint for a key
      tags:
      - lease
  /v1/index/flush:
    post:
      consumes:
      - application/json
      description: Forces the namespace index writer to flush pending documents. Supports
        synchronous (wait) and asynchronous modes.
      parameters:
      - description: Namespace override
        in: query
        name: namespace
        type: string
      - description: Flush mode (wait or async)
        in: query
        name: mode
        type: string
      - description: Flush request
        in: body
        name: request
        schema:
          $ref: '#/definitions/api.IndexFlushRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.IndexFlushResponse'
        "202":
          description: Accepted
          schema:
            $ref: '#/definitions/api.IndexFlushResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Flush namespace index segments
      tags:
      - index
  /v1/keepalive:
    post:
      consumes:
      - application/json
      description: Refresh an existing lease before it expires. Requires the xid lease
        identifier minted by Acquire and its fencing token; returns the new expiration
        timestamp.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Key override when the request body omits it
        in: query
        name: key
        type: string
      - description: Lease keepalive parameters
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.KeepAliveRequest'
      - description: Fencing token associated with the lease (from Acquire response)
        in: header
        name: X-Fencing-Token
        required: true
        type: string
      - description: Transaction identifier (required when the lease is enlisted in
          a txn)
        in: header
        name: X-Txn-ID
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.KeepAliveResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Extend an active lease TTL
      tags:
      - lease
  /v1/metadata:
    post:
      consumes:
      - application/json
      description: Mutates lock metadata (e.g. query visibility) while holding the
        lease. Optional CAS headers guard against concurrent updates.
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Lease key
        in: query
        name: key
        required: true
        type: string
      - description: Lease identifier (xid from Acquire, 20-char lowercase base32)
        in: header
        name: X-Lease-ID
        required: true
        type: string
      - description: Transaction identifier (xid from Acquire)
        in: header
        name: X-Txn-ID
        required: true
        type: string
      - description: Optional fencing token proof
        in: header
        name: X-Fencing-Token
        type: string
      - description: Conditionally update when the current version matches
        in: header
        name: X-If-Version
        type: string
      - description: Metadata payload
        in: body
        name: metadata
        required: true
        schema:
          $ref: '#/definitions/httpapi.metadataMutation'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.MetadataUpdateResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Update lock metadata
      tags:
      - lease
  /v1/namespace:
    get:
      description: Returns query engine preferences for the namespace.
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.NamespaceConfigResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Get namespace configuration
      tags:
      - namespace
    post:
      consumes:
      - application/json
      description: Updates query engine preferences for the namespace.
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Conditionally update when the ETag matches
        in: header
        name: If-Match
        type: string
      - description: Namespace configuration payload
        in: body
        name: config
        required: true
        schema:
          $ref: '#/definitions/api.NamespaceConfigRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.NamespaceConfigResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Update namespace configuration
      tags:
      - namespace
  /v1/query:
    post:
      consumes:
      - application/json
      description: Executes a selector-based search within a namespace. When return=keys,
        responds with a JSON envelope containing keys + cursor. When return=documents,
        streams NDJSON rows (one document per line).
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Maximum number of keys to return (1-1000, defaults to 100)
        in: query
        name: limit
        type: integer
      - description: Opaque pagination cursor
        in: query
        name: cursor
        type: string
      - description: Selector JSON (optional when providing a JSON body)
        in: query
        name: selector
        type: string
      - description: Return mode (keys or documents)
        in: query
        name: return
        type: string
      - description: Query request (selector, limit, cursor)
        in: body
        name: request
        schema:
          $ref: '#/definitions/api.QueryRequest'
      produces:
      - application/json
      - application/x-ndjson
      responses:
        "200":
          description: NDJSON stream when return=documents
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      summary: Query keys within a namespace
      tags:
      - lease
  /v1/queue/ack:
    post:
      consumes:
      - application/json
      description: Confirms processing of a delivery and deletes the message or its
        retry lease. If a txn_id is present (or the lease is already enlisted) and
        TC is enabled, this records a commit decision via the TC.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Acknowledgement payload
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.AckRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.AckResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Acknowledge a delivered message
      tags:
      - queue
  /v1/queue/dequeue:
    post:
      consumes:
      - application/json
      description: Dequeues one or more messages from the specified queue. Supports
        long polling via wait_seconds. If txn_id is provided, the message is enlisted
        as a transaction participant.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Queue name override when the request body omits it
        in: query
        name: queue
        type: string
      - description: Owner override when the request body omits it
        in: query
        name: owner
        type: string
      - description: Dequeue parameters (queue, owner, wait_seconds, visibility)
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.DequeueRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.DequeueResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Dequeue messages
      tags:
      - queue
  /v1/queue/dequeueWithState:
    post:
      consumes:
      - application/json
      description: Dequeues messages and includes their associated state blobs in
        a multipart/related response when available. If txn_id is provided, the message
        and state sidecar are enlisted as transaction participants.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Queue name override when the request body omits it
        in: query
        name: queue
        type: string
      - description: Owner override when the request body omits it
        in: query
        name: owner
        type: string
      - description: Dequeue parameters
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.DequeueRequest'
      produces:
      - multipart/related
      responses:
        "200":
          description: 'multipart/related stream: message metadata, payload, optional
            state sidecar'
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Fetch queue messages with state sidecars
      tags:
      - queue
  /v1/queue/enqueue:
    post:
      consumes:
      - multipart/form-data
      description: Writes a message into the durable queue. The payload is streamed
        directly and may include optional attributes.
      parameters:
      - description: Namespace override when the metadata omits it
        in: query
        name: namespace
        type: string
      - description: Queue override when the metadata omits it
        in: query
        name: queue
        type: string
      - description: JSON encoded api.EnqueueRequest metadata
        in: formData
        name: meta
        required: true
        type: string
      - description: Optional payload stream
        in: formData
        name: payload
        type: file
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.EnqueueResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Enqueue a message
      tags:
      - queue
  /v1/queue/extend:
    post:
      consumes:
      - application/json
      description: Extends the visibility timeout and lease window for an in-flight
        message. txn_id is optional; if omitted the server uses the lease's txn_id
        (if any).
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Extend payload
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.ExtendRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.ExtendResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Extend a delivery lease
      tags:
      - queue
  /v1/queue/nack:
    post:
      consumes:
      - application/json
      description: Requeues the delivery with optional delay and last error metadata.
        If a txn_id is present (or the lease is already enlisted) and TC is enabled,
        this records a rollback decision via the TC.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Negative acknowledgement payload
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.NackRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.NackResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Return a message to the queue
      tags:
      - queue
  /v1/queue/subscribe:
    post:
      consumes:
      - application/json
      description: Opens a long-lived multipart/related stream of deliveries for the
        specified queue owner. Each part contains message metadata and payload. If
        txn_id is provided, each delivery is enlisted as a transaction participant.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Queue name override when the request body omits it
        in: query
        name: queue
        type: string
      - description: Owner override when the request body omits it
        in: query
        name: owner
        type: string
      - description: Subscription parameters (queue, owner, wait_seconds, visibility)
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.DequeueRequest'
      produces:
      - multipart/related
      responses:
        "200":
          description: 'multipart/related stream: message metadata + payload'
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Stream queue deliveries
      tags:
      - queue
  /v1/queue/subscribeWithState:
    post:
      consumes:
      - application/json
      description: Opens a long-lived multipart/related stream where each part contains
        message metadata, payload, and state snapshot when available. If txn_id is
        provided, the message and state sidecar are enlisted as transaction participants.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Queue name override when the request body omits it
        in: query
        name: queue
        type: string
      - description: Owner override when the request body omits it
        in: query
        name: owner
        type: string
      - description: Subscription parameters (queue, owner, wait_seconds, visibility)
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.DequeueRequest'
      produces:
      - multipart/related
      responses:
        "200":
          description: 'multipart/related stream: message metadata, payload, optional
            state snapshot'
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Stream queue deliveries with state
      tags:
      - queue
  /v1/release:
    post:
      consumes:
      - application/json
      description: Releases the lease associated with the provided key and lease identifier.
        The request must include the xid `txn_id` from Acquire; set `rollback=true`
        to abandon staged changes, otherwise the release commits the staged state.
      parameters:
      - description: Namespace override when the request body omits it
        in: query
        name: namespace
        type: string
      - description: Key override when the request body omits it
        in: query
        name: key
        type: string
      - description: Lease release parameters
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.ReleaseRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.ReleaseResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Release a held lease
      tags:
      - lease
  /v1/remove:
    post:
      consumes:
      - application/json
      description: Removes the stored state blob if the caller holds the lease. Optional
        CAS headers guard against concurrent updates.
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Lease key
        in: query
        name: key
        required: true
        type: string
      - description: Lease identifier (xid from Acquire, 20-char lowercase base32)
        in: header
        name: X-Lease-ID
        required: true
        type: string
      - description: Transaction identifier (xid from Acquire)
        in: header
        name: X-Txn-ID
        required: true
        type: string
      - description: Optional fencing token proof
        in: header
        name: X-Fencing-Token
        type: string
      - description: Conditionally remove when version matches
        in: header
        name: X-If-Version
        type: string
      - description: Conditionally remove when state ETag matches
        in: header
        name: X-If-State-ETag
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.RemoveResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Delete the JSON state for a key
      tags:
      - lease
  /v1/tc/cluster/announce:
    post:
      consumes:
      - application/json
      description: Refreshes the caller's membership lease. Requires TC-auth with
        a server certificate when mTLS is enabled (unless tc-disable-auth is set).
      parameters:
      - description: TC cluster announce request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.TCClusterAnnounceRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.TCClusterAnnounceResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Announce TC cluster membership
      tags:
      - transaction
  /v1/tc/cluster/leave:
    post:
      consumes:
      - application/json
      description: Deletes the caller's membership lease. Requires TC-auth with a
        server certificate when mTLS is enabled (unless tc-disable-auth is set).
      parameters:
      - description: TC cluster leave request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.TCClusterLeaveRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.TCClusterLeaveResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Leave the TC cluster
      tags:
      - transaction
  /v1/tc/cluster/list:
    get:
      description: List the current active TC cluster membership list. Requires TC-auth
        when mTLS is enabled (unless tc-disable-auth is set).
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.TCClusterListResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: List TC cluster membership
      tags:
      - transaction
  /v1/tc/leader:
    get:
      description: Returns the observed TC leader state. Requires TC-auth when mTLS
        is enabled (unless tc-disable-auth is set).
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.TCLeaderResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Return TC leader state
      tags:
      - transaction
  /v1/tc/lease/acquire:
    post:
      consumes:
      - application/json
      description: Acquire a TC leader lease as part of the TC election quorum. Requires
        TC-auth when mTLS is enabled (unless tc-disable-auth is set).
      parameters:
      - description: TC lease acquire request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.TCLeaseAcquireRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.TCLeaseAcquireResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Acquire a TC leader lease
      tags:
      - transaction
  /v1/tc/lease/release:
    post:
      consumes:
      - application/json
      description: Release a TC leader lease as part of the TC election quorum. Requires
        TC-auth when mTLS is enabled (unless tc-disable-auth is set).
      parameters:
      - description: TC lease release request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.TCLeaseReleaseRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.TCLeaseReleaseResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Release a TC leader lease
      tags:
      - transaction
  /v1/tc/lease/renew:
    post:
      consumes:
      - application/json
      description: Renew a TC leader lease as part of the TC election quorum. Requires
        TC-auth when mTLS is enabled (unless tc-disable-auth is set).
      parameters:
      - description: TC lease renew request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.TCLeaseRenewRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.TCLeaseRenewResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Renew a TC leader lease
      tags:
      - transaction
  /v1/tc/rm/list:
    get:
      description: List RM endpoints by backend hash. Requires TC-auth when mTLS is
        enabled (unless tc-disable-auth is set).
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.TCRMListResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: List RM registry entries
      tags:
      - transaction
  /v1/tc/rm/register:
    post:
      consumes:
      - application/json
      description: Register an RM endpoint for a backend hash. Replicates across the
        TC cluster. Requires TC-auth with a server certificate when mTLS is enabled
        (unless tc-disable-auth is set).
      parameters:
      - description: RM register request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.TCRMRegisterRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.TCRMRegisterResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "502":
          description: Bad Gateway
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Register an RM endpoint
      tags:
      - transaction
  /v1/tc/rm/unregister:
    post:
      consumes:
      - application/json
      description: Unregister an RM endpoint for a backend hash. Replicates across
        the TC cluster. Requires TC-auth with a server certificate when mTLS is enabled
        (unless tc-disable-auth is set).
      parameters:
      - description: RM unregister request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.TCRMUnregisterRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.TCRMUnregisterResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "502":
          description: Bad Gateway
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Unregister an RM endpoint
      tags:
      - transaction
  /v1/txn/commit:
    post:
      consumes:
      - application/json
      description: Apply a commit decision for a transaction on the local RM. Requires
        tc_term when TC leadership is enabled. Requires TC-auth when mTLS is enabled
        (unless tc-disable-auth is set).
      parameters:
      - description: Txn decision request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.TxnDecisionRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.TxnDecisionResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Apply a commit decision on an RM
      tags:
      - transaction
  /v1/txn/decide:
    post:
      consumes:
      - application/json
      description: Record a transaction decision (pending|commit|rollback). Commit/rollback
        decisions are applied locally and fan out to RMs. TC-auth only; called by
        lockd RMs or TC tooling. Any TC endpoint can receive this call; non-leaders
        forward to the leader, which stamps the tc_term fencing token. Requires TC-auth
        when mTLS is enabled (unless tc-disable-auth is set).
      parameters:
      - description: Txn decision request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.TxnDecisionRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.TxnDecisionResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "502":
          description: Bad Gateway
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Record a transaction decision
      tags:
      - transaction
  /v1/txn/replay:
    post:
      consumes:
      - application/json
      description: Apply the recorded decision for a transaction (commit or rollback)
        to its participants. Pending transactions remain unchanged unless expired,
        in which case they roll back. Idempotent and safe to retry. Requires TC-auth
        when mTLS is enabled (unless tc-disable-auth is set).
      parameters:
      - description: Txn replay request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.TxnReplayRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.TxnReplayResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Replay a transaction decision
      tags:
      - transaction
  /v1/txn/rollback:
    post:
      consumes:
      - application/json
      description: Apply a rollback decision for a transaction on the local RM. Requires
        tc_term when TC leadership is enabled. Requires TC-auth when mTLS is enabled
        (unless tc-disable-auth is set).
      parameters:
      - description: Txn decision request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.TxnDecisionRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.TxnDecisionResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Apply a rollback decision on an RM
      tags:
      - transaction
  /v1/update:
    post:
      consumes:
      - application/json
      description: Streams JSON from the request body, compacts it, and installs it
        if the caller holds the lease. Optional CAS headers guard against concurrent
        updates.
      parameters:
      - description: Namespace override (defaults to server setting)
        in: query
        name: namespace
        type: string
      - description: Lease key
        in: query
        name: key
        required: true
        type: string
      - description: Lease identifier (xid from Acquire, 20-char lowercase base32)
        in: header
        name: X-Lease-ID
        required: true
        type: string
      - description: Transaction identifier (xid from Acquire)
        in: header
        name: X-Txn-ID
        required: true
        type: string
      - description: Optional fencing token proof
        in: header
        name: X-Fencing-Token
        type: string
      - description: Conditionally update when the current version matches
        in: header
        name: X-If-Version
        type: string
      - description: Conditionally update when the state ETag matches
        in: header
        name: X-If-State-ETag
        type: string
      - description: New JSON state payload
        in: body
        name: state
        required: true
        schema:
          type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.UpdateResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/api.ErrorResponse'
      security:
      - mTLS: []
      summary: Atomically update the JSON state for a key
      tags:
      - lease
produces:
- application/json
schemes:
- https
- http
securityDefinitions:
  mTLS:
    description: Mutual TLS is required in production deployments; place holder header
      documents client certificate identity propagation.
    in: header
    name: X-Client-Cert
    type: apiKey
swagger: "2.0"
tags:
- description: Lease acquisition, keepalive, release, and state management.
  name: lease
- description: Queue enqueue, dequeue, acknowledgement, and lifecycle operations.
  name: queue
- description: Service health and readiness probes.
  name: system
