<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1961px" preserveAspectRatio="none" style="width:1003px;height:1961px;background:#FFFFFF;" version="1.1" viewBox="0 0 1003 1961" width="1003px" zoomAndPan="magnify">
  <rect width="100%" height="100%" fill="#ffffff"/><title>XA happy path (single backend, implicit commit)</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="338.2806" x="328.3963" y="29.9659">XA happy path (single backend, implicit commit)</text><rect fill="none" height="236.336" style="stroke:#000000;stroke-width:1.5;" width="682.561" x="303.5122" y="204.5479"/><rect fill="none" height="170.924" style="stroke:#000000;stroke-width:1.5;" width="662.561" x="313.5122" y="262.9599"/><rect fill="none" height="236.336" style="stroke:#000000;stroke-width:1.5;" width="682.561" x="303.5122" y="564.002"/><rect fill="none" height="170.924" style="stroke:#000000;stroke-width:1.5;" width="662.561" x="313.5122" y="622.414"/><rect fill="none" height="132.5301" style="stroke:#000000;stroke-width:1.5;" width="662.561" x="313.5122" y="923.456"/><rect fill="none" height="132.5301" style="stroke:#000000;stroke-width:1.5;" width="662.561" x="313.5122" y="1179.1042"/><rect fill="none" height="250.336" style="stroke:#000000;stroke-width:1.5;" width="682.561" x="303.5122" y="1434.7523"/><rect fill="none" height="135.512" style="stroke:#000000;stroke-width:1.5;" width="662.561" x="313.5122" y="1493.1643"/><rect fill="none" height="132.5301" style="stroke:#000000;stroke-width:1.5;" width="662.561" x="313.5122" y="1699.0883"/><g><title>client SDK operation</title><rect fill="#000000" fill-opacity="0.00000" height="1770.1886" width="8" x="74.8987" y="110.1358"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="78" x2="78" y1="110.1358" y2="1880.3244"/></g><g><title>lockd RM .implicit XA.</title><rect fill="#000000" fill-opacity="0.00000" height="1770.1886" width="8" x="396.8549" y="110.1358"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="400.5122" x2="400.5122" y1="110.1358" y2="1880.3244"/></g><g><title>Backend</title><rect fill="#000000" fill-opacity="0.00000" height="1770.1886" width="8" x="930.9193" y="110.1358"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="934.7654" x2="934.7654" y1="110.1358" y2="1880.3244"/></g><g class="participant participant-head" data-participant="SDK"><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="147.7975" x="5" y="76.0679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133.7975" x="12" y="98.0339">client SDK operation</text></g><g class="participant participant-tail" data-participant="SDK"><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="147.7975" x="5" y="1879.3244"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133.7975" x="12" y="1901.2904">client SDK operation</text></g><g class="participant participant-head" data-participant="RM"><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="154.6854" x="323.5122" y="76.0679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140.6854" x="330.5122" y="98.0339">lockd RM (implicit XA)</text></g><g class="participant participant-tail" data-participant="RM"><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="154.6854" x="323.5122" y="1879.3244"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140.6854" x="330.5122" y="1901.2904">lockd RM (implicit XA)</text></g><g class="participant participant-head" data-participant="Store"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.3078" x="903.7654" y="106.0339">Backend</text><path d="M916.9193,55.0679 C916.9193,45.0679 934.9193,45.0679 934.9193,45.0679 C934.9193,45.0679 952.9193,45.0679 952.9193,55.0679 L952.9193,81.0679 C952.9193,91.0679 934.9193,91.0679 934.9193,91.0679 C934.9193,91.0679 916.9193,91.0679 916.9193,81.0679 L916.9193,55.0679" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M916.9193,55.0679 C916.9193,65.0679 934.9193,65.0679 934.9193,65.0679 C934.9193,65.0679 952.9193,65.0679 952.9193,55.0679" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="Store"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.3078" x="903.7654" y="1894.2904">Backend</text><path d="M916.9193,1908.3924 C916.9193,1898.3924 934.9193,1898.3924 934.9193,1898.3924 C934.9193,1898.3924 952.9193,1898.3924 952.9193,1908.3924 L952.9193,1934.3924 C952.9193,1944.3924 934.9193,1944.3924 934.9193,1944.3924 C934.9193,1944.3924 916.9193,1944.3924 916.9193,1934.3924 L916.9193,1908.3924" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M916.9193,1908.3924 C916.9193,1918.3924 934.9193,1918.3924 934.9193,1918.3924 C934.9193,1918.3924 952.9193,1918.3924 952.9193,1908.3924" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="996.0732" x="0" y="141.9888"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="996.0732" y1="141.9888" y2="141.9888"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="996.0732" y1="144.9888" y2="144.9888"/><rect fill="#EEEEEE" height="25.706" style="stroke:#000000;stroke-width:2;" width="102.8421" x="446.6156" y="130.1358"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="85.4621" x="452.6156" y="148.0328">Acquire keyA</text><g class="message" data-participant-1="SDK" data-participant-2="RM"><polygon fill="#181818" points="388.8549,185.5479,398.8549,189.5479,388.8549,193.5479,392.8549,189.5479" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="78.8987" x2="394.8549" y1="189.5479" y2="189.5479"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="85.8987" y="183.7389">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.4831" x="97.3347" y="183.7389">POST /v1/acquire (keyA)</text></g><path d="M303.5122,204.5479 L376.8002,204.5479 L376.8002,214.2539 L366.8002,224.2539 L303.5122,224.2539 L303.5122,204.5479" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="236.336" style="stroke:#000000;stroke-width:1.5;" width="682.561" x="303.5122" y="204.5479"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.288" x="318.5122" y="219.4449">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="128.6881" x="391.8002" y="218.3068">[CAS retry (lease meta)]</text><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,243.9599,932.9193,247.9599,922.9193,251.9599,926.9193,247.9599" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="247.9599" y2="247.9599"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="407.8549" y="242.1509">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.7631" x="419.2909" y="242.1509">load_meta(keyA)</text></g><path d="M313.5122,262.9599 L375.9712,262.9599 L375.9712,272.6659 L365.9712,282.6659 L313.5122,282.6659 L313.5122,262.9599" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="170.924" style="stroke:#000000;stroke-width:1.5;" width="662.561" x="313.5122" y="262.9599"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.459" x="328.5122" y="277.8569">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="81.4984" x="390.9712" y="276.7188">[meta missing]</text><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,337.784,932.9193,341.784,922.9193,345.784,926.9193,341.784" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="341.784" y2="341.784"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="407.8549" y="318.2689">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.0401" x="419.2909" y="300.5629">store_meta(expected_etag="",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241.5531" x="419.2909" y="318.2689">lease_id, lease_owner, lease_expires_at,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185.7702" x="419.2909" y="335.975">lease_txn_id, fencing_token++)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="313.5122" x2="976.0732" y1="350.784" y2="350.784"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="81.2894" x="318.5122" y="362.5429">[meta present]</text><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,421.8839,932.9193,425.8839,922.9193,429.8839,926.9193,425.8839" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="425.8839" y2="425.8839"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="407.8549" y="402.3689">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.9902" x="419.2909" y="384.6629">store_meta(expected_etag=meta_etag,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241.5531" x="419.2909" y="402.3689">lease_id, lease_owner, lease_expires_at,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185.7702" x="419.2909" y="420.0749">lease_txn_id, fencing_token++)</text></g><g class="message" data-participant-1="RM" data-participant-2="SDK"><polygon fill="#181818" points="89.8987,467.5899,79.8987,471.5899,89.8987,475.5899,85.8987,471.5899" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="83.8987" x2="399.8549" y1="471.5899" y2="471.5899"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="95.8987" y="465.7809">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185.2112" x="107.3347" y="465.7809">lease_id, txn_id, fencing_token</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="996.0732" x="0" y="501.4429"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="996.0732" y1="501.4429" y2="501.4429"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="996.0732" y1="504.4429" y2="504.4429"/><rect fill="#EEEEEE" height="25.706" style="stroke:#000000;stroke-width:2;" width="102.6081" x="446.7326" y="489.5899"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="85.2281" x="452.7326" y="507.4869">Acquire keyB</text><g class="message" data-participant-1="SDK" data-participant-2="RM"><polygon fill="#181818" points="388.8549,545.002,398.8549,549.002,388.8549,553.002,392.8549,549.002" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="78.8987" x2="394.8549" y1="549.002" y2="549.002"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="85.8987" y="543.1929">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189.2152" x="97.3347" y="543.1929">POST /v1/acquire (keyB, txn_id)</text></g><path d="M303.5122,564.002 L376.8002,564.002 L376.8002,573.708 L366.8002,583.708 L303.5122,583.708 L303.5122,564.002" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="236.336" style="stroke:#000000;stroke-width:1.5;" width="682.561" x="303.5122" y="564.002"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.288" x="318.5122" y="578.899">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="128.6881" x="391.8002" y="577.7609">[CAS retry (lease meta)]</text><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,603.414,932.9193,607.414,922.9193,611.414,926.9193,607.414" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="607.414" y2="607.414"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="407.8549" y="601.605">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.9061" x="419.2909" y="601.605">load_meta(keyB)</text></g><path d="M313.5122,622.414 L375.9712,622.414 L375.9712,632.12 L365.9712,642.12 L313.5122,642.12 L313.5122,622.414" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="170.924" style="stroke:#000000;stroke-width:1.5;" width="662.561" x="313.5122" y="622.414"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.459" x="328.5122" y="637.311">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="81.4984" x="390.9712" y="636.1729">[meta missing]</text><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,697.2381,932.9193,701.2381,922.9193,705.2381,926.9193,701.2381" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="701.2381" y2="701.2381"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="407.8549" y="677.723">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.0401" x="419.2909" y="660.017">store_meta(expected_etag="",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241.5531" x="419.2909" y="677.723">lease_id, lease_owner, lease_expires_at,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185.7702" x="419.2909" y="695.429">lease_txn_id, fencing_token++)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="313.5122" x2="976.0732" y1="710.2381" y2="710.2381"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="81.2894" x="318.5122" y="721.997">[meta present]</text><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,781.338,932.9193,785.338,922.9193,789.338,926.9193,785.338" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="785.338" y2="785.338"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.436" x="407.8549" y="761.823">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.9902" x="419.2909" y="744.117">store_meta(expected_etag=meta_etag,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241.5531" x="419.2909" y="761.823">lease_id, lease_owner, lease_expires_at,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185.7702" x="419.2909" y="779.529">lease_txn_id, fencing_token++)</text></g><g class="message" data-participant-1="RM" data-participant-2="SDK"><polygon fill="#181818" points="89.8987,827.044,79.8987,831.044,89.8987,835.044,85.8987,831.044" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="83.8987" x2="399.8549" y1="831.044" y2="831.044"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="95.8987" y="825.235">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185.2112" x="114.7708" y="825.235">lease_id, txn_id, fencing_token</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="996.0732" x="0" y="860.897"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="996.0732" y1="860.897" y2="860.897"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="996.0732" y1="863.897" y2="863.897"/><rect fill="#EEEEEE" height="25.706" style="stroke:#000000;stroke-width:2;" width="89.4391" x="453.3171" y="849.044"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="72.0591" x="459.3171" y="866.941">Stage keyA</text><g class="message" data-participant-1="SDK" data-participant-2="RM"><polygon fill="#181818" points="388.8549,904.456,398.8549,908.456,388.8549,912.456,392.8549,908.456" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="78.8987" x2="394.8549" y1="908.456" y2="908.456"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="85.8987" y="902.647">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186.7972" x="104.7708" y="902.647">POST /v1/update (keyA, txn_id)</text></g><path d="M313.5122,923.456 L386.8002,923.456 L386.8002,933.1621 L376.8002,943.1621 L313.5122,943.1621 L313.5122,923.456" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="132.5301" style="stroke:#000000;stroke-width:1.5;" width="662.561" x="313.5122" y="923.456"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.288" x="328.5122" y="938.3531">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="150.7649" x="401.8002" y="937.215">[CAS retry (meta + staging)]</text><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,962.8681,932.9193,966.8681,922.9193,970.8681,926.9193,966.8681" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="966.8681" y2="966.8681"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="407.8549" y="961.0591">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.7631" x="426.7269" y="961.0591">load_meta(keyA)</text></g><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,994.5741,932.9193,998.5741,922.9193,1002.5741,926.9193,998.5741" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="998.5741" y2="998.5741"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="407.8549" y="992.7651">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="433.6674" x="426.7269" y="992.7651">write_state state/&lt;key&gt;/.staging/&lt;txn_id&gt; (expected_etag=staged_etag)</text></g><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,1043.9861,932.9193,1047.9861,922.9193,1051.9861,926.9193,1047.9861" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="1047.9861" y2="1047.9861"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="407.8549" y="1033.3241">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.9902" x="426.7269" y="1024.4711">store_meta(expected_etag=meta_etag,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.4262" x="426.7269" y="1042.1771">staged_txn_id, staged_state_etag)</text></g><g class="message" data-participant-1="RM" data-participant-2="SDK"><polygon fill="#181818" points="89.8987,1082.6921,79.8987,1086.6921,89.8987,1090.6921,85.8987,1086.6921" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="83.8987" x2="399.8549" y1="1086.6921" y2="1086.6921"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="95.8987" y="1080.8831">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.6711" x="114.7708" y="1080.8831">update ok (etag, version)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="996.0732" x="0" y="1116.5451"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="996.0732" y1="1116.5451" y2="1116.5451"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="996.0732" y1="1119.5451" y2="1119.5451"/><rect fill="#EEEEEE" height="25.706" style="stroke:#000000;stroke-width:2;" width="89.2051" x="453.4341" y="1104.6921"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71.8251" x="459.4341" y="1122.5892">Stage keyB</text><g class="message" data-participant-1="SDK" data-participant-2="RM"><polygon fill="#181818" points="388.8549,1160.1042,398.8549,1164.1042,388.8549,1168.1042,392.8549,1164.1042" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="78.8987" x2="394.8549" y1="1164.1042" y2="1164.1042"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="85.8987" y="1158.2952">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186.9402" x="104.7708" y="1158.2952">POST /v1/update (keyB, txn_id)</text></g><path d="M313.5122,1179.1042 L386.8002,1179.1042 L386.8002,1188.8102 L376.8002,1198.8102 L313.5122,1198.8102 L313.5122,1179.1042" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="132.5301" style="stroke:#000000;stroke-width:1.5;" width="662.561" x="313.5122" y="1179.1042"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.288" x="328.5122" y="1194.0012">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="150.7649" x="401.8002" y="1192.8631">[CAS retry (meta + staging)]</text><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,1218.5162,932.9193,1222.5162,922.9193,1226.5162,926.9193,1222.5162" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="1222.5162" y2="1222.5162"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="407.8549" y="1216.7072">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.9061" x="426.7269" y="1216.7072">load_meta(keyB)</text></g><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,1250.2222,932.9193,1254.2222,922.9193,1258.2222,926.9193,1254.2222" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="1254.2222" y2="1254.2222"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="407.8549" y="1248.4132">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="433.6674" x="426.7269" y="1248.4132">write_state state/&lt;key&gt;/.staging/&lt;txn_id&gt; (expected_etag=staged_etag)</text></g><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,1299.6343,932.9193,1303.6343,922.9193,1307.6343,926.9193,1303.6343" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="1303.6343" y2="1303.6343"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="407.8549" y="1288.9722">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.9902" x="426.7269" y="1280.1192">store_meta(expected_etag=meta_etag,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.4262" x="426.7269" y="1297.8253">staged_txn_id, staged_state_etag)</text></g><g class="message" data-participant-1="RM" data-participant-2="SDK"><polygon fill="#181818" points="89.8987,1338.3403,79.8987,1342.3403,89.8987,1346.3403,85.8987,1342.3403" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="83.8987" x2="399.8549" y1="1342.3403" y2="1342.3403"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="95.8987" y="1336.5313">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.6711" x="114.7708" y="1336.5313">update ok (etag, version)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="996.0732" x="0" y="1372.1933"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="996.0732" y1="1372.1933" y2="1372.1933"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="996.0732" y1="1375.1933" y2="1375.1933"/><rect fill="#EEEEEE" height="25.706" style="stroke:#000000;stroke-width:2;" width="246.3752" x="374.849" y="1360.3403"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="228.9952" x="380.849" y="1378.2373">Decide + apply (commit via release)</text><g class="message" data-participant-1="SDK" data-participant-2="RM"><polygon fill="#181818" points="388.8549,1415.7523,398.8549,1419.7523,388.8549,1423.7523,392.8549,1419.7523" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="78.8987" x2="394.8549" y1="1419.7523" y2="1419.7523"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="85.8987" y="1413.9433">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279.0842" x="104.7708" y="1413.9433">POST /v1/release (keyA, txn_id, rollback=false)</text></g><path d="M303.5122,1434.7523 L376.8002,1434.7523 L376.8002,1444.4583 L366.8002,1454.4583 L303.5122,1454.4583 L303.5122,1434.7523" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="250.336" style="stroke:#000000;stroke-width:1.5;" width="682.561" x="303.5122" y="1434.7523"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.288" x="318.5122" y="1449.6493">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="125.7731" x="391.8002" y="1448.5112">[CAS retry (txn record)]</text><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,1474.1643,932.9193,1478.1643,922.9193,1482.1643,926.9193,1478.1643" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="1478.1643" y2="1478.1643"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="407.8549" y="1472.3553">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184.8862" x="426.7269" y="1472.3553">get_txn_record(.txns/&lt;txn_id&gt;)</text></g><path d="M313.5122,1493.1643 L375.9712,1493.1643 L375.9712,1502.8704 L365.9712,1512.8704 L313.5122,1512.8704 L313.5122,1493.1643" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="135.512" style="stroke:#000000;stroke-width:1.5;" width="662.561" x="313.5122" y="1493.1643"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.459" x="328.5122" y="1508.0614">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="109.9112" x="390.9712" y="1506.9232">[txn record missing]</text><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,1550.2824,932.9193,1554.2824,922.9193,1558.2824,926.9193,1554.2824" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="1554.2824" y2="1554.2824"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="407.8549" y="1539.6204">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.8372" x="426.7269" y="1530.7674">put_txn_record(state=pending,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="271.4662" x="426.7269" y="1548.4734">participants+=keyA,keyB) (expected_etag="")</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="313.5122" x2="976.0732" y1="1563.2824" y2="1563.2824"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="99.1973" x="318.5122" y="1575.0413">[txn record exists]</text><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,1616.6763,932.9193,1620.6763,922.9193,1624.6763,926.9193,1620.6763" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="1620.6763" y2="1620.6763"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="407.8549" y="1606.0143">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.8372" x="426.7269" y="1597.1613">put_txn_record(state=pending,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="313.5472" x="426.7269" y="1614.8673">participants+=keyA,keyB) (expected_etag=txn_etag)</text></g><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,1673.0883,932.9193,1677.0883,922.9193,1681.0883,926.9193,1677.0883" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="1677.0883" y2="1677.0883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="407.8549" y="1662.4263">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.5602" x="426.7269" y="1653.5733">put_txn_record(state=commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="341.3024" x="426.7269" y="1671.2793">tc_term, participants merged) (expected_etag=txn_etag)</text></g><path d="M313.5122,1699.0883 L386.8002,1699.0883 L386.8002,1708.7944 L376.8002,1718.7944 L313.5122,1718.7944 L313.5122,1699.0883" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="132.5301" style="stroke:#000000;stroke-width:1.5;" width="662.561" x="313.5122" y="1699.0883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.288" x="328.5122" y="1713.9854">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="107.1393" x="401.8002" y="1712.8473">[apply participants]</text><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,1738.5004,932.9193,1742.5004,922.9193,1746.5004,926.9193,1742.5004" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="1742.5004" y2="1742.5004"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="407.8549" y="1736.6914">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.8651" x="426.7269" y="1736.6914">load_meta(participant)</text></g><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,1770.2064,932.9193,1774.2064,922.9193,1778.2064,926.9193,1774.2064" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="1774.2064" y2="1774.2064"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="407.8549" y="1768.3974">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="491.1924" x="426.7269" y="1768.3974">write_state key from state/&lt;key&gt;/.staging/&lt;txn_id&gt; (expected_etag=staged_etag)</text></g><g class="message" data-participant-1="RM" data-participant-2="Store"><polygon fill="#181818" points="922.9193,1819.6184,932.9193,1823.6184,922.9193,1827.6184,926.9193,1823.6184" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="400.8549" x2="928.9193" y1="1823.6184" y2="1823.6184"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="407.8549" y="1808.9564">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.9902" x="426.7269" y="1800.1034">store_meta(expected_etag=meta_etag,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.1931" x="426.7269" y="1817.8094">clear lease + staging)</text></g><g class="message" data-participant-1="RM" data-participant-2="SDK"><polygon fill="#181818" points="89.8987,1858.3244,79.8987,1862.3244,89.8987,1866.3244,85.8987,1862.3244" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="83.8987" x2="399.8549" y1="1862.3244" y2="1862.3244"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.872" x="95.8987" y="1856.5154">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62.426" x="114.7708" y="1856.5154">release ok</text></g><!--SRC=[xLLDZzem4BtdLumu4K4NzOesAv5oMwrQBJtieL9ad86rS6BN6LZuznqx2HjWGRJQxQ7g0UBOC_DUtdoO56c4fmay2sjtO0KzGxzIvP9tvqAkiCo7e0ghbLG4qXI5eZWIQpBbkfYZYo8h7F6X5IL1Jsg5_9nDxy5OT8AKANiWAhzpQAcDNENm-03zVVIdIHni7n-YN92OYmgXbzOawY1a74PHai14_bmhXx32tGII9FA0d-xOSmpVliw-msZpUIGQcxutYYDjZ8Klanau9BU3laOVlq0ISGIU2Fi7W35e8_BCdpIk049JC8L2LLuTtZhogVoZTiAjHKcOP_ooJ7gzuOyoW6MAjQnNvgL4rxwmFVEiCa5xIzgMmNg1fMIuZ0oBC1XuAgWRsc3PYTN-3Iv-AwpUcLAPH_xdINWMq_inl8P_q_4uY-arMKpRO7-UpVH_DZygcpDcShaZrvRxkcd8ywaCQWpuiyMI0QvepeFZ5wS8CtPceF0_kcMxkz5D4szqM-FUmP6Q_hnPdmIzAWLDW5QWvZLmQA8UgzheOLRCnSU03RgA9sPyg6TwXPxf- -YP_iDwJb6g75a9lkaqwr9VPh1HWfKA1HwV4xevFwpS8JYZjRyaauNWDZvLdkruAOtBJnHO8eKlgu_xDxokzbAsC-hL__oaikk3G46UnB8oRCqYTkxSQf04-Y7DS3BNzjEeWufRLL7rOQ0-H5iVFfVNeDHPOn2I6Q4hXj15ur7gk4ek87cSaAUw2hhEvpkZOtMnGVWhOU5CyPSxHN9rkdf6Tnlzk3tQAZQhw1S0]--></g></svg>