<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1962px" preserveAspectRatio="none" style="width:1060px;height:1962px;background:#FFFFFF;" version="1.1" viewBox="0 0 1060 1962" width="1060px" zoomAndPan="magnify">
  <rect width="100%" height="100%" fill="#ffffff"/><defs><filter height="300%" id="fzbahtuyqa8h4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="none" filter="url(#fzbahtuyqa8h4)" height="163.512" style="stroke:#000000;stroke-width:2;" width="598.0428" x="320.2464" y="248.892"/><rect fill="none" filter="url(#fzbahtuyqa8h4)" height="131.806" style="stroke:#000000;stroke-width:2;" width="598.0428" x="320.2464" y="520.522"/><rect fill="none" filter="url(#fzbahtuyqa8h4)" height="166.2361" style="stroke:#000000;stroke-width:2;" width="1031.7808" x="10" y="1032.8002"/><rect fill="none" filter="url(#fzbahtuyqa8h4)" height="116.8241" style="stroke:#000000;stroke-width:2;" width="721.5344" x="320.2464" y="1420.9784"/><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="1784.5007" width="8" x="37.8369" y="91.0679"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:5,5;" x1="41" x2="41" y1="91.0679" y2="1875.5686"/></g><g><title>HTTP Handler</title><rect fill="#000000" fill-opacity="0.00000" height="1784.5007" width="8" x="380.6622" y="91.0679"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:5,5;" x1="384.2464" x2="384.2464" y1="91.0679" y2="1875.5686"/></g><g><title>JSON Compactor</title><rect fill="#000000" fill-opacity="0.00000" height="1784.5007" width="8" x="555.4983" y="91.0679"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:5,5;" x1="558.6885" x2="558.6885" y1="91.0679" y2="1875.5686"/></g><g><title>Azure Store .azblob.</title><rect fill="#000000" fill-opacity="0.00000" height="1784.5007" width="8" x="704.3879" y="91.0679"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:5,5;" x1="708.3081" x2="708.3081" y1="91.0679" y2="1875.5686"/></g><g><title>meta..key..json</title><rect fill="#000000" fill-opacity="0.00000" height="1784.5007" width="8" x="846.8784" y="91.0679"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:5,5;" x1="850.4676" x2="850.4676" y1="91.0679" y2="1875.5686"/></g><g><title>state..key..json</title><rect fill="#000000" fill-opacity="0.00000" height="1784.5007" width="8" x="971.035" y="91.0679"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:5,5;" x1="974.2892" x2="974.2892" y1="91.0679" y2="1875.5686"/></g><g class="participant participant-head" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37.6738" x="20" y="86.9659">Client</text><ellipse cx="41.8369" cy="15" fill="#FEFECE" filter="url(#fzbahtuyqa8h4)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2;"/><path d="M41.8369,23 L41.8369,50 M28.8369,31 L54.8369,31 M41.8369,50 L28.8369,65 M41.8369,50 L54.8369,65" fill="none" filter="url(#fzbahtuyqa8h4)" style="stroke:#A80036;stroke-width:2;"/></g><g class="participant participant-tail" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37.6738" x="20" y="1889.5346">Client</text><ellipse cx="41.8369" cy="1903.6365" fill="#FEFECE" filter="url(#fzbahtuyqa8h4)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2;"/><path d="M41.8369,1911.6365 L41.8369,1938.6365 M28.8369,1919.6365 L54.8369,1919.6365 M41.8369,1938.6365 L28.8369,1953.6365 M41.8369,1938.6365 L54.8369,1953.6365" fill="none" filter="url(#fzbahtuyqa8h4)" style="stroke:#A80036;stroke-width:2;"/></g><g class="participant participant-head" data-participant="Handler"><rect fill="#FEFECE" filter="url(#fzbahtuyqa8h4)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="104.8316" x="330.2464" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.8316" x="337.2464" y="74.9659">HTTP Handler</text></g><g class="participant participant-tail" data-participant="Handler"><rect fill="#FEFECE" filter="url(#fzbahtuyqa8h4)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="104.8316" x="330.2464" y="1874.5686"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.8316" x="337.2464" y="1896.5346">HTTP Handler</text></g><g class="participant participant-head" data-participant="Compactor"><rect fill="#FEFECE" filter="url(#fzbahtuyqa8h4)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="123.6196" x="495.6885" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.6196" x="502.6885" y="74.9659">JSON Compactor</text></g><g class="participant participant-tail" data-participant="Compactor"><rect fill="#FEFECE" filter="url(#fzbahtuyqa8h4)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="123.6196" x="495.6885" y="1874.5686"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.6196" x="502.6885" y="1896.5346">JSON Compactor</text></g><g class="participant participant-head" data-participant="Azure"><rect fill="#FEFECE" filter="url(#fzbahtuyqa8h4)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="146.1595" x="633.3081" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132.1595" x="640.3081" y="74.9659">Azure Store (azblob)</text></g><g class="participant participant-tail" data-participant="Azure"><rect fill="#FEFECE" filter="url(#fzbahtuyqa8h4)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="146.1595" x="633.3081" y="1874.5686"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132.1595" x="640.3081" y="1896.5346">Azure Store (azblob)</text></g><g class="participant participant-head" data-participant="MetaBlob"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108.8216" x="793.4676" y="86.9659">meta/&lt;key&gt;.json</text><path d="M832.8784,36 C832.8784,26 850.8784,26 850.8784,26 C850.8784,26 868.8784,26 868.8784,36 L868.8784,62 C868.8784,72 850.8784,72 850.8784,72 C850.8784,72 832.8784,72 832.8784,62 L832.8784,36" fill="#FEFECE" filter="url(#fzbahtuyqa8h4)" style="stroke:#A80036;stroke-width:1;"/><path d="M832.8784,36 C832.8784,46 850.8784,46 850.8784,46 C850.8784,46 868.8784,46 868.8784,36" fill="none" style="stroke:#A80036;stroke-width:1;"/></g><g class="participant participant-tail" data-participant="MetaBlob"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108.8216" x="793.4676" y="1889.5346">meta/&lt;key&gt;.json</text><path d="M832.8784,1903.6365 C832.8784,1893.6365 850.8784,1893.6365 850.8784,1893.6365 C850.8784,1893.6365 868.8784,1893.6365 868.8784,1903.6365 L868.8784,1929.6365 C868.8784,1939.6365 850.8784,1939.6365 850.8784,1939.6365 C850.8784,1939.6365 832.8784,1939.6365 832.8784,1929.6365 L832.8784,1903.6365" fill="#FEFECE" filter="url(#fzbahtuyqa8h4)" style="stroke:#A80036;stroke-width:1;"/><path d="M832.8784,1903.6365 C832.8784,1913.6365 850.8784,1913.6365 850.8784,1913.6365 C850.8784,1913.6365 868.8784,1913.6365 868.8784,1903.6365" fill="none" style="stroke:#A80036;stroke-width:1;"/></g><g class="participant participant-head" data-participant="StateBlob"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107.4916" x="918.2892" y="86.9659">state/&lt;key&gt;.json</text><path d="M957.035,36 C957.035,26 975.035,26 975.035,26 C975.035,26 993.035,26 993.035,36 L993.035,62 C993.035,72 975.035,72 975.035,72 C975.035,72 957.035,72 957.035,62 L957.035,36" fill="#FEFECE" filter="url(#fzbahtuyqa8h4)" style="stroke:#A80036;stroke-width:1;"/><path d="M957.035,36 C957.035,46 975.035,46 975.035,46 C975.035,46 993.035,46 993.035,36" fill="none" style="stroke:#A80036;stroke-width:1;"/></g><g class="participant participant-tail" data-participant="StateBlob"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107.4916" x="918.2892" y="1889.5346">state/&lt;key&gt;.json</text><path d="M957.035,1903.6365 C957.035,1893.6365 975.035,1893.6365 975.035,1893.6365 C975.035,1893.6365 993.035,1893.6365 993.035,1903.6365 L993.035,1929.6365 C993.035,1939.6365 975.035,1939.6365 975.035,1939.6365 C975.035,1939.6365 957.035,1939.6365 957.035,1929.6365 L957.035,1903.6365" fill="#FEFECE" filter="url(#fzbahtuyqa8h4)" style="stroke:#A80036;stroke-width:1;"/><path d="M957.035,1903.6365 C957.035,1913.6365 975.035,1913.6365 975.035,1913.6365 C975.035,1913.6365 993.035,1913.6365 993.035,1903.6365" fill="none" style="stroke:#A80036;stroke-width:1;"/></g><rect fill="#EEEEEE" filter="url(#fzbahtuyqa8h4)" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1051.7808" x="0" y="122.9209"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1051.7808" y1="122.9209" y2="122.9209"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1051.7808" y1="125.9209" y2="125.9209"/><rect fill="#EEEEEE" filter="url(#fzbahtuyqa8h4)" height="25.706" style="stroke:#000000;stroke-width:2;" width="67.352" x="492.2144" y="111.0679"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="49.972" x="498.2144" y="128.9649">Acquire</text><g class="message" data-participant-1="Client" data-participant-2="Handler"><polygon fill="#A80036" points="372.6622,166.4799,382.6622,170.4799,372.6622,174.4799,376.6622,170.4799" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="41.8369" x2="378.6622" y1="170.4799" y2="170.4799"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.0921" x="48.8369" y="164.6709">POST /v1/acquire</text></g><g class="message" data-participant-1="Handler" data-participant-2="Azure"><polygon fill="#A80036" points="696.3879,198.186,706.3879,202.186,696.3879,206.186,700.3879,202.186" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="384.6622" x2="702.3879" y1="202.186" y2="202.186"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175.9552" x="391.6622" y="196.377">DownloadStream(meta blob)</text></g><g class="message" data-participant-1="Azure" data-participant-2="MetaBlob"><polygon fill="#A80036" points="838.8784,229.892,848.8784,233.892,838.8784,237.892,842.8784,233.892" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="708.3879" x2="844.8784" y1="233.892" y2="233.892"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23.92" x="715.3879" y="228.083">GET</text></g><path d="M320.2464,248.892 L382.7054,248.892 L382.7054,258.598 L372.7054,268.598 L320.2464,268.598 L320.2464,248.892" fill="#EEEEEE" style="stroke:#000000;stroke-width:1;"/><rect fill="none" height="163.512" style="stroke:#000000;stroke-width:2;" width="598.0428" x="320.2464" y="248.892"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.459" x="335.2464" y="263.789">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="63.1505" x="397.7054" y="262.6509">[Not found]</text><g class="message" data-participant-1="MetaBlob" data-participant-2="Azure"><polygon fill="#A80036" points="719.3879,288.304,709.3879,292.304,719.3879,296.304,715.3879,292.304" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="713.3879" x2="849.8784" y1="292.304" y2="292.304"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22.308" x="725.3879" y="286.495">404</text></g><g class="message" data-participant-1="Azure" data-participant-2="Handler"><polygon fill="#A80036" points="395.6622,320.01,385.6622,324.01,395.6622,328.01,391.6622,324.01" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="389.6622" x2="707.3879" y1="324.01" y2="324.01"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79.0791" x="401.6622" y="318.201">ErrNotFound</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="320.2464" x2="918.2892" y1="333.01" y2="333.01"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="41.5467" x="325.2464" y="344.7689">[Found]</text><g class="message" data-participant-1="MetaBlob" data-participant-2="Azure"><polygon fill="#A80036" points="719.3879,368.6979,709.3879,372.6979,719.3879,376.6979,715.3879,372.6979" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="713.3879" x2="849.8784" y1="372.6979" y2="372.6979"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74.6591" x="725.3879" y="366.8889">JSON + ETag</text></g><g class="message" data-participant-1="Azure" data-participant-2="Handler"><polygon fill="#A80036" points="395.6622,400.404,385.6622,404.404,395.6622,408.404,391.6622,404.404" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="389.6622" x2="707.3879" y1="404.404" y2="404.404"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.9821" x="401.6622" y="398.595">meta + etag</text></g><g class="message" data-participant-1="Handler" data-participant-2="Handler"><line style="stroke:#A80036;stroke-width:1;" x1="384.6622" x2="426.6622" y1="443.11" y2="443.11"/><line style="stroke:#A80036;stroke-width:1;" x1="426.6622" x2="426.6622" y1="443.11" y2="456.11"/><line style="stroke:#A80036;stroke-width:1;" x1="385.6622" x2="426.6622" y1="456.11" y2="456.11"/><polygon fill="#A80036" points="395.6622,452.11,385.6622,456.11,395.6622,460.11,391.6622,456.11" style="stroke:#A80036;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.8361" x="391.6622" y="437.301">lease_id, fencing := prev+1</text></g><g class="message" data-participant-1="Handler" data-participant-2="Azure"><polygon fill="#A80036" points="696.3879,501.522,706.3879,505.522,696.3879,509.522,700.3879,505.522" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="384.6622" x2="702.3879" y1="505.522" y2="505.522"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250.9652" x="391.6622" y="482.007">UploadStream(meta blob, updated lease)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.3532" x="391.6622" y="499.713">If-Match old_etag or If-None-Match "*"</text></g><path d="M320.2464,520.522 L382.7054,520.522 L382.7054,530.228 L372.7054,540.228 L320.2464,540.228 L320.2464,520.522" fill="#EEEEEE" style="stroke:#000000;stroke-width:1;"/><rect fill="none" height="131.806" style="stroke:#000000;stroke-width:2;" width="598.0428" x="320.2464" y="520.522"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.459" x="335.2464" y="535.419">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="111.7922" x="397.7054" y="534.2809">[Precondition failed]</text><g class="message" data-participant-1="Azure" data-participant-2="Handler"><polygon fill="#A80036" points="395.6622,559.934,385.6622,563.934,395.6622,567.934,391.6622,563.934" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="389.6622" x2="707.3879" y1="563.934" y2="563.934"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.4131" x="401.6622" y="558.125">ErrCASMismatch</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="320.2464" x2="918.2892" y1="572.934" y2="572.934"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="49.3127" x="325.2464" y="584.6929">[Success]</text><g class="message" data-participant-1="MetaBlob" data-participant-2="Azure"><polygon fill="#A80036" points="719.3879,608.6219,709.3879,612.6219,719.3879,616.6219,715.3879,612.6219" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="713.3879" x2="849.8784" y1="612.6219" y2="612.6219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.3851" x="725.3879" y="606.8129">stored + new ETag</text></g><g class="message" data-participant-1="Azure" data-participant-2="Handler"><polygon fill="#A80036" points="395.6622,640.328,385.6622,644.328,395.6622,648.328,391.6622,644.328" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="389.6622" x2="707.3879" y1="644.328" y2="644.328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.9141" x="401.6622" y="638.519">new_meta_etag</text></g><g class="message" data-participant-1="Handler" data-participant-2="Client"><polygon fill="#A80036" points="52.8369,696.74,42.8369,700.74,52.8369,704.74,48.8369,700.74" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="46.8369" x2="383.6622" y1="700.74" y2="700.74"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.4171" x="58.8369" y="677.225">200 AcquireResponse</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.1271" x="58.8369" y="694.931">X-Fencing-Token</text></g><rect fill="#EEEEEE" filter="url(#fzbahtuyqa8h4)" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1051.7808" x="0" y="730.593"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1051.7808" y1="730.593" y2="730.593"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1051.7808" y1="733.593" y2="733.593"/><rect fill="#EEEEEE" filter="url(#fzbahtuyqa8h4)" height="25.706" style="stroke:#000000;stroke-width:2;" width="81.5871" x="485.0969" y="718.74"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64.207" x="491.0969" y="736.637">KeepAlive</text><g class="message" data-participant-1="Client" data-participant-2="Handler"><polygon fill="#A80036" points="372.6622,791.858,382.6622,795.858,372.6622,799.858,376.6622,795.858" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="41.8369" x2="378.6622" y1="795.858" y2="795.858"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.0131" x="48.8369" y="772.343">POST /v1/keepalive</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.1271" x="48.8369" y="790.049">X-Fencing-Token</text></g><g class="message" data-participant-1="Handler" data-participant-2="Azure"><polygon fill="#A80036" points="696.3879,841.2701,706.3879,845.2701,696.3879,849.2701,700.3879,845.2701" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="384.6622" x2="702.3879" y1="845.2701" y2="845.2701"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238.1602" x="391.6622" y="821.7551">UploadStream(meta blob, new expires)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.0541" x="391.6622" y="839.4611">If-Match meta_etag</text></g><g class="message" data-participant-1="Azure" data-participant-2="Handler"><polygon fill="#A80036" points="395.6622,872.9761,385.6622,876.9761,395.6622,880.9761,391.6622,876.9761" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="389.6622" x2="707.3879" y1="876.9761" y2="876.9761"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.9141" x="401.6622" y="871.1671">new_meta_etag</text></g><g class="message" data-participant-1="Handler" data-participant-2="Client"><polygon fill="#A80036" points="52.8369,904.6821,42.8369,908.6821,52.8369,912.6821,48.8369,908.6821" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="46.8369" x2="383.6622" y1="908.6821" y2="908.6821"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85.3451" x="58.8369" y="902.8731">200 KeepAlive</text></g><rect fill="#EEEEEE" filter="url(#fzbahtuyqa8h4)" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1051.7808" x="0" y="938.5351"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1051.7808" y1="938.5351" y2="938.5351"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1051.7808" y1="941.5351" y2="941.5351"/><rect fill="#EEEEEE" filter="url(#fzbahtuyqa8h4)" height="25.706" style="stroke:#000000;stroke-width:2;" width="74.099" x="488.8409" y="926.6821"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56.719" x="494.8409" y="944.5791">GetState</text><g class="message" data-participant-1="Client" data-participant-2="Handler"><polygon fill="#A80036" points="372.6622,982.0941,382.6622,986.0941,372.6622,990.0941,376.6622,986.0941" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="41.8369" x2="378.6622" y1="986.0941" y2="986.0941"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115.5051" x="48.8369" y="980.2851">POST /v1/get_state</text></g><g class="message" data-participant-1="Handler" data-participant-2="Azure"><polygon fill="#A80036" points="696.3879,1013.8002,706.3879,1017.8002,696.3879,1021.8002,700.3879,1017.8002" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="384.6622" x2="702.3879" y1="1017.8002" y2="1017.8002"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174.7202" x="391.6622" y="1011.9912">DownloadStream(state blob)</text></g><path d="M10,1032.8002 L72.459,1032.8002 L72.459,1042.5062 L62.459,1052.5062 L10,1052.5062 L10,1032.8002" fill="#EEEEEE" style="stroke:#000000;stroke-width:1;"/><rect fill="none" height="166.2361" style="stroke:#000000;stroke-width:2;" width="1031.7808" x="10" y="1032.8002"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.459" x="25" y="1047.6972">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="63.1505" x="87.459" y="1046.5591">[Not found]</text><g class="message" data-participant-1="Azure" data-participant-2="Handler"><polygon fill="#A80036" points="395.6622,1072.2122,385.6622,1076.2122,395.6622,1080.2122,391.6622,1076.2122" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="389.6622" x2="707.3879" y1="1076.2122" y2="1076.2122"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79.0791" x="401.6622" y="1070.4032">ErrNotFound</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="1041.7808" y1="1085.2122" y2="1085.2122"/><g class="message" data-participant-1="StateBlob" data-participant-2="Azure"><polygon fill="#A80036" points="719.3879,1105.9182,709.3879,1109.9182,719.3879,1113.9182,715.3879,1109.9182" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="713.3879" x2="974.035" y1="1109.9182" y2="1109.9182"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.2281" x="725.3879" y="1104.1092">stream + ETag + size</text></g><g class="message" data-participant-1="Azure" data-participant-2="Handler"><polygon fill="#A80036" points="395.6622,1137.6242,385.6622,1141.6242,395.6622,1145.6242,391.6622,1141.6242" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="389.6622" x2="707.3879" y1="1141.6242" y2="1141.6242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.9901" x="401.6622" y="1135.8152">stream + info</text></g><g class="message" data-participant-1="Handler" data-participant-2="Client"><polygon fill="#A80036" points="52.8369,1187.0363,42.8369,1191.0363,52.8369,1195.0363,48.8369,1191.0363" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="46.8369" x2="383.6622" y1="1191.0363" y2="1191.0363"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.757" x="58.8369" y="1167.5212">200 stream</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285.0253" x="58.8369" y="1185.2273">headers: ETag, X-Key-Version, X-Fencing-Token</text></g><rect fill="#EEEEEE" filter="url(#fzbahtuyqa8h4)" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1051.7808" x="0" y="1227.8893"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1051.7808" y1="1227.8893" y2="1227.8893"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1051.7808" y1="1230.8893" y2="1230.8893"/><rect fill="#EEEEEE" filter="url(#fzbahtuyqa8h4)" height="25.706" style="stroke:#000000;stroke-width:2;" width="98.8251" x="476.4778" y="1216.0363"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="81.4451" x="482.4778" y="1233.9333">UpdateState</text><g class="message" data-participant-1="Client" data-participant-2="Handler"><polygon fill="#A80036" points="372.6622,1289.1543,382.6622,1293.1543,372.6622,1297.1543,376.6622,1293.1543" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="41.8369" x2="378.6622" y1="1293.1543" y2="1293.1543"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.8271" x="48.8369" y="1269.6393">POST /v1/update_state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221.9622" x="48.8369" y="1287.3453">body, CAS headers, X-Fencing-Token</text></g><g class="message" data-participant-1="Handler" data-participant-2="Compactor"><polygon fill="#A80036" points="547.4983,1320.8603,557.4983,1324.8603,547.4983,1328.8603,551.4983,1324.8603" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="384.6622" x2="553.4983" y1="1324.8603" y2="1324.8603"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86.5801" x="391.6622" y="1319.0513">compact JSON</text></g><g class="message" data-participant-1="Compactor" data-participant-2="Handler"><polygon fill="#A80036" points="395.6622,1352.5663,385.6622,1356.5663,395.6622,1360.5663,391.6622,1356.5663" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="389.6622" x2="558.4983" y1="1356.5663" y2="1356.5663"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.069" x="401.6622" y="1350.7573">stream</text></g><g class="message" data-participant-1="Handler" data-participant-2="Azure"><polygon fill="#A80036" points="696.3879,1401.9784,706.3879,1405.9784,696.3879,1409.9784,700.3879,1405.9784" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="384.6622" x2="702.3879" y1="1405.9784" y2="1405.9784"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206.5442" x="391.6622" y="1382.4634">UploadStream(state blob, stream)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.3771" x="391.6622" y="1400.1694">If-Match expected_etag</text></g><path d="M320.2464,1420.9784 L382.7054,1420.9784 L382.7054,1430.6844 L372.7054,1440.6844 L320.2464,1440.6844 L320.2464,1420.9784" fill="#EEEEEE" style="stroke:#000000;stroke-width:1;"/><rect fill="none" height="116.8241" style="stroke:#000000;stroke-width:2;" width="721.5344" x="320.2464" y="1420.9784"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.459" x="335.2464" y="1435.8754">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="111.7922" x="397.7054" y="1434.7373">[Precondition failed]</text><g class="message" data-participant-1="Azure" data-participant-2="Handler"><polygon fill="#A80036" points="395.6622,1460.3904,385.6622,1464.3904,395.6622,1468.3904,391.6622,1464.3904" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="389.6622" x2="707.3879" y1="1464.3904" y2="1464.3904"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.4131" x="401.6622" y="1458.5814">ErrCASMismatch</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="320.2464" x2="1041.7808" y1="1473.3904" y2="1473.3904"/><g class="message" data-participant-1="StateBlob" data-participant-2="Azure"><polygon fill="#A80036" points="719.3879,1494.0964,709.3879,1498.0964,719.3879,1502.0964,715.3879,1498.0964" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="713.3879" x2="974.035" y1="1498.0964" y2="1498.0964"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.3851" x="725.3879" y="1492.2874">stored + new ETag</text></g><g class="message" data-participant-1="Azure" data-participant-2="Handler"><polygon fill="#A80036" points="395.6622,1525.8024,385.6622,1529.8024,395.6622,1533.8024,391.6622,1529.8024" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="389.6622" x2="707.3879" y1="1529.8024" y2="1529.8024"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.6791" x="401.6622" y="1523.9934">new_state_etag</text></g><g class="message" data-participant-1="Handler" data-participant-2="Azure"><polygon fill="#A80036" points="696.3879,1582.2145,706.3879,1586.2145,696.3879,1590.2145,700.3879,1586.2145" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="384.6622" x2="702.3879" y1="1586.2145" y2="1586.2145"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294.5543" x="391.6622" y="1562.6995">UploadStream(meta blob, version+1, state_etag)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.0541" x="391.6622" y="1580.4055">If-Match meta_etag</text></g><g class="message" data-participant-1="Azure" data-participant-2="Handler"><polygon fill="#A80036" points="395.6622,1613.9205,385.6622,1617.9205,395.6622,1621.9205,391.6622,1617.9205" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="389.6622" x2="707.3879" y1="1617.9205" y2="1617.9205"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.9141" x="401.6622" y="1612.1115">new_meta_etag</text></g><g class="message" data-participant-1="Handler" data-participant-2="Client"><polygon fill="#A80036" points="52.8369,1663.3325,42.8369,1667.3325,52.8369,1671.3325,48.8369,1667.3325" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="46.8369" x2="383.6622" y1="1667.3325" y2="1667.3325"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="318.8253" x="58.8369" y="1643.8175">200 {new_version, new_state_etag, bytes&#8776;streamed}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285.0253" x="58.8369" y="1661.5235">headers: ETag, X-Key-Version, X-Fencing-Token</text></g><rect fill="#EEEEEE" filter="url(#fzbahtuyqa8h4)" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1051.7808" x="0" y="1697.1855"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1051.7808" y1="1697.1855" y2="1697.1855"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1051.7808" y1="1700.1855" y2="1700.1855"/><rect fill="#EEEEEE" filter="url(#fzbahtuyqa8h4)" height="25.706" style="stroke:#000000;stroke-width:2;" width="67.287" x="492.2469" y="1685.3325"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="49.907" x="498.2469" y="1703.2295">Release</text><g class="message" data-participant-1="Client" data-participant-2="Handler"><polygon fill="#A80036" points="372.6622,1740.7446,382.6622,1744.7446,372.6622,1748.7446,376.6622,1744.7446" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="41.8369" x2="378.6622" y1="1744.7446" y2="1744.7446"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.7141" x="48.8369" y="1738.9355">POST /v1/release</text></g><g class="message" data-participant-1="Handler" data-participant-2="Azure"><polygon fill="#A80036" points="696.3879,1790.1566,706.3879,1794.1566,696.3879,1798.1566,700.3879,1794.1566" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;" x1="384.6622" x2="702.3879" y1="1794.1566" y2="1794.1566"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244.5432" x="391.6622" y="1770.6416">UploadStream(meta blob, lease cleared)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.0541" x="391.6622" y="1788.3476">If-Match meta_etag</text></g><g class="message" data-participant-1="Azure" data-participant-2="Handler"><polygon fill="#A80036" points="395.6622,1821.8626,385.6622,1825.8626,395.6622,1829.8626,391.6622,1825.8626" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="389.6622" x2="707.3879" y1="1825.8626" y2="1825.8626"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.9141" x="401.6622" y="1820.0536">new_meta_etag</text></g><g class="message" data-participant-1="Handler" data-participant-2="Client"><polygon fill="#A80036" points="52.8369,1853.5686,42.8369,1857.5686,52.8369,1861.5686,48.8369,1857.5686" style="stroke:#A80036;stroke-width:1;"/><line style="stroke:#A80036;stroke-width:1;stroke-dasharray:2,2;" x1="46.8369" x2="383.6622" y1="1857.5686" y2="1857.5686"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.7141" x="58.8369" y="1851.7596">200 {released:true}</text></g><!--SRC=[hLHTRzem57tthxZYPUs0jPtw58rAh9_Rr0yrTEe34ZB9XNe4EuiD7PtwlltD_P9TsqaAuoEjLXuWs2VNzvnxZj_04Hek4enXaAXx6AWCsW-J3E5ZelhGvz48PSoO7Wa9cTB868yCWGuJWTAmb6T6H2Bbqa3jhDEvWZCkumIp6d1TF2-YFeUN5t2engahv73blqMaRoIaTOGj_j2dZhOTtcsmc1lUvngXDYOEEnz6E3juzqqhwJ3dj6OvpC6quGR_nOLsqG5PgmNjwFj4q76j5lCCeNbGq0ZWwZBimCvqRuTx6CjtBCZr5C2HkfU9ud5eCkJZBTiPkCQPPqF8ehC0JeyxZ2S6BfGXvISaDD2ds8VcKzdztNstbnUPR-euo-Zz4_Sw9iJpP6Cb9tyTZZjykAwYQxeEz3raTlfpB4jCWYHfJyGD6A2CX1n2q88qmsbzRuKgD-agJHemIMawv3rNRRihFmsQvzn4Tw2Ik6VF1x8QBLueYVbExMtDQNQLOQHaB8nG4WREmXiKEco7vqAFRGKlKZY98jHwhKpQkYuc5IJURnIBzdkMKMzPBe9v4mNmVdUtyDOrwbH9ZLrvsppnsZKxYcBc3FW5CMqdObffmH41kGKkrtc-_fOS_aYfApsl_XEVIiBho9Oy7AjJD2vdLQI6Q7ekfTN9Sh0yMiiPUaPE7AvC_-BixGbvIEX7YmTSLxN42ZbG3hHE4O_ioZlaCMOwSDKRSDlyWhFcLreX8zk_YxDqjoyfUEEIyYmHVQYyZbtPL_6i0UH_o0zUFcDEw_8c3Y3oZ-x2OENwAlPLXdiQLID_Ozviv3-Cw1BmVlh_Q6-QwmioxPhkhRe3Ap8rzQEixrcoHOrNJjTF2viMdbbijm7zcK7zv_SlhpN6ZoyrdJNSDRfBkSficOUzG1zVDg8V6iPhwvAt4mScc-0Z-mi0]--></g></svg>